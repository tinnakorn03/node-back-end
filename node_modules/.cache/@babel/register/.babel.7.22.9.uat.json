{"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/server.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const app = require('./src/app');\nrequire('dotenv').config({\n  path: `.env.${process.env.NODE_ENV}`\n});\nconst PORT = process.env.PORT;\nconst server = app.listen(PORT, () => {\n  console.log(`ðŸŽ‰ðŸŽ‰ðŸŽ‰ Application running on ENV : ${process.env.NODE_ENV} - Port: ${PORT} ðŸŽ‰ðŸŽ‰ðŸŽ‰`);\n});\nmodule.exports = server;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJhcHAiLCJyZXF1aXJlIiwiY29uZmlnIiwicGF0aCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIlBPUlQiLCJzZXJ2ZXIiLCJsaXN0ZW4iLCJjb25zb2xlIiwibG9nIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiL1VzZXJzL21hY3Byby9EZXNrdG9wL0luZm9tYXRpb24vVGVzdC9ub2RlLWJhY2stZW5kLyIsInNvdXJjZXMiOlsic2VydmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGFwcCA9IHJlcXVpcmUoJy4vc3JjL2FwcCcpO1xucmVxdWlyZSgnZG90ZW52JykuY29uZmlnKHtcbiAgICBwYXRoOiBgLmVudi4ke3Byb2Nlc3MuZW52Lk5PREVfRU5WfWBcbiB9KTtcbmNvbnN0IFBPUlQgPSBwcm9jZXNzLmVudi5QT1JUO1xuY29uc3Qgc2VydmVyID0gYXBwLmxpc3RlbihQT1JULCAoKSA9PiB7XG5cdGNvbnNvbGUubG9nKGDwn46J8J+OifCfjokgQXBwbGljYXRpb24gcnVubmluZyBvbiBFTlYgOiAke3Byb2Nlc3MuZW52Lk5PREVfRU5WfSAtIFBvcnQ6ICR7UE9SVH0g8J+OifCfjonwn46JYCk7XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSBzZXJ2ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDaENBLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQ0MsTUFBTSxDQUFDO0VBQ3JCQyxJQUFJLEVBQUcsUUFBT0MsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVM7QUFDdEMsQ0FBQyxDQUFDO0FBQ0gsTUFBTUMsSUFBSSxHQUFHSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0UsSUFBSTtBQUM3QixNQUFNQyxNQUFNLEdBQUdSLEdBQUcsQ0FBQ1MsTUFBTSxDQUFDRixJQUFJLEVBQUUsTUFBTTtFQUNyQ0csT0FBTyxDQUFDQyxHQUFHLENBQUUsdUNBQXNDUCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsUUFBUyxZQUFXQyxJQUFLLFNBQVEsQ0FBQztBQUNsRyxDQUFDLENBQUM7QUFFRkssTUFBTSxDQUFDQyxPQUFPLEdBQUdMLE1BQU0ifQ==","map":{"version":3,"names":["app","require","config","path","process","env","NODE_ENV","PORT","server","listen","console","log","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/","sources":["server.js"],"sourcesContent":["const app = require('./src/app');\nrequire('dotenv').config({\n    path: `.env.${process.env.NODE_ENV}`\n });\nconst PORT = process.env.PORT;\nconst server = app.listen(PORT, () => {\n\tconsole.log(`ðŸŽ‰ðŸŽ‰ðŸŽ‰ Application running on ENV : ${process.env.NODE_ENV} - Port: ${PORT} ðŸŽ‰ðŸŽ‰ðŸŽ‰`);\n});\n\nmodule.exports = server;"],"mappings":"AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAC,WAAW,CAAC;AAChCA,OAAO,CAAC,QAAQ,CAAC,CAACC,MAAM,CAAC;EACrBC,IAAI,EAAG,QAAOC,OAAO,CAACC,GAAG,CAACC,QAAS;AACtC,CAAC,CAAC;AACH,MAAMC,IAAI,GAAGH,OAAO,CAACC,GAAG,CAACE,IAAI;AAC7B,MAAMC,MAAM,GAAGR,GAAG,CAACS,MAAM,CAACF,IAAI,EAAE,MAAM;EACrCG,OAAO,CAACC,GAAG,CAAE,uCAAsCP,OAAO,CAACC,GAAG,CAACC,QAAS,YAAWC,IAAK,SAAQ,CAAC;AAClG,CAAC,CAAC;AAEFK,MAAM,CAACC,OAAO,GAAGL,MAAM"}},"mtime":1692818770391},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/app.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"require('dotenv').config({\n  path: `.env.${process.env.NODE_ENV}`\n});\nconst path = require('path');\nconst Koa = require('koa');\nconst Router = require('koa-router');\nconst bodyParser = require('koa-bodyparser');\nconst helmet = require('koa-helmet');\nconst compress = require('koa-compress');\nconst {\n  koaSwagger\n} = require('koa2-swagger-ui');\nconst $RefParser = require('json-schema-ref-parser');\nconst {\n  server,\n  db\n} = require('./configs');\nconst cors = require('@koa/cors');\n\n// Routers and Middleware\nconst routers = require('./routers');\nconst authMiddleware = require('./middleware/auth.middleware');\nconst errorMiddleware = require('./middleware/error.middleware');\nconst app = new Koa();\nconst router = new Router();\n$RefParser.dereference(path.join(__dirname, '../docs/index.json')).then(openApiDoc => {\n  router.get('/', ctx => {\n    ctx.body = {\n      alive: true\n    };\n  });\n  app.use(cors({\n    origin: '*',\n    // allow requests from any origin\n    allowMethods: ['GET', 'POST', 'PUT', 'DELETE'],\n    // allow these HTTP methods\n    allowHeaders: ['Content-Type', 'Authorization'] // allow these headers\n  }));\n\n  app.use(router.routes()).use(router.allowedMethods());\n  app.use(koaSwagger({\n    routePrefix: '/_docs',\n    // host at /_docs\n    swaggerOptions: {\n      spec: openApiDoc\n    }\n  }));\n\n  // à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¹€à¸žà¸·à¹ˆà¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š router à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸«à¹‰à¸£à¸§à¸¡à¸–à¸¶à¸‡ ## /login , /register\n  // app.use(authMiddleware);\n\n  app.use(errorMiddleware);\n  app.use(bodyParser());\n  app.use(helmet());\n  app.use(compress());\n  app.use(routers);\n}).catch(err => {\n  console.error(\"Failed to load OpenAPI documentation\", err);\n});\nmodule.exports = app;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXF1aXJlIiwiY29uZmlnIiwicGF0aCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsIktvYSIsIlJvdXRlciIsImJvZHlQYXJzZXIiLCJoZWxtZXQiLCJjb21wcmVzcyIsImtvYVN3YWdnZXIiLCIkUmVmUGFyc2VyIiwic2VydmVyIiwiZGIiLCJjb3JzIiwicm91dGVycyIsImF1dGhNaWRkbGV3YXJlIiwiZXJyb3JNaWRkbGV3YXJlIiwiYXBwIiwicm91dGVyIiwiZGVyZWZlcmVuY2UiLCJqb2luIiwiX19kaXJuYW1lIiwidGhlbiIsIm9wZW5BcGlEb2MiLCJnZXQiLCJjdHgiLCJib2R5IiwiYWxpdmUiLCJ1c2UiLCJvcmlnaW4iLCJhbGxvd01ldGhvZHMiLCJhbGxvd0hlYWRlcnMiLCJyb3V0ZXMiLCJhbGxvd2VkTWV0aG9kcyIsInJvdXRlUHJlZml4Iiwic3dhZ2dlck9wdGlvbnMiLCJzcGVjIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvbWFjcHJvL0Rlc2t0b3AvSW5mb21hdGlvbi9UZXN0L25vZGUtYmFjay1lbmQvc3JjLyIsInNvdXJjZXMiOlsiYXBwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZyh7XG4gICAgcGF0aDogYC5lbnYuJHtwcm9jZXNzLmVudi5OT0RFX0VOVn1gXG59KTtcblxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IEtvYSA9IHJlcXVpcmUoJ2tvYScpOyBcbmNvbnN0IFJvdXRlciA9IHJlcXVpcmUoJ2tvYS1yb3V0ZXInKTtcbmNvbnN0IGJvZHlQYXJzZXIgPSByZXF1aXJlKCdrb2EtYm9keXBhcnNlcicpO1xuY29uc3QgaGVsbWV0ID0gcmVxdWlyZSgna29hLWhlbG1ldCcpO1xuY29uc3QgY29tcHJlc3MgPSByZXF1aXJlKCdrb2EtY29tcHJlc3MnKTtcbmNvbnN0IHsga29hU3dhZ2dlciB9ID0gcmVxdWlyZSgna29hMi1zd2FnZ2VyLXVpJyk7XG5jb25zdCAkUmVmUGFyc2VyID0gcmVxdWlyZSgnanNvbi1zY2hlbWEtcmVmLXBhcnNlcicpO1xuY29uc3QgeyBzZXJ2ZXIsIGRiIH0gPSByZXF1aXJlKCcuL2NvbmZpZ3MnKTsgIFxuY29uc3QgY29ycyA9IHJlcXVpcmUoJ0Brb2EvY29ycycpO1xuXG4vLyBSb3V0ZXJzIGFuZCBNaWRkbGV3YXJlXG5jb25zdCByb3V0ZXJzID0gcmVxdWlyZSgnLi9yb3V0ZXJzJyk7XG5jb25zdCBhdXRoTWlkZGxld2FyZSA9IHJlcXVpcmUoJy4vbWlkZGxld2FyZS9hdXRoLm1pZGRsZXdhcmUnKTtcbmNvbnN0IGVycm9yTWlkZGxld2FyZSA9IHJlcXVpcmUoJy4vbWlkZGxld2FyZS9lcnJvci5taWRkbGV3YXJlJyk7XG5cbmNvbnN0IGFwcCA9IG5ldyBLb2EoKTtcbmNvbnN0IHJvdXRlciA9IG5ldyBSb3V0ZXIoKTsgXG5cbiRSZWZQYXJzZXIuZGVyZWZlcmVuY2UocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2RvY3MvaW5kZXguanNvbicpKVxuICAgIC50aGVuKChvcGVuQXBpRG9jKSA9PiB7XG4gXG4gICAgICAgIHJvdXRlci5nZXQoJy8nLCAoY3R4KSA9PiB7XG4gICAgICAgICAgICBjdHguYm9keSA9IHtcbiAgICAgICAgICAgICAgICBhbGl2ZTogdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBhcHAudXNlKGNvcnMoe1xuICAgICAgICAgICAgb3JpZ2luOiAnKicsIC8vIGFsbG93IHJlcXVlc3RzIGZyb20gYW55IG9yaWdpblxuICAgICAgICAgICAgYWxsb3dNZXRob2RzOiBbJ0dFVCcsICdQT1NUJywgJ1BVVCcsICdERUxFVEUnXSwgLy8gYWxsb3cgdGhlc2UgSFRUUCBtZXRob2RzXG4gICAgICAgICAgICBhbGxvd0hlYWRlcnM6IFsnQ29udGVudC1UeXBlJywgJ0F1dGhvcml6YXRpb24nXSwgLy8gYWxsb3cgdGhlc2UgaGVhZGVyc1xuICAgICAgICB9KSk7XG4gICAgICAgICAgXG4gICAgICAgIGFwcC51c2Uocm91dGVyLnJvdXRlcygpKS51c2Uocm91dGVyLmFsbG93ZWRNZXRob2RzKCkpO1xuXG4gICAgICAgIGFwcC51c2UoXG4gICAgICAgICAgICBrb2FTd2FnZ2VyKHtcbiAgICAgICAgICAgICAgICByb3V0ZVByZWZpeDogJy9fZG9jcycsIC8vIGhvc3QgYXQgL19kb2NzXG4gICAgICAgICAgICAgICAgc3dhZ2dlck9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3BlYzogb3BlbkFwaURvYyxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSksXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8g4LmA4Lib4Li04LiU4LmD4LiK4LmJ4LmA4Lie4Li34LmI4Lit4LiV4Lij4Lin4LiI4Liq4Lit4LiaIHJvdXRlciDguJfguLHguYnguIfguKvguKHguJTguYPguKvguYnguKPguKfguKHguJbguLbguIcgIyMgL2xvZ2luICwgL3JlZ2lzdGVyXG4gICAgICAgIC8vIGFwcC51c2UoYXV0aE1pZGRsZXdhcmUpO1xuXG4gICAgICAgIGFwcC51c2UoZXJyb3JNaWRkbGV3YXJlKVxuICAgICAgICBhcHAudXNlKGJvZHlQYXJzZXIoKSlcbiAgICAgICAgYXBwLnVzZShoZWxtZXQoKSlcbiAgICAgICAgYXBwLnVzZShjb21wcmVzcygpKVxuICAgICAgICBcbiAgICAgICAgYXBwLnVzZShyb3V0ZXJzKVxuICAgICAgICBcblxuICAgIH0pXG4gICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBPcGVuQVBJIGRvY3VtZW50YXRpb25cIiwgZXJyKTtcbiAgICB9KTtcblxubW9kdWxlLmV4cG9ydHMgPSBhcHA7XG4iXSwibWFwcGluZ3MiOiJBQUFBQSxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUNDLE1BQU0sQ0FBQztFQUNyQkMsSUFBSSxFQUFH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","map":{"version":3,"names":["require","config","path","process","env","NODE_ENV","Koa","Router","bodyParser","helmet","compress","koaSwagger","$RefParser","server","db","cors","routers","authMiddleware","errorMiddleware","app","router","dereference","join","__dirname","then","openApiDoc","get","ctx","body","alive","use","origin","allowMethods","allowHeaders","routes","allowedMethods","routePrefix","swaggerOptions","spec","catch","err","console","error","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/","sources":["app.js"],"sourcesContent":["require('dotenv').config({\n    path: `.env.${process.env.NODE_ENV}`\n});\n\nconst path = require('path');\nconst Koa = require('koa'); \nconst Router = require('koa-router');\nconst bodyParser = require('koa-bodyparser');\nconst helmet = require('koa-helmet');\nconst compress = require('koa-compress');\nconst { koaSwagger } = require('koa2-swagger-ui');\nconst $RefParser = require('json-schema-ref-parser');\nconst { server, db } = require('./configs');  \nconst cors = require('@koa/cors');\n\n// Routers and Middleware\nconst routers = require('./routers');\nconst authMiddleware = require('./middleware/auth.middleware');\nconst errorMiddleware = require('./middleware/error.middleware');\n\nconst app = new Koa();\nconst router = new Router(); \n\n$RefParser.dereference(path.join(__dirname, '../docs/index.json'))\n    .then((openApiDoc) => {\n \n        router.get('/', (ctx) => {\n            ctx.body = {\n                alive: true\n            }\n        });\n\n        app.use(cors({\n            origin: '*', // allow requests from any origin\n            allowMethods: ['GET', 'POST', 'PUT', 'DELETE'], // allow these HTTP methods\n            allowHeaders: ['Content-Type', 'Authorization'], // allow these headers\n        }));\n          \n        app.use(router.routes()).use(router.allowedMethods());\n\n        app.use(\n            koaSwagger({\n                routePrefix: '/_docs', // host at /_docs\n                swaggerOptions: {\n                    spec: openApiDoc,\n                },\n            }),\n        );\n\n        // à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¹€à¸žà¸·à¹ˆà¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š router à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”à¹ƒà¸«à¹‰à¸£à¸§à¸¡à¸–à¸¶à¸‡ ## /login , /register\n        // app.use(authMiddleware);\n\n        app.use(errorMiddleware)\n        app.use(bodyParser())\n        app.use(helmet())\n        app.use(compress())\n        \n        app.use(routers)\n        \n\n    })\n    .catch(err => {\n        console.error(\"Failed to load OpenAPI documentation\", err);\n    });\n\nmodule.exports = app;\n"],"mappings":"AAAAA,OAAO,CAAC,QAAQ,CAAC,CAACC,MAAM,CAAC;EACrBC,IAAI,EAAG,QAAOC,OAAO,CAACC,GAAG,CAACC,QAAS;AACvC,CAAC,CAAC;AAEF,MAAMH,IAAI,GAAGF,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMM,GAAG,GAAGN,OAAO,CAAC,KAAK,CAAC;AAC1B,MAAMO,MAAM,GAAGP,OAAO,CAAC,YAAY,CAAC;AACpC,MAAMQ,UAAU,GAAGR,OAAO,CAAC,gBAAgB,CAAC;AAC5C,MAAMS,MAAM,GAAGT,OAAO,CAAC,YAAY,CAAC;AACpC,MAAMU,QAAQ,GAAGV,OAAO,CAAC,cAAc,CAAC;AACxC,MAAM;EAAEW;AAAW,CAAC,GAAGX,OAAO,CAAC,iBAAiB,CAAC;AACjD,MAAMY,UAAU,GAAGZ,OAAO,CAAC,wBAAwB,CAAC;AACpD,MAAM;EAAEa,MAAM;EAAEC;AAAG,CAAC,GAAGd,OAAO,CAAC,WAAW,CAAC;AAC3C,MAAMe,IAAI,GAAGf,OAAO,CAAC,WAAW,CAAC;;AAEjC;AACA,MAAMgB,OAAO,GAAGhB,OAAO,CAAC,WAAW,CAAC;AACpC,MAAMiB,cAAc,GAAGjB,OAAO,CAAC,8BAA8B,CAAC;AAC9D,MAAMkB,eAAe,GAAGlB,OAAO,CAAC,+BAA+B,CAAC;AAEhE,MAAMmB,GAAG,GAAG,IAAIb,GAAG,CAAC,CAAC;AACrB,MAAMc,MAAM,GAAG,IAAIb,MAAM,CAAC,CAAC;AAE3BK,UAAU,CAACS,WAAW,CAACnB,IAAI,CAACoB,IAAI,CAACC,SAAS,EAAE,oBAAoB,CAAC,CAAC,CAC7DC,IAAI,CAAEC,UAAU,IAAK;EAElBL,MAAM,CAACM,GAAG,CAAC,GAAG,EAAGC,GAAG,IAAK;IACrBA,GAAG,CAACC,IAAI,GAAG;MACPC,KAAK,EAAE;IACX,CAAC;EACL,CAAC,CAAC;EAEFV,GAAG,CAACW,GAAG,CAACf,IAAI,CAAC;IACTgB,MAAM,EAAE,GAAG;IAAE;IACbC,YAAY,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,CAAC;IAAE;IAChDC,YAAY,EAAE,CAAC,cAAc,EAAE,eAAe,CAAC,CAAE;EACrD,CAAC,CAAC,CAAC;;EAEHd,GAAG,CAACW,GAAG,CAACV,MAAM,CAACc,MAAM,CAAC,CAAC,CAAC,CAACJ,GAAG,CAACV,MAAM,CAACe,cAAc,CAAC,CAAC,CAAC;EAErDhB,GAAG,CAACW,GAAG,CACHnB,UAAU,CAAC;IACPyB,WAAW,EAAE,QAAQ;IAAE;IACvBC,cAAc,EAAE;MACZC,IAAI,EAAEb;IACV;EACJ,CAAC,CACL,CAAC;;EAED;EACA;;EAEAN,GAAG,CAACW,GAAG,CAACZ,eAAe,CAAC;EACxBC,GAAG,CAACW,GAAG,CAACtB,UAAU,CAAC,CAAC,CAAC;EACrBW,GAAG,CAACW,GAAG,CAACrB,MAAM,CAAC,CAAC,CAAC;EACjBU,GAAG,CAACW,GAAG,CAACpB,QAAQ,CAAC,CAAC,CAAC;EAEnBS,GAAG,CAACW,GAAG,CAACd,OAAO,CAAC;AAGpB,CAAC,CAAC,CACDuB,KAAK,CAACC,GAAG,IAAI;EACVC,OAAO,CAACC,KAAK,CAAC,sCAAsC,EAAEF,GAAG,CAAC;AAC9D,CAAC,CAAC;AAENG,MAAM,CAACC,OAAO,GAAGzB,GAAG"}},"mtime":1692897420841},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/configs/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/configs/index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const database = require('./firebaseConfig');\nmodule.exports = {\n  server: {\n    PORT: process.env.PORT\n  },\n  secret: 'origin-test',\n  firebase: database\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkYXRhYmFzZSIsInJlcXVpcmUiLCJtb2R1bGUiLCJleHBvcnRzIiwic2VydmVyIiwiUE9SVCIsInByb2Nlc3MiLCJlbnYiLCJzZWNyZXQiLCJmaXJlYmFzZSJdLCJzb3VyY2VSb290IjoiL1VzZXJzL21hY3Byby9EZXNrdG9wL0luZm9tYXRpb24vVGVzdC9ub2RlLWJhY2stZW5kL3NyYy9jb25maWdzLyIsInNvdXJjZXMiOlsiaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZGF0YWJhc2UgPSByZXF1aXJlKCcuL2ZpcmViYXNlQ29uZmlnJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBzZXJ2ZXI6IHtcbiAgICBQT1JUOiBwcm9jZXNzLmVudi5QT1JULFxuICB9LFxuICBzZWNyZXQ6ICdvcmlnaW4tdGVzdCcsXG4gIGZpcmViYXNlOiBkYXRhYmFzZVxufTsiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBRTVDQyxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNmQyxNQUFNLEVBQUU7SUFDTkMsSUFBSSxFQUFFQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0Y7RUFDcEIsQ0FBQztFQUNERyxNQUFNLEVBQUUsYUFBYTtFQUNyQkMsUUFBUSxFQUFFVDtBQUNaLENBQUMifQ==","map":{"version":3,"names":["database","require","module","exports","server","PORT","process","env","secret","firebase"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/configs/","sources":["index.js"],"sourcesContent":["const database = require('./firebaseConfig');\n\nmodule.exports = {\n  server: {\n    PORT: process.env.PORT,\n  },\n  secret: 'origin-test',\n  firebase: database\n};"],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,kBAAkB,CAAC;AAE5CC,MAAM,CAACC,OAAO,GAAG;EACfC,MAAM,EAAE;IACNC,IAAI,EAAEC,OAAO,CAACC,GAAG,CAACF;EACpB,CAAC;EACDG,MAAM,EAAE,aAAa;EACrBC,QAAQ,EAAET;AACZ,CAAC"}},"mtime":1692801303325},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/configs/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/configs/firebaseConfig.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const {\n  initializeApp\n} = require(\"firebase/app\");\nconst {\n  getDatabase\n} = require(\"firebase/database\");\nconst firebaseConfig = {\n  apiKey: process.env.APIKEY,\n  authDomain: process.env.AUTHDOMAIN,\n  databaseURL: process.env.DATABASEURL,\n  projectId: process.env.PROJECTID,\n  storageBucket: process.env.STORAGEBUCKET,\n  messagingSenderId: process.env.MESSAGINGSENDERID,\n  appId: process.env.APPID,\n  measurementId: process.env.MEASUREMENTID\n};\nconst app = initializeApp(firebaseConfig);\nconst database = getDatabase(app);\nmodule.exports = database;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpbml0aWFsaXplQXBwIiwicmVxdWlyZSIsImdldERhdGFiYXNlIiwiZmlyZWJhc2VDb25maWciLCJhcGlLZXkiLCJwcm9jZXNzIiwiZW52IiwiQVBJS0VZIiwiYXV0aERvbWFpbiIsIkFVVEhET01BSU4iLCJkYXRhYmFzZVVSTCIsIkRBVEFCQVNFVVJMIiwicHJvamVjdElkIiwiUFJPSkVDVElEIiwic3RvcmFnZUJ1Y2tldCIsIlNUT1JBR0VCVUNLRVQiLCJtZXNzYWdpbmdTZW5kZXJJZCIsIk1FU1NBR0lOR1NFTkRFUklEIiwiYXBwSWQiLCJBUFBJRCIsIm1lYXN1cmVtZW50SWQiLCJNRUFTVVJFTUVOVElEIiwiYXBwIiwiZGF0YWJhc2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvbWFjcHJvL0Rlc2t0b3AvSW5mb21hdGlvbi9UZXN0L25vZGUtYmFjay1lbmQvc3JjL2NvbmZpZ3MvIiwic291cmNlcyI6WyJmaXJlYmFzZUNvbmZpZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IGluaXRpYWxpemVBcHAgfSA9IHJlcXVpcmUoXCJmaXJlYmFzZS9hcHBcIik7XG5jb25zdCB7IGdldERhdGFiYXNlIH0gPSByZXF1aXJlKFwiZmlyZWJhc2UvZGF0YWJhc2VcIik7IFxuXG5jb25zdCBmaXJlYmFzZUNvbmZpZyA9IHtcbiAgICBhcGlLZXk6IHByb2Nlc3MuZW52LkFQSUtFWSxcbiAgICBhdXRoRG9tYWluOiBwcm9jZXNzLmVudi5BVVRIRE9NQUlOLFxuICAgIGRhdGFiYXNlVVJMOiBwcm9jZXNzLmVudi5EQVRBQkFTRVVSTCxcbiAgICBwcm9qZWN0SWQ6IHByb2Nlc3MuZW52LlBST0pFQ1RJRCxcbiAgICBzdG9yYWdlQnVja2V0OiBwcm9jZXNzLmVudi5TVE9SQUdFQlVDS0VULFxuICAgIG1lc3NhZ2luZ1NlbmRlcklkOiBwcm9jZXNzLmVudi5NRVNTQUdJTkdTRU5ERVJJRCxcbiAgICBhcHBJZDogcHJvY2Vzcy5lbnYuQVBQSUQsXG4gICAgbWVhc3VyZW1lbnRJZDogcHJvY2Vzcy5lbnYuTUVBU1VSRU1FTlRJRFxufTtcblxuY29uc3QgYXBwID0gaW5pdGlhbGl6ZUFwcChmaXJlYmFzZUNvbmZpZyk7XG4gXG5jb25zdCBkYXRhYmFzZSA9IGdldERhdGFiYXNlKGFwcCk7IFxubW9kdWxlLmV4cG9ydHMgPSBkYXRhYmFzZTsgXG4iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU07RUFBRUE7QUFBYyxDQUFDLEdBQUdDLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDakQsTUFBTTtFQUFFQztBQUFZLENBQUMsR0FBR0QsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBRXBELE1BQU1FLGNBQWMsR0FBRztFQUNuQkMsTUFBTSxFQUFFQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsTUFBTTtFQUMxQkMsVUFBVSxFQUFFSCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0csVUFBVTtFQUNsQ0MsV0FBVyxFQUFFTCxPQUFPLENBQUNDLEdBQUcsQ0FBQ0ssV0FBVztFQUNwQ0MsU0FBUyxFQUFFUCxPQUFPLENBQUNDLEdBQUcsQ0FBQ08sU0FBUztFQUNoQ0MsYUFBYSxFQUFFVCxPQUFPLENBQUNDLEdBQUcsQ0FBQ1MsYUFBYTtFQUN4Q0MsaUJBQWlCLEVBQUVYLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDVyxpQkFBaUI7RUFDaERDLEtBQUssRUFBRWIsT0FBTyxDQUFDQyxHQUFHLENBQUNhLEtBQUs7RUFDeEJDLGFBQWEsRUFBRWYsT0FBTyxDQUFDQyxHQUFHLENBQUNlO0FBQy9CLENBQUM7QUFFRCxNQUFNQyxHQUFHLEdBQUd0QixhQUFhLENBQUNHLGNBQWMsQ0FBQztBQUV6QyxNQUFNb0IsUUFBUSxHQUFHckIsV0FBVyxDQUFDb0IsR0FBRyxDQUFDO0FBQ2pDRSxNQUFNLENBQUNDLE9BQU8sR0FBR0YsUUFBUSJ9","map":{"version":3,"names":["initializeApp","require","getDatabase","firebaseConfig","apiKey","process","env","APIKEY","authDomain","AUTHDOMAIN","databaseURL","DATABASEURL","projectId","PROJECTID","storageBucket","STORAGEBUCKET","messagingSenderId","MESSAGINGSENDERID","appId","APPID","measurementId","MEASUREMENTID","app","database","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/configs/","sources":["firebaseConfig.js"],"sourcesContent":["const { initializeApp } = require(\"firebase/app\");\nconst { getDatabase } = require(\"firebase/database\"); \n\nconst firebaseConfig = {\n    apiKey: process.env.APIKEY,\n    authDomain: process.env.AUTHDOMAIN,\n    databaseURL: process.env.DATABASEURL,\n    projectId: process.env.PROJECTID,\n    storageBucket: process.env.STORAGEBUCKET,\n    messagingSenderId: process.env.MESSAGINGSENDERID,\n    appId: process.env.APPID,\n    measurementId: process.env.MEASUREMENTID\n};\n\nconst app = initializeApp(firebaseConfig);\n \nconst database = getDatabase(app); \nmodule.exports = database; \n"],"mappings":"AAAA,MAAM;EAAEA;AAAc,CAAC,GAAGC,OAAO,CAAC,cAAc,CAAC;AACjD,MAAM;EAAEC;AAAY,CAAC,GAAGD,OAAO,CAAC,mBAAmB,CAAC;AAEpD,MAAME,cAAc,GAAG;EACnBC,MAAM,EAAEC,OAAO,CAACC,GAAG,CAACC,MAAM;EAC1BC,UAAU,EAAEH,OAAO,CAACC,GAAG,CAACG,UAAU;EAClCC,WAAW,EAAEL,OAAO,CAACC,GAAG,CAACK,WAAW;EACpCC,SAAS,EAAEP,OAAO,CAACC,GAAG,CAACO,SAAS;EAChCC,aAAa,EAAET,OAAO,CAACC,GAAG,CAACS,aAAa;EACxCC,iBAAiB,EAAEX,OAAO,CAACC,GAAG,CAACW,iBAAiB;EAChDC,KAAK,EAAEb,OAAO,CAACC,GAAG,CAACa,KAAK;EACxBC,aAAa,EAAEf,OAAO,CAACC,GAAG,CAACe;AAC/B,CAAC;AAED,MAAMC,GAAG,GAAGtB,aAAa,CAACG,cAAc,CAAC;AAEzC,MAAMoB,QAAQ,GAAGrB,WAAW,CAACoB,GAAG,CAAC;AACjCE,MAAM,CAACC,OAAO,GAAGF,QAAQ"}},"mtime":1692809276713},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const fs = require('fs');\nconst path = require('path');\nconst Router = require('koa-joi-router');\nconst {\n  SwaggerAPI\n} = require('koa-joi-router-docs');\nconst swaggerAPI = new SwaggerAPI();\nconst api = Router();\nfs.readdirSync(__dirname).filter(file => {\n  return file.indexOf('.') !== 0 && file !== 'index.js' &&\n  // exclude this file\n  file.slice(-10) === '.router.js' // only include .router.js files\n  ;\n}).forEach(file => {\n  const route = require(path.join(__dirname, file));\n  api.use(route.middleware());\n  swaggerAPI.addJoiRouter(route);\n});\nmodule.exports = api.middleware();\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJwYXRoIiwiUm91dGVyIiwiU3dhZ2dlckFQSSIsInN3YWdnZXJBUEkiLCJhcGkiLCJyZWFkZGlyU3luYyIsIl9fZGlybmFtZSIsImZpbHRlciIsImZpbGUiLCJpbmRleE9mIiwic2xpY2UiLCJmb3JFYWNoIiwicm91dGUiLCJqb2luIiwidXNlIiwibWlkZGxld2FyZSIsImFkZEpvaVJvdXRlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6Ii9Vc2Vycy9tYWNwcm8vRGVza3RvcC9JbmZvbWF0aW9uL1Rlc3Qvbm9kZS1iYWNrLWVuZC9zcmMvcm91dGVycy8iLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCBSb3V0ZXIgPSByZXF1aXJlKCdrb2Etam9pLXJvdXRlcicpIFxuY29uc3Qge1N3YWdnZXJBUEl9ID0gcmVxdWlyZSgna29hLWpvaS1yb3V0ZXItZG9jcycpXG4gXG5jb25zdCBzd2FnZ2VyQVBJID0gbmV3IFN3YWdnZXJBUEkoKSAgXG5jb25zdCBhcGkgPSBSb3V0ZXIoKSBcbiAgXG5mcy5yZWFkZGlyU3luYyhfX2Rpcm5hbWUpXG4gIC5maWx0ZXIoZmlsZSA9PiB7XG4gICAgcmV0dXJuIChcbiAgICAgIGZpbGUuaW5kZXhPZignLicpICE9PSAwICYmXG4gICAgICBmaWxlICE9PSAnaW5kZXguanMnICYmIC8vIGV4Y2x1ZGUgdGhpcyBmaWxlXG4gICAgICBmaWxlLnNsaWNlKC0xMCkgPT09ICcucm91dGVyLmpzJyAvLyBvbmx5IGluY2x1ZGUgLnJvdXRlci5qcyBmaWxlc1xuICAgICk7XG4gIH0pXG4gIC5mb3JFYWNoKGZpbGUgPT4geyAgXG4gICAgY29uc3Qgcm91dGUgPSByZXF1aXJlKHBhdGguam9pbihfX2Rpcm5hbWUsIGZpbGUpKSBcbiAgICBhcGkudXNlKHJvdXRlLm1pZGRsZXdhcmUoKSlcbiAgICBzd2FnZ2VyQVBJLmFkZEpvaVJvdXRlcihyb3V0ZSlcbiAgICBcbiAgfSk7XG5cbm1vZHVsZS5leHBvcnRzID0gYXBpLm1pZGRsZXdhcmUoKTsgXG4iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLEVBQUUsR0FBR0MsT0FBTyxDQUFDLElBQUksQ0FBQztBQUN4QixNQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxNQUFNLENBQUM7QUFDNUIsTUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDeEMsTUFBTTtFQUFDRztBQUFVLENBQUMsR0FBR0gsT0FBTyxDQUFDLHFCQUFxQixDQUFDO0FBRW5ELE1BQU1JLFVBQVUsR0FBRyxJQUFJRCxVQUFVLENBQUMsQ0FBQztBQUNuQyxNQUFNRSxHQUFHLEdBQUdILE1BQU0sQ0FBQyxDQUFDO0FBRXBCSCxFQUFFLENBQUNPLFdBQVcsQ0FBQ0MsU0FBUyxDQUFDLENBQ3RCQyxNQUFNLENBQUNDLElBQUksSUFBSTtFQUNkLE9BQ0VBLElBQUksQ0FBQ0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFDdkJELElBQUksS0FBSyxVQUFVO0VBQUk7RUFDdkJBLElBQUksQ0FBQ0UsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssWUFBWSxDQUFDO0VBQUE7QUFFckMsQ0FBQyxDQUFDLENBQ0RDLE9BQU8sQ0FBQ0gsSUFBSSxJQUFJO0VBQ2YsTUFBTUksS0FBSyxHQUFHYixPQUFPLENBQUNDLElBQUksQ0FBQ2EsSUFBSSxDQUFDUCxTQUFTLEVBQUVFLElBQUksQ0FBQyxDQUFDO0VBQ2pESixHQUFHLENBQUNVLEdBQUcsQ0FBQ0YsS0FBSyxDQUFDRyxVQUFVLENBQUMsQ0FBQyxDQUFDO0VBQzNCWixVQUFVLENBQUNhLFlBQVksQ0FBQ0osS0FBSyxDQUFDO0FBRWhDLENBQUMsQ0FBQztBQUVKSyxNQUFNLENBQUNDLE9BQU8sR0FBR2QsR0FBRyxDQUFDVyxVQUFVLENBQUMsQ0FBQyJ9","map":{"version":3,"names":["fs","require","path","Router","SwaggerAPI","swaggerAPI","api","readdirSync","__dirname","filter","file","indexOf","slice","forEach","route","join","use","middleware","addJoiRouter","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/","sources":["index.js"],"sourcesContent":["const fs = require('fs');\nconst path = require('path');\nconst Router = require('koa-joi-router') \nconst {SwaggerAPI} = require('koa-joi-router-docs')\n \nconst swaggerAPI = new SwaggerAPI()  \nconst api = Router() \n  \nfs.readdirSync(__dirname)\n  .filter(file => {\n    return (\n      file.indexOf('.') !== 0 &&\n      file !== 'index.js' && // exclude this file\n      file.slice(-10) === '.router.js' // only include .router.js files\n    );\n  })\n  .forEach(file => {  \n    const route = require(path.join(__dirname, file)) \n    api.use(route.middleware())\n    swaggerAPI.addJoiRouter(route)\n    \n  });\n\nmodule.exports = api.middleware(); \n"],"mappings":"AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;AACxB,MAAMC,IAAI,GAAGD,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAME,MAAM,GAAGF,OAAO,CAAC,gBAAgB,CAAC;AACxC,MAAM;EAACG;AAAU,CAAC,GAAGH,OAAO,CAAC,qBAAqB,CAAC;AAEnD,MAAMI,UAAU,GAAG,IAAID,UAAU,CAAC,CAAC;AACnC,MAAME,GAAG,GAAGH,MAAM,CAAC,CAAC;AAEpBH,EAAE,CAACO,WAAW,CAACC,SAAS,CAAC,CACtBC,MAAM,CAACC,IAAI,IAAI;EACd,OACEA,IAAI,CAACC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IACvBD,IAAI,KAAK,UAAU;EAAI;EACvBA,IAAI,CAACE,KAAK,CAAC,CAAC,EAAE,CAAC,KAAK,YAAY,CAAC;EAAA;AAErC,CAAC,CAAC,CACDC,OAAO,CAACH,IAAI,IAAI;EACf,MAAMI,KAAK,GAAGb,OAAO,CAACC,IAAI,CAACa,IAAI,CAACP,SAAS,EAAEE,IAAI,CAAC,CAAC;EACjDJ,GAAG,CAACU,GAAG,CAACF,KAAK,CAACG,UAAU,CAAC,CAAC,CAAC;EAC3BZ,UAAU,CAACa,YAAY,CAACJ,KAAK,CAAC;AAEhC,CAAC,CAAC;AAEJK,MAAM,CAACC,OAAO,GAAGd,GAAG,CAACW,UAAU,CAAC,CAAC"}},"mtime":1689654376811},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/orders.router.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const Router = require(\"koa-joi-router\");\nconst {\n  createOrder,\n  getOrderByTransactionNo,\n  getOrders,\n  deleteOrder\n} = require(\"../controllers/orders.controller\");\nconst authMiddleware = require(\"../middleware/auth.middleware\");\nconst {\n  validateSchema\n} = require('../commons/validate');\nconst path = require('path');\nconst filename = path.basename(__filename).split('.')[0];\nconst directory = `../../docs/schemas/${filename}/Request/`;\nconst api = Router();\napi.prefix(\"/orders\");\napi.route({\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: 'GET',\n  path: '/',\n  handler: getOrders\n});\napi.route({\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: 'POST',\n  path: '/',\n  validate: validateSchema(directory + 'createOrder.json'),\n  handler: createOrder\n});\napi.route({\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: 'GET',\n  path: '/:transactionNo',\n  handler: getOrderByTransactionNo\n});\napi.route({\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: 'DELETE',\n  path: '/:transactionNo',\n  handler: deleteOrder\n});\nmodule.exports = api;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSb3V0ZXIiLCJyZXF1aXJlIiwiY3JlYXRlT3JkZXIiLCJnZXRPcmRlckJ5VHJhbnNhY3Rpb25ObyIsImdldE9yZGVycyIsImRlbGV0ZU9yZGVyIiwiYXV0aE1pZGRsZXdhcmUiLCJ2YWxpZGF0ZVNjaGVtYSIsInBhdGgiLCJmaWxlbmFtZSIsImJhc2VuYW1lIiwiX19maWxlbmFtZSIsInNwbGl0IiwiZGlyZWN0b3J5IiwiYXBpIiwicHJlZml4Iiwicm91dGUiLCJwcmUiLCJjdHgiLCJuZXh0IiwibWV0aG9kIiwiaGFuZGxlciIsInZhbGlkYXRlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiL1VzZXJzL21hY3Byby9EZXNrdG9wL0luZm9tYXRpb24vVGVzdC9ub2RlLWJhY2stZW5kL3NyYy9yb3V0ZXJzLyIsInNvdXJjZXMiOlsib3JkZXJzLnJvdXRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBSb3V0ZXIgPSByZXF1aXJlKFwia29hLWpvaS1yb3V0ZXJcIik7IFxuY29uc3QgeyBjcmVhdGVPcmRlciwgZ2V0T3JkZXJCeVRyYW5zYWN0aW9uTm8sIGdldE9yZGVycywgZGVsZXRlT3JkZXIgfSA9IHJlcXVpcmUoXCIuLi9jb250cm9sbGVycy9vcmRlcnMuY29udHJvbGxlclwiKTtcbmNvbnN0IGF1dGhNaWRkbGV3YXJlID0gcmVxdWlyZShcIi4uL21pZGRsZXdhcmUvYXV0aC5taWRkbGV3YXJlXCIpO1xuIFxuY29uc3QgeyB2YWxpZGF0ZVNjaGVtYSB9ID0gcmVxdWlyZSgnLi4vY29tbW9ucy92YWxpZGF0ZScpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsgXG5cbmNvbnN0IGZpbGVuYW1lID0gcGF0aC5iYXNlbmFtZShfX2ZpbGVuYW1lKS5zcGxpdCgnLicpWzBdOyBcbmNvbnN0IGRpcmVjdG9yeSA9IGAuLi8uLi9kb2NzL3NjaGVtYXMvJHtmaWxlbmFtZX0vUmVxdWVzdC9gO1xuIFxuXG5jb25zdCBhcGkgPSBSb3V0ZXIoKTtcbmFwaS5wcmVmaXgoXCIvb3JkZXJzXCIpOyBcblxuXG5hcGkucm91dGUoe1xuICAgIHByZTogYXN5bmMgKGN0eCwgbmV4dCkgPT4gYXdhaXQgYXV0aE1pZGRsZXdhcmUoY3R4LCBuZXh0KSxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIHBhdGg6ICcvJyxcbiAgICBoYW5kbGVyOiBnZXRPcmRlcnNcbn0pOyBcblxuYXBpLnJvdXRlKHtcbiAgICBwcmU6IGFzeW5jIChjdHgsIG5leHQpID0+IGF3YWl0IGF1dGhNaWRkbGV3YXJlKGN0eCwgbmV4dCksXG4gICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgcGF0aDogJy8nLFxuICAgIHZhbGlkYXRlOiAgdmFsaWRhdGVTY2hlbWEoZGlyZWN0b3J5ICsgJ2NyZWF0ZU9yZGVyLmpzb24nKSwgXG4gICAgaGFuZGxlcjogY3JlYXRlT3JkZXJcbn0pO1xuXG5hcGkucm91dGUoe1xuICAgIHByZTogYXN5bmMgKGN0eCwgbmV4dCkgPT4gYXdhaXQgYXV0aE1pZGRsZXdhcmUoY3R4LCBuZXh0KSxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIHBhdGg6ICcvOnRyYW5zYWN0aW9uTm8nLFxuICAgIGhhbmRsZXI6IGdldE9yZGVyQnlUcmFuc2FjdGlvbk5vXG59KTtcblxuYXBpLnJvdXRlKHtcbiAgICBwcmU6IGFzeW5jIChjdHgsIG5leHQpID0+IGF3YWl0IGF1dGhNaWRkbGV3YXJlKGN0eCwgbmV4dCksXG4gICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICBwYXRoOiAnLzp0cmFuc2FjdGlvbk5vJyxcbiAgICBoYW5kbGVyOiBkZWxldGVPcmRlclxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gYXBpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUN4QyxNQUFNO0VBQUVDLFdBQVc7RUFBRUMsdUJBQXVCO0VBQUVDLFNBQVM7RUFBRUM7QUFBWSxDQUFDLEdBQUdKLE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQztBQUNwSCxNQUFNSyxjQUFjLEdBQUdMLE9BQU8sQ0FBQywrQkFBK0IsQ0FBQztBQUUvRCxNQUFNO0VBQUVNO0FBQWUsQ0FBQyxHQUFHTixPQUFPLENBQUMscUJBQXFCLENBQUM7QUFDekQsTUFBTU8sSUFBSSxHQUFHUCxPQUFPLENBQUMsTUFBTSxDQUFDO0FBRTVCLE1BQU1RLFFBQVEsR0FBR0QsSUFBSSxDQUFDRSxRQUFRLENBQUNDLFVBQVUsQ0FBQyxDQUFDQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3hELE1BQU1DLFNBQVMsR0FBSSxzQkFBcUJKLFFBQVMsV0FBVTtBQUczRCxNQUFNSyxHQUFHLEdBQUdkLE1BQU0sQ0FBQyxDQUFDO0FBQ3BCYyxHQUFHLENBQUNDLE1BQU0sQ0FBQyxTQUFTLENBQUM7QUFHckJELEdBQUcsQ0FBQ0UsS0FBSyxDQUFDO0VBQ05DLEdBQUcsRUFBRSxNQUFBQSxDQUFPQyxHQUFHLEVBQUVDLElBQUksS0FBSyxNQUFNYixjQUFjLENBQUNZLEdBQUcsRUFBRUMsSUFBSSxDQUFDO0VBQ3pEQyxNQUFNLEVBQUUsS0FBSztFQUNiWixJQUFJLEVBQUUsR0FBRztFQUNUYSxPQUFPLEVBQUVqQjtBQUNiLENBQUMsQ0FBQztBQUVGVSxHQUFHLENBQUNFLEtBQUssQ0FBQztFQUNOQyxHQUFHLEVBQUUsTUFBQUEsQ0FBT0MsR0FBRyxFQUFFQyxJQUFJLEtBQUssTUFBTWIsY0FBYyxDQUFDWSxHQUFHLEVBQUVDLElBQUksQ0FBQztFQUN6REMsTUFBTSxFQUFFLE1BQU07RUFDZFosSUFBSSxFQUFFLEdBQUc7RUFDVGMsUUFBUSxFQUFHZixjQUFjLENBQUNNLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQztFQUN6RFEsT0FBTyxFQUFFbkI7QUFDYixDQUFDLENBQUM7QUFFRlksR0FBRyxDQUFDRSxLQUFLLENBQUM7RUFDTkMsR0FBRyxFQUFFLE1BQUFBLENBQU9DLEdBQUcsRUFBRUMsSUFBSSxLQUFLLE1BQU1iLGNBQWMsQ0FBQ1ksR0FBRyxFQUFFQyxJQUFJLENBQUM7RUFDekRDLE1BQU0sRUFBRSxLQUFLO0VBQ2JaLElBQUksRUFBRSxpQkFBaUI7RUFDdkJhLE9BQU8sRUFBRWxCO0FBQ2IsQ0FBQyxDQUFDO0FBRUZXLEdBQUcsQ0FBQ0UsS0FBSyxDQUFDO0VBQ05DLEdBQUcsRUFBRSxNQUFBQSxDQUFPQyxHQUFHLEVBQUVDLElBQUksS0FBSyxNQUFNYixjQUFjLENBQUNZLEdBQUcsRUFBRUMsSUFBSSxDQUFDO0VBQ3pEQyxNQUFNLEVBQUUsUUFBUTtFQUNoQlosSUFBSSxFQUFFLGlCQUFpQjtFQUN2QmEsT0FBTyxFQUFFaEI7QUFDYixDQUFDLENBQUM7QUFFRmtCLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHVixHQUFHIn0=","map":{"version":3,"names":["Router","require","createOrder","getOrderByTransactionNo","getOrders","deleteOrder","authMiddleware","validateSchema","path","filename","basename","__filename","split","directory","api","prefix","route","pre","ctx","next","method","handler","validate","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/","sources":["orders.router.js"],"sourcesContent":["const Router = require(\"koa-joi-router\"); \nconst { createOrder, getOrderByTransactionNo, getOrders, deleteOrder } = require(\"../controllers/orders.controller\");\nconst authMiddleware = require(\"../middleware/auth.middleware\");\n \nconst { validateSchema } = require('../commons/validate');\nconst path = require('path'); \n\nconst filename = path.basename(__filename).split('.')[0]; \nconst directory = `../../docs/schemas/${filename}/Request/`;\n \n\nconst api = Router();\napi.prefix(\"/orders\"); \n\n\napi.route({\n    pre: async (ctx, next) => await authMiddleware(ctx, next),\n    method: 'GET',\n    path: '/',\n    handler: getOrders\n}); \n\napi.route({\n    pre: async (ctx, next) => await authMiddleware(ctx, next),\n    method: 'POST',\n    path: '/',\n    validate:  validateSchema(directory + 'createOrder.json'), \n    handler: createOrder\n});\n\napi.route({\n    pre: async (ctx, next) => await authMiddleware(ctx, next),\n    method: 'GET',\n    path: '/:transactionNo',\n    handler: getOrderByTransactionNo\n});\n\napi.route({\n    pre: async (ctx, next) => await authMiddleware(ctx, next),\n    method: 'DELETE',\n    path: '/:transactionNo',\n    handler: deleteOrder\n});\n\nmodule.exports = api;\n"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AACxC,MAAM;EAAEC,WAAW;EAAEC,uBAAuB;EAAEC,SAAS;EAAEC;AAAY,CAAC,GAAGJ,OAAO,CAAC,kCAAkC,CAAC;AACpH,MAAMK,cAAc,GAAGL,OAAO,CAAC,+BAA+B,CAAC;AAE/D,MAAM;EAAEM;AAAe,CAAC,GAAGN,OAAO,CAAC,qBAAqB,CAAC;AACzD,MAAMO,IAAI,GAAGP,OAAO,CAAC,MAAM,CAAC;AAE5B,MAAMQ,QAAQ,GAAGD,IAAI,CAACE,QAAQ,CAACC,UAAU,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACxD,MAAMC,SAAS,GAAI,sBAAqBJ,QAAS,WAAU;AAG3D,MAAMK,GAAG,GAAGd,MAAM,CAAC,CAAC;AACpBc,GAAG,CAACC,MAAM,CAAC,SAAS,CAAC;AAGrBD,GAAG,CAACE,KAAK,CAAC;EACNC,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMb,cAAc,CAACY,GAAG,EAAEC,IAAI,CAAC;EACzDC,MAAM,EAAE,KAAK;EACbZ,IAAI,EAAE,GAAG;EACTa,OAAO,EAAEjB;AACb,CAAC,CAAC;AAEFU,GAAG,CAACE,KAAK,CAAC;EACNC,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMb,cAAc,CAACY,GAAG,EAAEC,IAAI,CAAC;EACzDC,MAAM,EAAE,MAAM;EACdZ,IAAI,EAAE,GAAG;EACTc,QAAQ,EAAGf,cAAc,CAACM,SAAS,GAAG,kBAAkB,CAAC;EACzDQ,OAAO,EAAEnB;AACb,CAAC,CAAC;AAEFY,GAAG,CAACE,KAAK,CAAC;EACNC,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMb,cAAc,CAACY,GAAG,EAAEC,IAAI,CAAC;EACzDC,MAAM,EAAE,KAAK;EACbZ,IAAI,EAAE,iBAAiB;EACvBa,OAAO,EAAElB;AACb,CAAC,CAAC;AAEFW,GAAG,CAACE,KAAK,CAAC;EACNC,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMb,cAAc,CAACY,GAAG,EAAEC,IAAI,CAAC;EACzDC,MAAM,EAAE,QAAQ;EAChBZ,IAAI,EAAE,iBAAiB;EACvBa,OAAO,EAAEhB;AACb,CAAC,CAAC;AAEFkB,MAAM,CAACC,OAAO,GAAGV,GAAG"}},"mtime":1692894955592},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/orders.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const {\n  secret,\n  firebase\n} = require('../configs');\nconst {\n  query,\n  orderByChild,\n  equalTo,\n  child,\n  get,\n  ref,\n  push,\n  set,\n  remove\n} = require(\"@firebase/database\");\nconst bcrypt = require('bcrypt');\nconst {\n  result,\n  result_error\n} = require(\"../commons/convert\");\nconst {\n  getRunningNoOrderKey\n} = require('../commons/calculate');\nconst {\n  getPagination\n} = require('../utils/pagination.util');\nmodule.exports = {\n  async createOrder(ctx, _next) {\n    try {\n      const {\n        userId,\n        total_qty,\n        total_price,\n        orders\n      } = ctx.request.body;\n      if (!orders || orders.length === 0) {\n        ctx.body = result_error(400, \"No products provided in the order\");\n        return;\n      }\n\n      // Create a reference to the orders collection\n      const ordersRef = ref(firebase, 'orders');\n      const currentDate = new Date();\n      const currentYear = currentDate.getFullYear();\n      const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');\n      const runningNo = await getRunningNoOrderKey(currentYear + currentMonth);\n\n      // Construct the transactionNo\n      const transactionNo = `T_${currentYear}${currentMonth}_${runningNo}`;\n      const specificOrdersRef = child(ordersRef, transactionNo);\n\n      // Construct the order data\n      const orderData = {\n        userId,\n        transactionNo,\n        transactionDate: currentDate.toISOString(),\n        total_qty,\n        total_price,\n        orders: orders.map(order => ({\n          product_id: order.product_id,\n          product_name: order.product_name,\n          image: order.imageBase64,\n          description: order.description,\n          quantity: order.quantity,\n          price: order.price\n        }))\n      };\n      await set(specificOrdersRef, orderData);\n      ctx.body = result(200, {\n        message: \"Order creation successful\",\n        transactionNo: transactionNo\n      });\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async getOrderByTransactionNo(ctx, _next) {\n    try {\n      const {\n        transactionNo\n      } = ctx.params;\n      const specificOrderRef = ref(firebase, `orders/${transactionNo}`);\n      const orderSnapshot = await get(specificOrderRef);\n      if (!orderSnapshot.exists()) {\n        ctx.body = result_error(404, \"Order not found\");\n        return;\n      }\n      const orderData = orderSnapshot.val();\n      ctx.body = result(200, orderData);\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async getOrders(ctx, _next) {\n    try {\n      const {\n        page,\n        size\n      } = ctx.request.query;\n      const {\n        limit,\n        offset\n      } = getPagination(page, size);\n      const ordersRef = ref(firebase, 'orders');\n      const ordersSnapshot = await get(ordersRef);\n      if (!ordersSnapshot.exists()) {\n        ctx.body = result_error(404, \"No orders found\");\n        return;\n      }\n      const rawData = ordersSnapshot.val();\n      const orders = Object.keys(rawData).map(key => rawData[key]);\n      const paginatedOrders = orders.slice(offset, offset + limit);\n      ctx.body = result(200, paginatedOrders);\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async deleteOrder(ctx, _next) {\n    try {\n      const {\n        transactionNo\n      } = ctx.params; // Assuming orderId is a route parameter\n\n      // Check if the order exists before deleting\n      const orderToDeleteRef = ref(firebase, `orders/${transactionNo}`);\n      const orderSnapshot = await get(orderToDeleteRef);\n      if (!orderSnapshot.exists()) {\n        ctx.body = result_error(404, \"Order not found\");\n        return;\n      }\n      await remove(orderToDeleteRef);\n      ctx.body = result(200, {\n        message: \"Order deletion successful\",\n        transactionNo\n      });\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzZWNyZXQiLCJmaXJlYmFzZSIsInJlcXVpcmUiLCJxdWVyeSIsIm9yZGVyQnlDaGlsZCIsImVxdWFsVG8iLCJjaGlsZCIsImdldCIsInJlZiIsInB1c2giLCJzZXQiLCJyZW1vdmUiLCJiY3J5cHQiLCJyZXN1bHQiLCJyZXN1bHRfZXJyb3IiLCJnZXRSdW5uaW5nTm9PcmRlcktleSIsImdldFBhZ2luYXRpb24iLCJtb2R1bGUiLCJleHBvcnRzIiwiY3JlYXRlT3JkZXIiLCJjdHgiLCJfbmV4dCIsInVzZXJJZCIsInRvdGFsX3F0eSIsInRvdGFsX3ByaWNlIiwib3JkZXJzIiwicmVxdWVzdCIsImJvZHkiLCJsZW5ndGgiLCJvcmRlcnNSZWYiLCJjdXJyZW50RGF0ZSIsIkRhdGUiLCJjdXJyZW50WWVhciIsImdldEZ1bGxZZWFyIiwiY3VycmVudE1vbnRoIiwiU3RyaW5nIiwiZ2V0TW9udGgiLCJwYWRTdGFydCIsInJ1bm5pbmdObyIsInRyYW5zYWN0aW9uTm8iLCJzcGVjaWZpY09yZGVyc1JlZiIsIm9yZGVyRGF0YSIsInRyYW5zYWN0aW9uRGF0ZSIsInRvSVNPU3RyaW5nIiwibWFwIiwib3JkZXIiLCJwcm9kdWN0X2lkIiwicHJvZHVjdF9uYW1lIiwiaW1hZ2UiLCJpbWFnZUJhc2U2NCIsImRlc2NyaXB0aW9uIiwicXVhbnRpdHkiLCJwcmljZSIsIm1lc3NhZ2UiLCJlcnIiLCJnZXRPcmRlckJ5VHJhbnNhY3Rpb25ObyIsInBhcmFtcyIsInNwZWNpZmljT3JkZXJSZWYiLCJvcmRlclNuYXBzaG90IiwiZXhpc3RzIiwidmFsIiwiZ2V0T3JkZXJzIiwicGFnZSIsInNpemUiLCJsaW1pdCIsIm9mZnNldCIsIm9yZGVyc1NuYXBzaG90IiwicmF3RGF0YSIsIk9iamVjdCIsImtleXMiLCJrZXkiLCJwYWdpbmF0ZWRPcmRlcnMiLCJzbGljZSIsImRlbGV0ZU9yZGVyIiwib3JkZXJUb0RlbGV0ZVJlZiJdLCJzb3VyY2VSb290IjoiL1VzZXJzL21hY3Byby9EZXNrdG9wL0luZm9tYXRpb24vVGVzdC9ub2RlLWJhY2stZW5kL3NyYy9jb250cm9sbGVycy8iLCJzb3VyY2VzIjpbIm9yZGVycy5jb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgc2VjcmV0LCBmaXJlYmFzZSB9ID0gcmVxdWlyZSgnLi4vY29uZmlncycpO1xuY29uc3QgeyBxdWVyeSwgb3JkZXJCeUNoaWxkLCBlcXVhbFRvLCBjaGlsZCwgZ2V0LCByZWYsIHB1c2gsIHNldCwgcmVtb3ZlIH0gPSByZXF1aXJlKFwiQGZpcmViYXNlL2RhdGFiYXNlXCIpO1xuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0Jyk7IFxuY29uc3QgeyByZXN1bHQsIHJlc3VsdF9lcnJvcn0gPSByZXF1aXJlKFwiLi4vY29tbW9ucy9jb252ZXJ0XCIpOyBcbmNvbnN0IHsgZ2V0UnVubmluZ05vT3JkZXJLZXkgfSA9IHJlcXVpcmUoJy4uL2NvbW1vbnMvY2FsY3VsYXRlJyk7XG5jb25zdCB7IGdldFBhZ2luYXRpb24gfSA9IHJlcXVpcmUoJy4uL3V0aWxzL3BhZ2luYXRpb24udXRpbCcpXG5cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgYXN5bmMgY3JlYXRlT3JkZXIoY3R4LCBfbmV4dCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICB0b3RhbF9xdHksXG4gICAgICAgICAgICAgICAgdG90YWxfcHJpY2UsXG4gICAgICAgICAgICAgICAgb3JkZXJzXG4gICAgICAgICAgICB9ID0gY3R4LnJlcXVlc3QuYm9keTtcbiAgICBcbiAgICAgICAgICAgIGlmICghb3JkZXJzIHx8IG9yZGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig0MDAsIFwiTm8gcHJvZHVjdHMgcHJvdmlkZWQgaW4gdGhlIG9yZGVyXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIC8vIENyZWF0ZSBhIHJlZmVyZW5jZSB0byB0aGUgb3JkZXJzIGNvbGxlY3Rpb25cbiAgICAgICAgICAgIGNvbnN0IG9yZGVyc1JlZiA9IHJlZihmaXJlYmFzZSwgJ29yZGVycycpO1xuICAgIFxuICAgICAgICAgICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFllYXIgPSBjdXJyZW50RGF0ZS5nZXRGdWxsWWVhcigpO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudE1vbnRoID0gU3RyaW5nKGN1cnJlbnREYXRlLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgICAgICAgICAgY29uc3QgcnVubmluZ05vID0gYXdhaXQgZ2V0UnVubmluZ05vT3JkZXJLZXkoY3VycmVudFllYXIgKyBjdXJyZW50TW9udGgpOyAgXG4gICAgXG4gICAgICAgICAgICAvLyBDb25zdHJ1Y3QgdGhlIHRyYW5zYWN0aW9uTm9cbiAgICAgICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uTm8gPSBgVF8ke2N1cnJlbnRZZWFyfSR7Y3VycmVudE1vbnRofV8ke3J1bm5pbmdOb31gOyAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHNwZWNpZmljT3JkZXJzUmVmID0gY2hpbGQob3JkZXJzUmVmLCB0cmFuc2FjdGlvbk5vKTtcbiAgICBcbiAgICAgICAgICAgIC8vIENvbnN0cnVjdCB0aGUgb3JkZXIgZGF0YVxuICAgICAgICAgICAgY29uc3Qgb3JkZXJEYXRhID0ge1xuICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbk5vLFxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uRGF0ZTogY3VycmVudERhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB0b3RhbF9xdHksXG4gICAgICAgICAgICAgICAgdG90YWxfcHJpY2UsXG4gICAgICAgICAgICAgICAgb3JkZXJzOiBvcmRlcnMubWFwKG9yZGVyID0+ICh7XG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3RfaWQ6IG9yZGVyLnByb2R1Y3RfaWQsXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3RfbmFtZTogb3JkZXIucHJvZHVjdF9uYW1lLFxuICAgICAgICAgICAgICAgICAgICBpbWFnZTogb3JkZXIuaW1hZ2VCYXNlNjQsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBvcmRlci5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICAgICAgcXVhbnRpdHk6IG9yZGVyLnF1YW50aXR5LFxuICAgICAgICAgICAgICAgICAgICBwcmljZTogb3JkZXIucHJpY2VcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIH07XG4gICAgXG4gICAgICAgICAgICBhd2FpdCBzZXQoc3BlY2lmaWNPcmRlcnNSZWYsIG9yZGVyRGF0YSk7XG4gICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdCgyMDAsIHsgbWVzc2FnZTogXCJPcmRlciBjcmVhdGlvbiBzdWNjZXNzZnVsXCIsIHRyYW5zYWN0aW9uTm86IHRyYW5zYWN0aW9uTm8gfSk7XG4gICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNTAwLCBlcnIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhc3luYyBnZXRPcmRlckJ5VHJhbnNhY3Rpb25ObyhjdHgsIF9uZXh0KSB7XG4gICAgICAgIHRyeSB7IFxuICAgICAgICAgICAgY29uc3QgeyB0cmFuc2FjdGlvbk5vIH0gPSBjdHgucGFyYW1zOyAgIFxuICAgICAgICAgICAgY29uc3Qgc3BlY2lmaWNPcmRlclJlZiA9IHJlZihmaXJlYmFzZSwgYG9yZGVycy8ke3RyYW5zYWN0aW9uTm99YCk7IFxuICAgICAgICAgICAgY29uc3Qgb3JkZXJTbmFwc2hvdCA9IGF3YWl0IGdldChzcGVjaWZpY09yZGVyUmVmKTsgXG5cbiAgICAgICAgICAgIGlmICghb3JkZXJTbmFwc2hvdC5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDQwNCwgXCJPcmRlciBub3QgZm91bmRcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBvcmRlckRhdGEgPSBvcmRlclNuYXBzaG90LnZhbCgpOyBcbiAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0KDIwMCwgb3JkZXJEYXRhKTtcbiAgICBcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig1MDAsIGVycik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGFzeW5jIGdldE9yZGVycyhjdHgsIF9uZXh0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IHBhZ2UsIHNpemUgfSA9IGN0eC5yZXF1ZXN0LnF1ZXJ5O1xuICAgICAgICAgICAgY29uc3QgeyBsaW1pdCwgb2Zmc2V0IH0gPSBnZXRQYWdpbmF0aW9uKHBhZ2UsIHNpemUpO1xuICAgIFxuICAgICAgICAgICAgY29uc3Qgb3JkZXJzUmVmID0gcmVmKGZpcmViYXNlLCAnb3JkZXJzJyk7XG4gICAgICAgICAgICBjb25zdCBvcmRlcnNTbmFwc2hvdCA9IGF3YWl0IGdldChvcmRlcnNSZWYpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIW9yZGVyc1NuYXBzaG90LmV4aXN0cygpKSB7XG4gICAgICAgICAgICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNDA0LCBcIk5vIG9yZGVycyBmb3VuZFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgIFxuICAgICAgICAgICAgY29uc3QgcmF3RGF0YSA9IG9yZGVyc1NuYXBzaG90LnZhbCgpO1xuICAgICAgICAgICAgY29uc3Qgb3JkZXJzID0gT2JqZWN0LmtleXMocmF3RGF0YSkubWFwKGtleSA9PiByYXdEYXRhW2tleV0pO1xuXG4gICAgICAgICAgICBjb25zdCBwYWdpbmF0ZWRPcmRlcnMgPSBvcmRlcnMuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBsaW1pdCk7IFxuICAgICAgICAgICAgY3R4LmJvZHkgPSByZXN1bHQoMjAwLCBwYWdpbmF0ZWRPcmRlcnMpO1xuICAgIFxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDUwMCwgZXJyKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgYXN5bmMgZGVsZXRlT3JkZXIoY3R4LCBfbmV4dCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyB0cmFuc2FjdGlvbk5vIH0gPSBjdHgucGFyYW1zOyAgLy8gQXNzdW1pbmcgb3JkZXJJZCBpcyBhIHJvdXRlIHBhcmFtZXRlclxuICAgIFxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIG9yZGVyIGV4aXN0cyBiZWZvcmUgZGVsZXRpbmdcbiAgICAgICAgICAgIGNvbnN0IG9yZGVyVG9EZWxldGVSZWYgPSByZWYoZmlyZWJhc2UsIGBvcmRlcnMvJHt0cmFuc2FjdGlvbk5vfWApO1xuICAgICAgICAgICAgY29uc3Qgb3JkZXJTbmFwc2hvdCA9IGF3YWl0IGdldChvcmRlclRvRGVsZXRlUmVmKTtcbiAgICAgICAgICAgIGlmICghb3JkZXJTbmFwc2hvdC5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDQwNCwgXCJPcmRlciBub3QgZm91bmRcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbW92ZShvcmRlclRvRGVsZXRlUmVmKTtcbiAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0KDIwMCwgeyBtZXNzYWdlOiBcIk9yZGVyIGRlbGV0aW9uIHN1Y2Nlc3NmdWxcIiAsdHJhbnNhY3Rpb25Ob30pO1xuICAgIFxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDUwMCwgZXJyKTtcbiAgICAgICAgfVxuICAgIH0gXG59OyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTTtFQUFFQSxNQUFNO0VBQUVDO0FBQVMsQ0FBQyxHQUFHQyxPQUFPLENBQUMsWUFBWSxDQUFDO0FBQ2xELE1BQU07RUFBRUMsS0FBSztFQUFFQyxZQUFZO0VBQUVDLE9BQU87RUFBRUMsS0FBSztFQUFFQyxHQUFHO0VBQUVDLEdBQUc7RUFBRUMsSUFBSTtFQUFFQyxHQUFHO0VBQUVDO0FBQU8sQ0FBQyxHQUFHVCxPQUFPLENBQUMsb0JBQW9CLENBQUM7QUFDMUcsTUFBTVUsTUFBTSxHQUFHVixPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDLE1BQU07RUFBRVcsTUFBTTtFQUFFQztBQUFZLENBQUMsR0FBR1osT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQzdELE1BQU07RUFBRWE7QUFBcUIsQ0FBQyxHQUFHYixPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFDaEUsTUFBTTtFQUFFYztBQUFjLENBQUMsR0FBR2QsT0FBTyxDQUFDLDBCQUEwQixDQUFDO0FBRzdEZSxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNiLE1BQU1DLFdBQVdBLENBQUNDLEdBQUcsRUFBRUMsS0FBSyxFQUFFO0lBQzFCLElBQUk7TUFDQSxNQUFNO1FBQ0ZDLE1BQU07UUFDTkMsU0FBUztRQUNUQyxXQUFXO1FBQ1hDO01BQ0osQ0FBQyxHQUFHTCxHQUFHLENBQUNNLE9BQU8sQ0FBQ0MsSUFBSTtNQUVwQixJQUFJLENBQUNGLE1BQU0sSUFBSUEsTUFBTSxDQUFDRyxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQ2hDUixHQUFHLENBQUNPLElBQUksR0FBR2IsWUFBWSxDQUFDLEdBQUcsRUFBRSxtQ0FBbUMsQ0FBQztRQUNq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","map":{"version":3,"names":["secret","firebase","require","query","orderByChild","equalTo","child","get","ref","push","set","remove","bcrypt","result","result_error","getRunningNoOrderKey","getPagination","module","exports","createOrder","ctx","_next","userId","total_qty","total_price","orders","request","body","length","ordersRef","currentDate","Date","currentYear","getFullYear","currentMonth","String","getMonth","padStart","runningNo","transactionNo","specificOrdersRef","orderData","transactionDate","toISOString","map","order","product_id","product_name","image","imageBase64","description","quantity","price","message","err","getOrderByTransactionNo","params","specificOrderRef","orderSnapshot","exists","val","getOrders","page","size","limit","offset","ordersSnapshot","rawData","Object","keys","key","paginatedOrders","slice","deleteOrder","orderToDeleteRef"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/","sources":["orders.controller.js"],"sourcesContent":["const { secret, firebase } = require('../configs');\nconst { query, orderByChild, equalTo, child, get, ref, push, set, remove } = require(\"@firebase/database\");\nconst bcrypt = require('bcrypt'); \nconst { result, result_error} = require(\"../commons/convert\"); \nconst { getRunningNoOrderKey } = require('../commons/calculate');\nconst { getPagination } = require('../utils/pagination.util')\n\n\nmodule.exports = {\n    async createOrder(ctx, _next) {\n        try {\n            const {\n                userId,\n                total_qty,\n                total_price,\n                orders\n            } = ctx.request.body;\n    \n            if (!orders || orders.length === 0) {\n                ctx.body = result_error(400, \"No products provided in the order\");\n                return;\n            }\n    \n            // Create a reference to the orders collection\n            const ordersRef = ref(firebase, 'orders');\n    \n            const currentDate = new Date();\n            const currentYear = currentDate.getFullYear();\n            const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');\n            const runningNo = await getRunningNoOrderKey(currentYear + currentMonth);  \n    \n            // Construct the transactionNo\n            const transactionNo = `T_${currentYear}${currentMonth}_${runningNo}`;  \n            \n            const specificOrdersRef = child(ordersRef, transactionNo);\n    \n            // Construct the order data\n            const orderData = {\n                userId,\n                transactionNo,\n                transactionDate: currentDate.toISOString(),\n                total_qty,\n                total_price,\n                orders: orders.map(order => ({\n                    product_id: order.product_id,\n                    product_name: order.product_name,\n                    image: order.imageBase64,\n                    description: order.description,\n                    quantity: order.quantity,\n                    price: order.price\n                }))\n            };\n    \n            await set(specificOrdersRef, orderData);\n            ctx.body = result(200, { message: \"Order creation successful\", transactionNo: transactionNo });\n    \n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    },\n    async getOrderByTransactionNo(ctx, _next) {\n        try { \n            const { transactionNo } = ctx.params;   \n            const specificOrderRef = ref(firebase, `orders/${transactionNo}`); \n            const orderSnapshot = await get(specificOrderRef); \n\n            if (!orderSnapshot.exists()) {\n                ctx.body = result_error(404, \"Order not found\");\n                return;\n            }\n            \n            const orderData = orderSnapshot.val(); \n            ctx.body = result(200, orderData);\n    \n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    },\n    async getOrders(ctx, _next) {\n        try {\n            const { page, size } = ctx.request.query;\n            const { limit, offset } = getPagination(page, size);\n    \n            const ordersRef = ref(firebase, 'orders');\n            const ordersSnapshot = await get(ordersRef);\n            \n            if (!ordersSnapshot.exists()) {\n                ctx.body = result_error(404, \"No orders found\");\n                return;\n            }\n     \n            const rawData = ordersSnapshot.val();\n            const orders = Object.keys(rawData).map(key => rawData[key]);\n\n            const paginatedOrders = orders.slice(offset, offset + limit); \n            ctx.body = result(200, paginatedOrders);\n    \n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    },\n    async deleteOrder(ctx, _next) {\n        try {\n            const { transactionNo } = ctx.params;  // Assuming orderId is a route parameter\n    \n            // Check if the order exists before deleting\n            const orderToDeleteRef = ref(firebase, `orders/${transactionNo}`);\n            const orderSnapshot = await get(orderToDeleteRef);\n            if (!orderSnapshot.exists()) {\n                ctx.body = result_error(404, \"Order not found\");\n                return;\n            }\n     \n            await remove(orderToDeleteRef);\n            ctx.body = result(200, { message: \"Order deletion successful\" ,transactionNo});\n    \n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    } \n};"],"mappings":"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"}},"mtime":1692897101970},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/convert.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const axios = require('axios');\nconst Router = require(\"koa-joi-router\");\nlet Joi = Router.Joi;\nconst schemaToJoi = openApiSchema => {\n  const properties = openApiSchema.properties;\n  const requiredProperties = new Set(openApiSchema.required || []);\n  const joiSchema = {};\n  for (let propertyName in properties) {\n    let property = properties[propertyName];\n    let isRequired = requiredProperties.has(propertyName);\n    let joiValidator;\n    switch (property.type) {\n      case 'string':\n        joiValidator = Joi.string();\n        break;\n      case 'integer':\n        joiValidator = Joi.number().integer();\n        break;\n      case 'number':\n        joiValidator = Joi.number();\n        break;\n      case 'boolean':\n        joiValidator = Joi.boolean();\n        break;\n      case 'object':\n        joiValidator = Joi.object(schemaToJoi(property));\n        break;\n      case 'array':\n        joiValidator = Joi.array().items(schemaToJoi(property.items));\n        break;\n      case 'date':\n        joiValidator = Joi.date();\n        break;\n      case 'binary':\n        joiValidator = Joi.binary();\n        break;\n      case 'symbol':\n        joiValidator = Joi.symbol();\n        break;\n      case 'function':\n        joiValidator = Joi.func();\n        break;\n      case 'alternatives':\n        joiValidator = Joi.alternatives();\n        break;\n      default:\n        throw new Error(`Unsupported type ${property.type}`);\n    }\n    if (isRequired) {\n      joiValidator = joiValidator.required();\n    } else {\n      joiValidator = joiValidator.allow(null).default(null);\n    }\n    joiSchema[propertyName] = joiValidator;\n  }\n  return joiSchema;\n};\nmodule.exports = {\n  schemaToJoi,\n  result: (status, data = null) => {\n    let message;\n    switch (status) {\n      case 202:\n        message = \"Success Accepted\";\n        break;\n      default:\n        message = \"Successful\";\n    }\n    let response = {\n      status: status,\n      message: message\n    };\n    if (data != null) {\n      response['data'] = data;\n    }\n    return response;\n  },\n  result_error: (status, error = null) => {\n    let message;\n    switch (status) {\n      case 400:\n        message = \"Bad Request\";\n        break;\n      case 401:\n        message = \"Unauthorized\";\n        break;\n      case 403:\n        message = \"No token provided!\";\n        break;\n      case 500:\n        message = \"Internal Server Error\";\n        break;\n      case 404:\n        message = \"Data Not Found\";\n        break;\n      default:\n        message = \"An unexpected error occurred\";\n    }\n    let response = {\n      status: status,\n      message: message,\n      data: {\n        error_code: error.name,\n        error_description: error.message\n      }\n    };\n    if (error) {\n      response.data = {\n        error_code: error.name,\n        error_description: error.message\n      };\n      if (error.hasOwnProperty('status_code')) {\n        response.data['error_code'] = error.status_code;\n      }\n    }\n    return response;\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJheGlvcyIsInJlcXVpcmUiLCJSb3V0ZXIiLCJKb2kiLCJzY2hlbWFUb0pvaSIsIm9wZW5BcGlTY2hlbWEiLCJwcm9wZXJ0aWVzIiwicmVxdWlyZWRQcm9wZXJ0aWVzIiwiU2V0IiwicmVxdWlyZWQiLCJqb2lTY2hlbWEiLCJwcm9wZXJ0eU5hbWUiLCJwcm9wZXJ0eSIsImlzUmVxdWlyZWQiLCJoYXMiLCJqb2lWYWxpZGF0b3IiLCJ0eXBlIiwic3RyaW5nIiwibnVtYmVyIiwiaW50ZWdlciIsImJvb2xlYW4iLCJvYmplY3QiLCJhcnJheSIsIml0ZW1zIiwiZGF0ZSIsImJpbmFyeSIsInN5bWJvbCIsImZ1bmMiLCJhbHRlcm5hdGl2ZXMiLCJFcnJvciIsImFsbG93IiwiZGVmYXVsdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJyZXN1bHQiLCJzdGF0dXMiLCJkYXRhIiwibWVzc2FnZSIsInJlc3BvbnNlIiwicmVzdWx0X2Vycm9yIiwiZXJyb3IiLCJlcnJvcl9jb2RlIiwibmFtZSIsImVycm9yX2Rlc2NyaXB0aW9uIiwiaGFzT3duUHJvcGVydHkiLCJzdGF0dXNfY29kZSJdLCJzb3VyY2VSb290IjoiL1VzZXJzL21hY3Byby9EZXNrdG9wL0luZm9tYXRpb24vVGVzdC9ub2RlLWJhY2stZW5kL3NyYy9jb21tb25zLyIsInNvdXJjZXMiOlsiY29udmVydC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBheGlvcyA9IHJlcXVpcmUoJ2F4aW9zJylcbmNvbnN0IFJvdXRlciA9IHJlcXVpcmUoXCJrb2Etam9pLXJvdXRlclwiKTtcbmxldCBKb2kgPSBSb3V0ZXIuSm9pOyAgXG5cbmNvbnN0IHNjaGVtYVRvSm9pID0gKG9wZW5BcGlTY2hlbWEpID0+IHtcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gb3BlbkFwaVNjaGVtYS5wcm9wZXJ0aWVzO1xuICAgIGNvbnN0IHJlcXVpcmVkUHJvcGVydGllcyA9IG5ldyBTZXQob3BlbkFwaVNjaGVtYS5yZXF1aXJlZCB8fCBbXSk7XG5cbiAgICBjb25zdCBqb2lTY2hlbWEgPSB7fTtcblxuICAgIGZvciAobGV0IHByb3BlcnR5TmFtZSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICAgIGxldCBwcm9wZXJ0eSA9IHByb3BlcnRpZXNbcHJvcGVydHlOYW1lXTtcbiAgICAgICAgbGV0IGlzUmVxdWlyZWQgPSByZXF1aXJlZFByb3BlcnRpZXMuaGFzKHByb3BlcnR5TmFtZSk7XG4gICAgICAgIGxldCBqb2lWYWxpZGF0b3I7XG5cbiAgICAgICAgc3dpdGNoIChwcm9wZXJ0eS50eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgICAgICAgICAgIGpvaVZhbGlkYXRvciA9IEpvaS5zdHJpbmcoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2ludGVnZXInOlxuICAgICAgICAgICAgICAgIGpvaVZhbGlkYXRvciA9IEpvaS5udW1iZXIoKS5pbnRlZ2VyKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGpvaVZhbGlkYXRvciA9IEpvaS5udW1iZXIoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICAgICAgICAgIGpvaVZhbGlkYXRvciA9IEpvaS5ib29sZWFuKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdvYmplY3QnOlxuICAgICAgICAgICAgICAgIGpvaVZhbGlkYXRvciA9IEpvaS5vYmplY3Qoc2NoZW1hVG9Kb2kocHJvcGVydHkpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2FycmF5JzpcbiAgICAgICAgICAgICAgICBqb2lWYWxpZGF0b3IgPSBKb2kuYXJyYXkoKS5pdGVtcyhzY2hlbWFUb0pvaShwcm9wZXJ0eS5pdGVtcykpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZGF0ZSc6XG4gICAgICAgICAgICAgICAgam9pVmFsaWRhdG9yID0gSm9pLmRhdGUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2JpbmFyeSc6XG4gICAgICAgICAgICAgICAgam9pVmFsaWRhdG9yID0gSm9pLmJpbmFyeSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc3ltYm9sJzpcbiAgICAgICAgICAgICAgICBqb2lWYWxpZGF0b3IgPSBKb2kuc3ltYm9sKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmdW5jdGlvbic6XG4gICAgICAgICAgICAgICAgam9pVmFsaWRhdG9yID0gSm9pLmZ1bmMoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2FsdGVybmF0aXZlcyc6XG4gICAgICAgICAgICAgICAgam9pVmFsaWRhdG9yID0gSm9pLmFsdGVybmF0aXZlcygpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHR5cGUgJHtwcm9wZXJ0eS50eXBlfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlzUmVxdWlyZWQpIHtcbiAgICAgICAgICAgIGpvaVZhbGlkYXRvciA9IGpvaVZhbGlkYXRvci5yZXF1aXJlZCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgam9pVmFsaWRhdG9yID0gam9pVmFsaWRhdG9yLmFsbG93KG51bGwpLmRlZmF1bHQobnVsbCk7XG4gICAgICAgIH1cblxuICAgICAgICBqb2lTY2hlbWFbcHJvcGVydHlOYW1lXSA9IGpvaVZhbGlkYXRvcjtcbiAgICB9XG5cbiAgICByZXR1cm4gam9pU2NoZW1hO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHsgXG4gICAgc2NoZW1hVG9Kb2ksXG4gICAgcmVzdWx0OiAoc3RhdHVzLCBkYXRhID0gbnVsbCkgPT4ge1xuICAgICAgICBsZXQgbWVzc2FnZTtcblxuICAgICAgICBzd2l0Y2goc3RhdHVzKSB7IFxuICAgICAgICAgICAgY2FzZSAyMDI6XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiU3VjY2VzcyBBY2NlcHRlZFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrOyBcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiU3VjY2Vzc2Z1bFwiO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlID0ge3N0YXR1czogc3RhdHVzLCBtZXNzYWdlOiBtZXNzYWdlfTtcbiAgICAgICAgaWYoZGF0YSAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXNwb25zZVsnZGF0YSddID0gZGF0YTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSxcbiAgICByZXN1bHRfZXJyb3I6IChzdGF0dXMsIGVycm9yID0gbnVsbCkgPT4ge1xuICAgICAgICBsZXQgbWVzc2FnZTtcblxuICAgICAgICBzd2l0Y2goc3RhdHVzKSB7XG4gICAgICAgICAgICBjYXNlIDQwMDpcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gXCJCYWQgUmVxdWVzdFwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0MDE6XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiVW5hdXRob3JpemVkXCI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDQwMzpcbiAgICAgICAgICAgICAgICBtZXNzYWdlID0gXCJObyB0b2tlbiBwcm92aWRlZCFcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNTAwOlxuICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBcIkludGVybmFsIFNlcnZlciBFcnJvclwiO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSA0MDQ6XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiRGF0YSBOb3QgRm91bmRcIjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgbWVzc2FnZSA9IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZFwiO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHJlc3BvbnNlID0ge1xuICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsXG4gICAgICAgICAgICBtZXNzYWdlOiBtZXNzYWdlLFxuICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgIGVycm9yX2NvZGU6IGVycm9yLm5hbWUsXG4gICAgICAgICAgICAgICAgZXJyb3JfZGVzY3JpcHRpb246IGVycm9yLm1lc3NhZ2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgcmVzcG9uc2UuZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBlcnJvcl9jb2RlOiBlcnJvci5uYW1lLFxuICAgICAgICAgICAgICAgIGVycm9yX2Rlc2NyaXB0aW9uOiBlcnJvci5tZXNzYWdlXG4gICAgICAgICAgICB9O1xuICAgIFxuICAgICAgICAgICAgaWYoZXJyb3IuaGFzT3duUHJvcGVydHkoJ3N0YXR1c19jb2RlJykpIHtcbiAgICAgICAgICAgICAgICByZXNwb25zZS5kYXRhWydlcnJvcl9jb2RlJ10gPSBlcnJvci5zdGF0dXNfY29kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIFxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsT0FBTyxDQUFDO0FBQzlCLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxD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","map":{"version":3,"names":["axios","require","Router","Joi","schemaToJoi","openApiSchema","properties","requiredProperties","Set","required","joiSchema","propertyName","property","isRequired","has","joiValidator","type","string","number","integer","boolean","object","array","items","date","binary","symbol","func","alternatives","Error","allow","default","module","exports","result","status","data","message","response","result_error","error","error_code","name","error_description","hasOwnProperty","status_code"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/","sources":["convert.js"],"sourcesContent":["const axios = require('axios')\nconst Router = require(\"koa-joi-router\");\nlet Joi = Router.Joi;  \n\nconst schemaToJoi = (openApiSchema) => {\n    const properties = openApiSchema.properties;\n    const requiredProperties = new Set(openApiSchema.required || []);\n\n    const joiSchema = {};\n\n    for (let propertyName in properties) {\n        let property = properties[propertyName];\n        let isRequired = requiredProperties.has(propertyName);\n        let joiValidator;\n\n        switch (property.type) {\n            case 'string':\n                joiValidator = Joi.string();\n                break;\n            case 'integer':\n                joiValidator = Joi.number().integer();\n                break;\n            case 'number':\n                joiValidator = Joi.number();\n                break;\n            case 'boolean':\n                joiValidator = Joi.boolean();\n                break;\n            case 'object':\n                joiValidator = Joi.object(schemaToJoi(property));\n                break;\n            case 'array':\n                joiValidator = Joi.array().items(schemaToJoi(property.items));\n                break;\n            case 'date':\n                joiValidator = Joi.date();\n                break;\n            case 'binary':\n                joiValidator = Joi.binary();\n                break;\n            case 'symbol':\n                joiValidator = Joi.symbol();\n                break;\n            case 'function':\n                joiValidator = Joi.func();\n                break;\n            case 'alternatives':\n                joiValidator = Joi.alternatives();\n                break;\n            default:\n                throw new Error(`Unsupported type ${property.type}`);\n        }\n\n        if (isRequired) {\n            joiValidator = joiValidator.required();\n        } else {\n            joiValidator = joiValidator.allow(null).default(null);\n        }\n\n        joiSchema[propertyName] = joiValidator;\n    }\n\n    return joiSchema;\n}\n\nmodule.exports = { \n    schemaToJoi,\n    result: (status, data = null) => {\n        let message;\n\n        switch(status) { \n            case 202:\n                message = \"Success Accepted\";\n                break; \n            default:\n                message = \"Successful\";\n        }\n\n        let response = {status: status, message: message};\n        if(data != null) {\n            response['data'] = data;\n        }\n        return response;\n    },\n    result_error: (status, error = null) => {\n        let message;\n\n        switch(status) {\n            case 400:\n                message = \"Bad Request\";\n                break;\n            case 401:\n                message = \"Unauthorized\";\n                break;\n            case 403:\n                message = \"No token provided!\";\n                break;\n            case 500:\n                message = \"Internal Server Error\";\n                break;\n            case 404:\n                message = \"Data Not Found\";\n                break;\n            default:\n                message = \"An unexpected error occurred\";\n        }\n\n        let response = {\n            status: status,\n            message: message,\n            data: {\n                error_code: error.name,\n                error_description: error.message\n            }\n        };\n        \n        if (error) {\n            response.data = {\n                error_code: error.name,\n                error_description: error.message\n            };\n    \n            if(error.hasOwnProperty('status_code')) {\n                response.data['error_code'] = error.status_code;\n            }\n        }\n    \n        return response;\n    } \n}\n"],"mappings":"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"}},"mtime":1692889101264},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/calculate.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const axios = require('axios');\nconst {\n  secret,\n  firebase\n} = require('../configs');\nconst {\n  query,\n  orderByChild,\n  equalTo,\n  child,\n  get,\n  ref,\n  push,\n  set,\n  remove,\n  startAt,\n  endAt,\n  limitToLast\n} = require(\"@firebase/database\");\nmodule.exports = {\n  getRunningNoUserKey: async datePrefix => {\n    const userRef = ref(firebase, 'users');\n    const dayQuery = query(userRef, orderByChild('userId'), startAt(`${datePrefix}_`), endAt(`${datePrefix}_999999`), limitToLast(1));\n    const snapshot = await get(dayQuery);\n    if (snapshot.exists()) {\n      const lastUser = Object.values(snapshot.val())[0];\n      const lastRunningNo = parseInt(lastUser.userId.split('_')[1]);\n      return String(lastRunningNo + 1).padStart(6, '0');\n    } else {\n      return '000001';\n    }\n  },\n  getRunningNoProductKey: async datePrefix => {\n    const productRef = ref(firebase, 'products');\n    const dayQuery = query(productRef, orderByChild('product_id'), startAt(`P_${datePrefix}_`), endAt(`P_${datePrefix}_999999`), limitToLast(1));\n    const snapshot = await get(dayQuery);\n    if (snapshot.exists()) {\n      const lastProduct = Object.values(snapshot.val())[0];\n      const lastRunningNo = parseInt(lastProduct.product_id.split('_')[2]);\n      return String(lastRunningNo + 1).padStart(6, '0');\n    } else {\n      return '000001';\n    }\n  },\n  getRunningNoOrderKey: async datePrefix => {\n    const orderRef = ref(firebase, 'orders');\n    const dayQuery = query(orderRef, orderByChild('transactionNo'), startAt(`T_${datePrefix}_`), endAt(`T_${datePrefix}_999999`), limitToLast(1));\n    const snapshot = await get(dayQuery);\n    if (snapshot.exists()) {\n      const lastOrder = Object.values(snapshot.val())[0];\n      const lastRunningNo = parseInt(lastOrder.transactionNo.split('_')[2]);\n      return String(lastRunningNo + 1).padStart(6, '0');\n    } else {\n      return '000001';\n    }\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJheGlvcyIsInJlcXVpcmUiLCJzZWNyZXQiLCJmaXJlYmFzZSIsInF1ZXJ5Iiwib3JkZXJCeUNoaWxkIiwiZXF1YWxUbyIsImNoaWxkIiwiZ2V0IiwicmVmIiwicHVzaCIsInNldCIsInJlbW92ZSIsInN0YXJ0QXQiLCJlbmRBdCIsImxpbWl0VG9MYXN0IiwibW9kdWxlIiwiZXhwb3J0cyIsImdldFJ1bm5pbmdOb1VzZXJLZXkiLCJkYXRlUHJlZml4IiwidXNlclJlZiIsImRheVF1ZXJ5Iiwic25hcHNob3QiLCJleGlzdHMiLCJsYXN0VXNlciIsIk9iamVjdCIsInZhbHVlcyIsInZhbCIsImxhc3RSdW5uaW5nTm8iLCJwYXJzZUludCIsInVzZXJJZCIsInNwbGl0IiwiU3RyaW5nIiwicGFkU3RhcnQiLCJnZXRSdW5uaW5nTm9Qcm9kdWN0S2V5IiwicHJvZHVjdFJlZiIsImxhc3RQcm9kdWN0IiwicHJvZHVjdF9pZCIsImdldFJ1bm5pbmdOb09yZGVyS2V5Iiwib3JkZXJSZWYiLCJsYXN0T3JkZXIiLCJ0cmFuc2FjdGlvbk5vIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvbWFjcHJvL0Rlc2t0b3AvSW5mb21hdGlvbi9UZXN0L25vZGUtYmFjay1lbmQvc3JjL2NvbW1vbnMvIiwic291cmNlcyI6WyJjYWxjdWxhdGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYXhpb3MgPSByZXF1aXJlKCdheGlvcycpXG5jb25zdCB7IHNlY3JldCwgZmlyZWJhc2UgfSA9IHJlcXVpcmUoJy4uL2NvbmZpZ3MnKTtcbmNvbnN0IHsgcXVlcnksIG9yZGVyQnlDaGlsZCwgZXF1YWxUbywgY2hpbGQsIGdldCwgcmVmLCBwdXNoLCBzZXQsIHJlbW92ZSwgc3RhcnRBdCwgZW5kQXQsIGxpbWl0VG9MYXN0IH0gPSByZXF1aXJlKFwiQGZpcmViYXNlL2RhdGFiYXNlXCIpO1xuXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgZ2V0UnVubmluZ05vVXNlcktleTogYXN5bmMgKGRhdGVQcmVmaXgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJSZWYgPSByZWYoZmlyZWJhc2UsICd1c2VycycpOyBcbiAgICAgIGNvbnN0IGRheVF1ZXJ5ID0gcXVlcnkodXNlclJlZiwgb3JkZXJCeUNoaWxkKCd1c2VySWQnKSwgc3RhcnRBdChgJHtkYXRlUHJlZml4fV9gKSwgZW5kQXQoYCR7ZGF0ZVByZWZpeH1fOTk5OTk5YCksIGxpbWl0VG9MYXN0KDEpKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXQoZGF5UXVlcnkpO1xuICAgICAgaWYgKHNuYXBzaG90LmV4aXN0cygpKSB7XG4gICAgICAgICBjb25zdCBsYXN0VXNlciA9IE9iamVjdC52YWx1ZXMoc25hcHNob3QudmFsKCkpWzBdO1xuICAgICAgICAgY29uc3QgbGFzdFJ1bm5pbmdObyA9IHBhcnNlSW50KGxhc3RVc2VyLnVzZXJJZC5zcGxpdCgnXycpWzFdKTsgXG4gICAgICAgICByZXR1cm4gU3RyaW5nKGxhc3RSdW5uaW5nTm8gKyAxKS5wYWRTdGFydCg2LCAnMCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgIHJldHVybiAnMDAwMDAxJztcbiAgICAgIH1cbiAgIH0sXG4gICBnZXRSdW5uaW5nTm9Qcm9kdWN0S2V5OiBhc3luYyAoZGF0ZVByZWZpeCkgPT4ge1xuICAgICAgY29uc3QgcHJvZHVjdFJlZiA9IHJlZihmaXJlYmFzZSwgJ3Byb2R1Y3RzJyk7IFxuICAgICAgY29uc3QgZGF5UXVlcnkgPSBxdWVyeShwcm9kdWN0UmVmLCBvcmRlckJ5Q2hpbGQoJ3Byb2R1Y3RfaWQnKSwgc3RhcnRBdChgUF8ke2RhdGVQcmVmaXh9X2ApLCBlbmRBdChgUF8ke2RhdGVQcmVmaXh9Xzk5OTk5OWApLCBsaW1pdFRvTGFzdCgxKSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0KGRheVF1ZXJ5KTtcbiAgICAgIGlmIChzbmFwc2hvdC5leGlzdHMoKSkge1xuICAgICAgICAgY29uc3QgbGFzdFByb2R1Y3QgPSBPYmplY3QudmFsdWVzKHNuYXBzaG90LnZhbCgpKVswXTtcbiAgICAgICAgIGNvbnN0IGxhc3RSdW5uaW5nTm8gPSBwYXJzZUludChsYXN0UHJvZHVjdC5wcm9kdWN0X2lkLnNwbGl0KCdfJylbMl0pO1xuICAgICAgICAgcmV0dXJuIFN0cmluZyhsYXN0UnVubmluZ05vICsgMSkucGFkU3RhcnQoNiwgJzAnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICByZXR1cm4gJzAwMDAwMSc7XG4gICAgICB9XG4gICB9LFxuICAgZ2V0UnVubmluZ05vT3JkZXJLZXk6IGFzeW5jIChkYXRlUHJlZml4KSA9PiB7XG4gICAgICBjb25zdCBvcmRlclJlZiA9IHJlZihmaXJlYmFzZSwgJ29yZGVycycpOyBcbiAgICAgIGNvbnN0IGRheVF1ZXJ5ID0gcXVlcnkob3JkZXJSZWYsIG9yZGVyQnlDaGlsZCgndHJhbnNhY3Rpb25ObycpLCBzdGFydEF0KGBUXyR7ZGF0ZVByZWZpeH1fYCksIGVuZEF0KGBUXyR7ZGF0ZVByZWZpeH1fOTk5OTk5YCksIGxpbWl0VG9MYXN0KDEpKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXQoZGF5UXVlcnkpO1xuICAgICAgaWYgKHNuYXBzaG90LmV4aXN0cygpKSB7XG4gICAgICAgICBjb25zdCBsYXN0T3JkZXIgPSBPYmplY3QudmFsdWVzKHNuYXBzaG90LnZhbCgpKVswXTtcbiAgICAgICAgIGNvbnN0IGxhc3RSdW5uaW5nTm8gPSBwYXJzZUludChsYXN0T3JkZXIudHJhbnNhY3Rpb25Oby5zcGxpdCgnXycpWzJdKTtcbiAgICAgICAgXG4gICAgICAgICByZXR1cm4gU3RyaW5nKGxhc3RSdW5uaW5nTm8gKyAxKS5wYWRTdGFydCg2LCAnMCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgIHJldHVybiAnMDAwMDAxJztcbiAgICAgIH1cbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxP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","map":{"version":3,"names":["axios","require","secret","firebase","query","orderByChild","equalTo","child","get","ref","push","set","remove","startAt","endAt","limitToLast","module","exports","getRunningNoUserKey","datePrefix","userRef","dayQuery","snapshot","exists","lastUser","Object","values","val","lastRunningNo","parseInt","userId","split","String","padStart","getRunningNoProductKey","productRef","lastProduct","product_id","getRunningNoOrderKey","orderRef","lastOrder","transactionNo"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/","sources":["calculate.js"],"sourcesContent":["const axios = require('axios')\nconst { secret, firebase } = require('../configs');\nconst { query, orderByChild, equalTo, child, get, ref, push, set, remove, startAt, endAt, limitToLast } = require(\"@firebase/database\");\n\n\nmodule.exports = {\n   getRunningNoUserKey: async (datePrefix) => {\n      const userRef = ref(firebase, 'users'); \n      const dayQuery = query(userRef, orderByChild('userId'), startAt(`${datePrefix}_`), endAt(`${datePrefix}_999999`), limitToLast(1));\n      \n      const snapshot = await get(dayQuery);\n      if (snapshot.exists()) {\n         const lastUser = Object.values(snapshot.val())[0];\n         const lastRunningNo = parseInt(lastUser.userId.split('_')[1]); \n         return String(lastRunningNo + 1).padStart(6, '0');\n      } else {\n         return '000001';\n      }\n   },\n   getRunningNoProductKey: async (datePrefix) => {\n      const productRef = ref(firebase, 'products'); \n      const dayQuery = query(productRef, orderByChild('product_id'), startAt(`P_${datePrefix}_`), endAt(`P_${datePrefix}_999999`), limitToLast(1));\n      \n      const snapshot = await get(dayQuery);\n      if (snapshot.exists()) {\n         const lastProduct = Object.values(snapshot.val())[0];\n         const lastRunningNo = parseInt(lastProduct.product_id.split('_')[2]);\n         return String(lastRunningNo + 1).padStart(6, '0');\n      } else {\n         return '000001';\n      }\n   },\n   getRunningNoOrderKey: async (datePrefix) => {\n      const orderRef = ref(firebase, 'orders'); \n      const dayQuery = query(orderRef, orderByChild('transactionNo'), startAt(`T_${datePrefix}_`), endAt(`T_${datePrefix}_999999`), limitToLast(1));\n      \n      const snapshot = await get(dayQuery);\n      if (snapshot.exists()) {\n         const lastOrder = Object.values(snapshot.val())[0];\n         const lastRunningNo = parseInt(lastOrder.transactionNo.split('_')[2]);\n        \n         return String(lastRunningNo + 1).padStart(6, '0');\n      } else {\n         return '000001';\n      }\n  }\n}\n"],"mappings":"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"}},"mtime":1692897077801},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/utils/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/utils/pagination.util.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const Router = require('koa-joi-router');\nconst Joi = Router.Joi;\nconst getPagination = (page, size) => {\n  const limit = parseInt(size, 10) || 10;\n  const offset = (parseInt(page, 10) - 1) * limit || 0;\n  return {\n    limit,\n    offset\n  };\n};\nmodule.exports = {\n  getPagination\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSb3V0ZXIiLCJyZXF1aXJlIiwiSm9pIiwiZ2V0UGFnaW5hdGlvbiIsInBhZ2UiLCJzaXplIiwibGltaXQiLCJwYXJzZUludCIsIm9mZnNldCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6Ii9Vc2Vycy9tYWNwcm8vRGVza3RvcC9JbmZvbWF0aW9uL1Rlc3Qvbm9kZS1iYWNrLWVuZC9zcmMvdXRpbHMvIiwic291cmNlcyI6WyJwYWdpbmF0aW9uLnV0aWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUm91dGVyID0gcmVxdWlyZSgna29hLWpvaS1yb3V0ZXInKVxuY29uc3QgSm9pID0gUm91dGVyLkpvaVxuXG5jb25zdCBnZXRQYWdpbmF0aW9uID0gKHBhZ2UsIHNpemUpID0+IHtcbiAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHNpemUsIDEwKSB8fCAxMDtcbiAgICBjb25zdCBvZmZzZXQgPSAocGFyc2VJbnQocGFnZSwgMTApIC0gMSkgKiBsaW1pdCB8fCAwO1xuXG4gICAgcmV0dXJuIHsgbGltaXQsIG9mZnNldCB9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBnZXRQYWdpbmF0aW9uLFxufSJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDeEMsTUFBTUMsR0FBRyxHQUFHRixNQUFNLENBQUNFLEdBQUc7QUFFdEIsTUFBTUMsYUFBYSxHQUFHQSxDQUFDQyxJQUFJLEVBQUVDLElBQUksS0FBSztFQUNsQyxNQUFNQyxLQUFLLEdBQUdDLFFBQVEsQ0FBQ0YsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLEVBQUU7RUFDdEMsTUFBTUcsTUFBTSxHQUFHLENBQUNELFFBQVEsQ0FBQ0gsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSUUsS0FBSyxJQUFJLENBQUM7RUFFcEQsT0FBTztJQUFFQSxLQUFLO0lBQUVFO0VBQU8sQ0FBQztBQUM1QixDQUFDO0FBRURDLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHO0VBQ2JQO0FBQ0osQ0FBQyJ9","map":{"version":3,"names":["Router","require","Joi","getPagination","page","size","limit","parseInt","offset","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/utils/","sources":["pagination.util.js"],"sourcesContent":["const Router = require('koa-joi-router')\nconst Joi = Router.Joi\n\nconst getPagination = (page, size) => {\n    const limit = parseInt(size, 10) || 10;\n    const offset = (parseInt(page, 10) - 1) * limit || 0;\n\n    return { limit, offset };\n}\n\nmodule.exports = {\n    getPagination,\n}"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AACxC,MAAMC,GAAG,GAAGF,MAAM,CAACE,GAAG;AAEtB,MAAMC,aAAa,GAAGA,CAACC,IAAI,EAAEC,IAAI,KAAK;EAClC,MAAMC,KAAK,GAAGC,QAAQ,CAACF,IAAI,EAAE,EAAE,CAAC,IAAI,EAAE;EACtC,MAAMG,MAAM,GAAG,CAACD,QAAQ,CAACH,IAAI,EAAE,EAAE,CAAC,GAAG,CAAC,IAAIE,KAAK,IAAI,CAAC;EAEpD,OAAO;IAAEA,KAAK;IAAEE;EAAO,CAAC;AAC5B,CAAC;AAEDC,MAAM,CAACC,OAAO,GAAG;EACbP;AACJ,CAAC"}},"mtime":1692890216699},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/middleware/auth.middleware.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const {\n  secret\n} = require('./../configs');\nconst jwt = require('jsonwebtoken');\nconst {\n  result_error\n} = require(\"./../commons/convert\");\nmodule.exports = async (ctx, next) => {\n  console.log('ctx.request.headers : ', ctx.request.headers);\n  let {\n    authorization\n  } = ctx.request.headers;\n  if (!authorization) {\n    ctx.status = 403;\n    ctx.body = result_error(403, {\n      name: 'Check Token',\n      message: 'Check if you have given the token or not.'\n    });\n    return;\n  }\n\n  // Check if the Authorization header is in the correct format\n  if (!authorization.startsWith('Bearer ')) {\n    ctx.status = 401;\n    ctx.body = result_error(401, {\n      name: 'Error Format Token',\n      message: 'Invalid Authorization header format. Format is \"Authorization: Bearer <token>\"'\n    });\n    return;\n  }\n\n  // Remove Bearer from string\n  let token = authorization.slice(7, authorization.length);\n  return jwt.verify(token, secret, (err, decoded) => {\n    if (err) {\n      ctx.status = 401;\n      ctx.body = result_error(401, {\n        name: 'Unauthorized',\n        message: 'Your token is invalid. or expired'\n      });\n      return;\n    }\n    ctx.request.adminUser = decoded;\n    return next();\n  });\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzZWNyZXQiLCJyZXF1aXJlIiwiand0IiwicmVzdWx0X2Vycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsImN0eCIsIm5leHQiLCJjb25zb2xlIiwibG9nIiwicmVxdWVzdCIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3RhdHVzIiwiYm9keSIsIm5hbWUiLCJtZXNzYWdlIiwic3RhcnRzV2l0aCIsInRva2VuIiwic2xpY2UiLCJsZW5ndGgiLCJ2ZXJpZnkiLCJlcnIiLCJkZWNvZGVkIiwiYWRtaW5Vc2VyIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvbWFjcHJvL0Rlc2t0b3AvSW5mb21hdGlvbi9UZXN0L25vZGUtYmFjay1lbmQvc3JjL21pZGRsZXdhcmUvIiwic291cmNlcyI6WyJhdXRoLm1pZGRsZXdhcmUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBzZWNyZXQgfSA9IHJlcXVpcmUoJy4vLi4vY29uZmlncycpXG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKVxuY29uc3QgeyByZXN1bHRfZXJyb3J9ID0gcmVxdWlyZShcIi4vLi4vY29tbW9ucy9jb252ZXJ0XCIpO1xuIFxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoY3R4LCBuZXh0KSA9PiB7XG4gICBjb25zb2xlLmxvZygnY3R4LnJlcXVlc3QuaGVhZGVycyA6ICcsY3R4LnJlcXVlc3QuaGVhZGVycylcbiAgIGxldCB7IGF1dGhvcml6YXRpb24gfSA9IGN0eC5yZXF1ZXN0LmhlYWRlcnNcblxuICAgaWYgKCFhdXRob3JpemF0aW9uKSB7XG4gICAgICBjdHguc3RhdHVzID0gNDAzIFxuICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNDAzLHtuYW1lOiAnQ2hlY2sgVG9rZW4nLG1lc3NhZ2U6ICdDaGVjayBpZiB5b3UgaGF2ZSBnaXZlbiB0aGUgdG9rZW4gb3Igbm90Lid9KSBcbiAgICAgXG4gICAgICByZXR1cm5cbiAgIH1cblxuICAgLy8gQ2hlY2sgaWYgdGhlIEF1dGhvcml6YXRpb24gaGVhZGVyIGlzIGluIHRoZSBjb3JyZWN0IGZvcm1hdFxuICAgaWYgKCFhdXRob3JpemF0aW9uLnN0YXJ0c1dpdGgoJ0JlYXJlciAnKSkge1xuICAgICAgY3R4LnN0YXR1cyA9IDQwMVxuICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNDAxLHtuYW1lOiAnRXJyb3IgRm9ybWF0IFRva2VuJyxtZXNzYWdlOiAnSW52YWxpZCBBdXRob3JpemF0aW9uIGhlYWRlciBmb3JtYXQuIEZvcm1hdCBpcyBcIkF1dGhvcml6YXRpb246IEJlYXJlciA8dG9rZW4+XCInfSkgXG4gICAgICByZXR1cm5cbiAgIH1cblxuICAgLy8gUmVtb3ZlIEJlYXJlciBmcm9tIHN0cmluZ1xuICAgbGV0IHRva2VuID0gYXV0aG9yaXphdGlvbi5zbGljZSg3LCBhdXRob3JpemF0aW9uLmxlbmd0aCk7XG4gICBcbiAgIHJldHVybiBqd3QudmVyaWZ5KHRva2VuLCBzZWNyZXQsIChlcnIsIGRlY29kZWQpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgIGN0eC5zdGF0dXMgPSA0MDEgXG4gICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig0MDEse25hbWU6ICdVbmF1dGhvcml6ZWQnLG1lc3NhZ2U6ICdZb3VyIHRva2VuIGlzIGludmFsaWQuIG9yIGV4cGlyZWQnfSkgIFxuICAgICAgICAgcmV0dXJuXG4gICAgICB9XG4gICAgICBjdHgucmVxdWVzdC5hZG1pblVzZXIgPSBkZWNvZGVkXG4gICAgICByZXR1cm4gbmV4dCgpXG4gICB9KVxufVxuXG4iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU07RUFBRUE7QUFBTyxDQUFDLEdBQUdDLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDMUMsTUFBTUMsR0FBRyxHQUFHRCxPQUFPLENBQUMsY0FBYyxDQUFDO0FBQ25DLE1BQU07RUFBRUU7QUFBWSxDQUFDLEdBQUdGLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQztBQUV2REcsTUFBTSxDQUFDQyxPQUFPLEdBQUcsT0FBT0MsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDbkNDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLHdCQUF3QixFQUFDSCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDO0VBQ3pELElBQUk7SUFBRUM7RUFBYyxDQUFDLEdBQUdOLEdBQUcsQ0FBQ0ksT0FBTyxDQUFDQyxPQUFPO0VBRTNDLElBQUksQ0FBQ0MsYUFBYSxFQUFFO0lBQ2pCTixHQUFHLENBQUNPLE1BQU0sR0FBRyxHQUFHO0lBQ2hCUCxHQUFHLENBQUNRLElBQUksR0FBR1gsWUFBWSxDQUFDLEdBQUcsRUFBQztNQUFDWSxJQUFJLEVBQUUsYUFBYTtNQUFDQyxPQUFPLEVBQUU7SUFBMkMsQ0FBQyxDQUFDO0lBRXZHO0VBQ0g7O0VBRUE7RUFDQSxJQUFJLENBQUNKLGFBQWEsQ0FBQ0ssVUFBVSxDQUFDLFNBQVMsQ0FBQyxFQUFFO0lBQ3ZDWCxHQUFHLENBQUNPLE1BQU0sR0FBRyxHQUFHO0lBQ2hCUCxHQUFHLENBQUNRLElBQUksR0FBR1gsWUFBWSxDQUFDLEdBQUcsRUFBQztNQUFDWSxJQUFJLEVBQUUsb0JBQW9CO01BQUNDLE9BQU8sRUFBRTtJQUFnRixDQUFDLENBQUM7SUFDbko7RUFDSDs7RUFFQTtFQUNBLElBQUlFLEtBQUssR0FBR04sYUFBYSxDQUFDTyxLQUFLLENBQUMsQ0FBQyxFQUFFUCxhQUFhLENBQUNRLE1BQU0sQ0FBQztFQUV4RCxPQUFPbEIsR0FBRyxDQUFDbUIsTUFBTSxDQUFDSCxLQUFLLEVBQUVsQixNQUFNLEVBQUUsQ0FBQ3NCLEdBQUcsRUFBRUMsT0FBTyxLQUFLO0lBQ2hELElBQUlELEdBQUcsRUFBRTtNQUNOaEIsR0FBRyxDQUFDTyxNQUFNLEdBQUcsR0FBRztNQUNoQlAsR0FBRyxDQUFDUSxJQUFJLEdBQUdYLFlBQVksQ0FBQyxHQUFHLEVBQUM7UUFBQ1ksSUFBSSxFQUFFLGNBQWM7UUFBQ0MsT0FBTyxFQUFFO01BQW1DLENBQUMsQ0FBQztNQUNoRztJQUNIO0lBQ0FWLEdBQUcsQ0FBQ0ksT0FBTyxDQUFDYyxTQUFTLEdBQUdELE9BQU87SUFDL0IsT0FBT2hCLElBQUksQ0FBQyxDQUFDO0VBQ2hCLENBQUMsQ0FBQztBQUNMLENBQUMifQ==","map":{"version":3,"names":["secret","require","jwt","result_error","module","exports","ctx","next","console","log","request","headers","authorization","status","body","name","message","startsWith","token","slice","length","verify","err","decoded","adminUser"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/middleware/","sources":["auth.middleware.js"],"sourcesContent":["const { secret } = require('./../configs')\nconst jwt = require('jsonwebtoken')\nconst { result_error} = require(\"./../commons/convert\");\n \nmodule.exports = async (ctx, next) => {\n   console.log('ctx.request.headers : ',ctx.request.headers)\n   let { authorization } = ctx.request.headers\n\n   if (!authorization) {\n      ctx.status = 403 \n      ctx.body = result_error(403,{name: 'Check Token',message: 'Check if you have given the token or not.'}) \n     \n      return\n   }\n\n   // Check if the Authorization header is in the correct format\n   if (!authorization.startsWith('Bearer ')) {\n      ctx.status = 401\n      ctx.body = result_error(401,{name: 'Error Format Token',message: 'Invalid Authorization header format. Format is \"Authorization: Bearer <token>\"'}) \n      return\n   }\n\n   // Remove Bearer from string\n   let token = authorization.slice(7, authorization.length);\n   \n   return jwt.verify(token, secret, (err, decoded) => {\n      if (err) {\n         ctx.status = 401 \n         ctx.body = result_error(401,{name: 'Unauthorized',message: 'Your token is invalid. or expired'})  \n         return\n      }\n      ctx.request.adminUser = decoded\n      return next()\n   })\n}\n\n"],"mappings":"AAAA,MAAM;EAAEA;AAAO,CAAC,GAAGC,OAAO,CAAC,cAAc,CAAC;AAC1C,MAAMC,GAAG,GAAGD,OAAO,CAAC,cAAc,CAAC;AACnC,MAAM;EAAEE;AAAY,CAAC,GAAGF,OAAO,CAAC,sBAAsB,CAAC;AAEvDG,MAAM,CAACC,OAAO,GAAG,OAAOC,GAAG,EAAEC,IAAI,KAAK;EACnCC,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAACH,GAAG,CAACI,OAAO,CAACC,OAAO,CAAC;EACzD,IAAI;IAAEC;EAAc,CAAC,GAAGN,GAAG,CAACI,OAAO,CAACC,OAAO;EAE3C,IAAI,CAACC,aAAa,EAAE;IACjBN,GAAG,CAACO,MAAM,GAAG,GAAG;IAChBP,GAAG,CAACQ,IAAI,GAAGX,YAAY,CAAC,GAAG,EAAC;MAACY,IAAI,EAAE,aAAa;MAACC,OAAO,EAAE;IAA2C,CAAC,CAAC;IAEvG;EACH;;EAEA;EACA,IAAI,CAACJ,aAAa,CAACK,UAAU,CAAC,SAAS,CAAC,EAAE;IACvCX,GAAG,CAACO,MAAM,GAAG,GAAG;IAChBP,GAAG,CAACQ,IAAI,GAAGX,YAAY,CAAC,GAAG,EAAC;MAACY,IAAI,EAAE,oBAAoB;MAACC,OAAO,EAAE;IAAgF,CAAC,CAAC;IACnJ;EACH;;EAEA;EACA,IAAIE,KAAK,GAAGN,aAAa,CAACO,KAAK,CAAC,CAAC,EAAEP,aAAa,CAACQ,MAAM,CAAC;EAExD,OAAOlB,GAAG,CAACmB,MAAM,CAACH,KAAK,EAAElB,MAAM,EAAE,CAACsB,GAAG,EAAEC,OAAO,KAAK;IAChD,IAAID,GAAG,EAAE;MACNhB,GAAG,CAACO,MAAM,GAAG,GAAG;MAChBP,GAAG,CAACQ,IAAI,GAAGX,YAAY,CAAC,GAAG,EAAC;QAACY,IAAI,EAAE,cAAc;QAACC,OAAO,EAAE;MAAmC,CAAC,CAAC;MAChG;IACH;IACAV,GAAG,CAACI,OAAO,CAACc,SAAS,GAAGD,OAAO;IAC/B,OAAOhB,IAAI,CAAC,CAAC;EAChB,CAAC,CAAC;AACL,CAAC"}},"mtime":1692772033370},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/validate.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const path = require('path');\nconst fs = require('fs');\nconst {\n  schemaToJoi\n} = require('./convert');\nmodule.exports = {\n  validateSchema: Path => {\n    const schemaFilePath = path.join(__dirname, Path);\n    const openApiSchema = JSON.parse(fs.readFileSync(schemaFilePath, 'utf8'));\n    return {\n      body: schemaToJoi(openApiSchema),\n      type: \"json\"\n    };\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsImZzIiwic2NoZW1hVG9Kb2kiLCJtb2R1bGUiLCJleHBvcnRzIiwidmFsaWRhdGVTY2hlbWEiLCJQYXRoIiwic2NoZW1hRmlsZVBhdGgiLCJqb2luIiwiX19kaXJuYW1lIiwib3BlbkFwaVNjaGVtYSIsIkpTT04iLCJwYXJzZSIsInJlYWRGaWxlU3luYyIsImJvZHkiLCJ0eXBlIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvbWFjcHJvL0Rlc2t0b3AvSW5mb21hdGlvbi9UZXN0L25vZGUtYmFjay1lbmQvc3JjL2NvbW1vbnMvIiwic291cmNlcyI6WyJ2YWxpZGF0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG5jb25zdCB7IHNjaGVtYVRvSm9pIH0gPSByZXF1aXJlKCcuL2NvbnZlcnQnKSAgXG5cblxubW9kdWxlLmV4cG9ydHMgPSB7IFxuICAgIHZhbGlkYXRlU2NoZW1hOiAoUGF0aCkgPT4geyBcbiAgICAgICAgY29uc3Qgc2NoZW1hRmlsZVBhdGggPXBhdGguam9pbihfX2Rpcm5hbWUsIFBhdGgpO1xuICAgICAgICBjb25zdCBvcGVuQXBpU2NoZW1hID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoc2NoZW1hRmlsZVBhdGgsICd1dGY4JykpO1xuICAgICAgICAgXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBib2R5OiBzY2hlbWFUb0pvaShvcGVuQXBpU2NoZW1hKSxcbiAgICAgICAgICAgIHR5cGU6IFwianNvblwiLFxuICAgICAgICB9XG4gICAgfVxufSAiXSwibWFwcGluZ3MiOiJBQUNBLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUM1QixNQUFNQyxFQUFFLEdBQUdELE9BQU8sQ0FBQyxJQUFJLENBQUM7QUFDeEIsTUFBTTtFQUFFRTtBQUFZLENBQUMsR0FBR0YsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUc1Q0csTUFBTSxDQUFDQyxPQUFPLEdBQUc7RUFDYkMsY0FBYyxFQUFHQyxJQUFJLElBQUs7SUFDdEIsTUFBTUMsY0FBYyxHQUFFUixJQUFJLENBQUNTLElBQUksQ0FBQ0MsU0FBUyxFQUFFSCxJQUFJLENBQUM7SUFDaEQsTUFBTUksYUFBYSxHQUFHQyxJQUFJLENBQUNDLEtBQUssQ0FBQ1gsRUFBRSxDQUFDWSxZQUFZLENBQUNOLGNBQWMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUV6RSxPQUFPO01BQ0hPLElBQUksRUFBRVosV0FBVyxDQUFDUSxhQUFhLENBQUM7TUFDaENLLElBQUksRUFBRTtJQUNWLENBQUM7RUFDTDtBQUNKLENBQUMifQ==","map":{"version":3,"names":["path","require","fs","schemaToJoi","module","exports","validateSchema","Path","schemaFilePath","join","__dirname","openApiSchema","JSON","parse","readFileSync","body","type"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/commons/","sources":["validate.js"],"sourcesContent":["\nconst path = require('path');\nconst fs = require('fs');\nconst { schemaToJoi } = require('./convert')  \n\n\nmodule.exports = { \n    validateSchema: (Path) => { \n        const schemaFilePath =path.join(__dirname, Path);\n        const openApiSchema = JSON.parse(fs.readFileSync(schemaFilePath, 'utf8'));\n         \n        return {\n            body: schemaToJoi(openApiSchema),\n            type: \"json\",\n        }\n    }\n} "],"mappings":"AACA,MAAMA,IAAI,GAAGC,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC;AACxB,MAAM;EAAEE;AAAY,CAAC,GAAGF,OAAO,CAAC,WAAW,CAAC;AAG5CG,MAAM,CAACC,OAAO,GAAG;EACbC,cAAc,EAAGC,IAAI,IAAK;IACtB,MAAMC,cAAc,GAAER,IAAI,CAACS,IAAI,CAACC,SAAS,EAAEH,IAAI,CAAC;IAChD,MAAMI,aAAa,GAAGC,IAAI,CAACC,KAAK,CAACX,EAAE,CAACY,YAAY,CAACN,cAAc,EAAE,MAAM,CAAC,CAAC;IAEzE,OAAO;MACHO,IAAI,EAAEZ,WAAW,CAACQ,aAAa,CAAC;MAChCK,IAAI,EAAE;IACV,CAAC;EACL;AACJ,CAAC"}},"mtime":1692772020920},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/product.router.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const Router = require(\"koa-joi-router\");\nconst {\n  product\n} = require(\"../controllers\");\nconst authMiddleware = require(\"../middleware/auth.middleware\");\nconst {\n  validateSchema\n} = require('../commons/validate');\nconst path = require('path');\nconst filename = path.basename(__filename).split('.')[0];\nconst directory = `../../docs/schemas/${filename}/Request/`;\nconst api = Router();\napi.prefix(\"/product\");\napi.route({\n  method: \"GET\",\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  path: \"/\",\n  handler: product.getProducts\n});\napi.route({\n  method: \"POST\",\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  path: \"/\",\n  validate: validateSchema(directory + 'create.json'),\n  handler: product.createProduct\n});\napi.route({\n  method: \"PUT\",\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  path: \"/\",\n  validate: validateSchema(directory + 'update.json'),\n  handler: product.updateProduct\n});\napi.route({\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: \"GET\",\n  path: \"/:product_id\",\n  handler: product.getProductById\n});\napi.route({\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: \"DELETE\",\n  path: \"/:product_id\",\n  handler: product.deleteProduct\n});\nmodule.exports = api;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSb3V0ZXIiLCJyZXF1aXJlIiwicHJvZHVjdCIsImF1dGhNaWRkbGV3YXJlIiwidmFsaWRhdGVTY2hlbWEiLCJwYXRoIiwiZmlsZW5hbWUiLCJiYXNlbmFtZSIsIl9fZmlsZW5hbWUiLCJzcGxpdCIsImRpcmVjdG9yeSIsImFwaSIsInByZWZpeCIsInJvdXRlIiwibWV0aG9kIiwicHJlIiwiY3R4IiwibmV4dCIsImhhbmRsZXIiLCJnZXRQcm9kdWN0cyIsInZhbGlkYXRlIiwiY3JlYXRlUHJvZHVjdCIsInVwZGF0ZVByb2R1Y3QiLCJnZXRQcm9kdWN0QnlJZCIsImRlbGV0ZVByb2R1Y3QiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiIvVXNlcnMvbWFjcHJvL0Rlc2t0b3AvSW5mb21hdGlvbi9UZXN0L25vZGUtYmFjay1lbmQvc3JjL3JvdXRlcnMvIiwic291cmNlcyI6WyJwcm9kdWN0LnJvdXRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBSb3V0ZXIgPSByZXF1aXJlKFwia29hLWpvaS1yb3V0ZXJcIik7IFxuY29uc3QgeyBwcm9kdWN0IH0gPSByZXF1aXJlKFwiLi4vY29udHJvbGxlcnNcIik7XG5jb25zdCBhdXRoTWlkZGxld2FyZSA9IHJlcXVpcmUoXCIuLi9taWRkbGV3YXJlL2F1dGgubWlkZGxld2FyZVwiKTtcbiBcbmNvbnN0IHsgdmFsaWRhdGVTY2hlbWEgfSA9IHJlcXVpcmUoJy4uL2NvbW1vbnMvdmFsaWRhdGUnKSAgXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpOyBcbmNvbnN0IGZpbGVuYW1lID0gcGF0aC5iYXNlbmFtZShfX2ZpbGVuYW1lKS5zcGxpdCgnLicpWzBdOyBcbmNvbnN0IGRpcmVjdG9yeSA9IGAuLi8uLi9kb2NzL3NjaGVtYXMvJHtmaWxlbmFtZX0vUmVxdWVzdC9gIFxuIFxuY29uc3QgYXBpID0gUm91dGVyKCk7XG5hcGkucHJlZml4KFwiL3Byb2R1Y3RcIik7IFxuIFxuYXBpLnJvdXRlKHsgIFxuICBtZXRob2Q6IFwiR0VUXCIsXG4gIHByZTogYXN5bmMgKGN0eCwgbmV4dCkgPT4gYXdhaXQgYXV0aE1pZGRsZXdhcmUoY3R4LCBuZXh0KSxcbiAgcGF0aDogXCIvXCIsXG4gIGhhbmRsZXI6IHByb2R1Y3QuZ2V0UHJvZHVjdHMsXG59KTtcblxuYXBpLnJvdXRlKHsgIFxuICBtZXRob2Q6IFwiUE9TVFwiLFxuICBwcmU6IGFzeW5jIChjdHgsIG5leHQpID0+IGF3YWl0IGF1dGhNaWRkbGV3YXJlKGN0eCwgbmV4dCksXG4gIHBhdGg6IFwiL1wiLFxuICB2YWxpZGF0ZTogIHZhbGlkYXRlU2NoZW1hKGRpcmVjdG9yeSsnY3JlYXRlLmpzb24nKSxcbiAgaGFuZGxlcjogcHJvZHVjdC5jcmVhdGVQcm9kdWN0LFxufSk7XG5cbmFwaS5yb3V0ZSh7ICBcbiAgbWV0aG9kOiBcIlBVVFwiLFxuICBwcmU6IGFzeW5jIChjdHgsIG5leHQpID0+IGF3YWl0IGF1dGhNaWRkbGV3YXJlKGN0eCwgbmV4dCksXG4gIHBhdGg6IFwiL1wiLFxuICB2YWxpZGF0ZTogIHZhbGlkYXRlU2NoZW1hKGRpcmVjdG9yeSsndXBkYXRlLmpzb24nKSxcbiAgaGFuZGxlcjogcHJvZHVjdC51cGRhdGVQcm9kdWN0LFxufSk7XG4gXG5hcGkucm91dGUoeyBcbiAgcHJlOiBhc3luYyAoY3R4LCBuZXh0KSA9PiBhd2FpdCBhdXRoTWlkZGxld2FyZShjdHgsIG5leHQpLFxuICBtZXRob2Q6IFwiR0VUXCIsIFxuICBwYXRoOiBcIi86cHJvZHVjdF9pZFwiLFxuICBoYW5kbGVyOiBwcm9kdWN0LmdldFByb2R1Y3RCeUlkLFxufSk7XG4gXG5hcGkucm91dGUoeyBcbiAgcHJlOiBhc3luYyAoY3R4LCBuZXh0KSA9PiBhd2FpdCBhdXRoTWlkZGxld2FyZShjdHgsIG5leHQpLFxuICBtZXRob2Q6IFwiREVMRVRFXCIsIFxuICBwYXRoOiBcIi86cHJvZHVjdF9pZFwiLFxuICBoYW5kbGVyOiBwcm9kdWN0LmRlbGV0ZVByb2R1Y3QsXG59KTtcbiBc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","map":{"version":3,"names":["Router","require","product","authMiddleware","validateSchema","path","filename","basename","__filename","split","directory","api","prefix","route","method","pre","ctx","next","handler","getProducts","validate","createProduct","updateProduct","getProductById","deleteProduct","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/","sources":["product.router.js"],"sourcesContent":["const Router = require(\"koa-joi-router\"); \nconst { product } = require(\"../controllers\");\nconst authMiddleware = require(\"../middleware/auth.middleware\");\n \nconst { validateSchema } = require('../commons/validate')  \nconst path = require('path'); \nconst filename = path.basename(__filename).split('.')[0]; \nconst directory = `../../docs/schemas/${filename}/Request/` \n \nconst api = Router();\napi.prefix(\"/product\"); \n \napi.route({  \n  method: \"GET\",\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  path: \"/\",\n  handler: product.getProducts,\n});\n\napi.route({  \n  method: \"POST\",\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  path: \"/\",\n  validate:  validateSchema(directory+'create.json'),\n  handler: product.createProduct,\n});\n\napi.route({  \n  method: \"PUT\",\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  path: \"/\",\n  validate:  validateSchema(directory+'update.json'),\n  handler: product.updateProduct,\n});\n \napi.route({ \n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: \"GET\", \n  path: \"/:product_id\",\n  handler: product.getProductById,\n});\n \napi.route({ \n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: \"DELETE\", \n  path: \"/:product_id\",\n  handler: product.deleteProduct,\n});\n \nmodule.exports = api;\n"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AACxC,MAAM;EAAEC;AAAQ,CAAC,GAAGD,OAAO,CAAC,gBAAgB,CAAC;AAC7C,MAAME,cAAc,GAAGF,OAAO,CAAC,+BAA+B,CAAC;AAE/D,MAAM;EAAEG;AAAe,CAAC,GAAGH,OAAO,CAAC,qBAAqB,CAAC;AACzD,MAAMI,IAAI,GAAGJ,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMK,QAAQ,GAAGD,IAAI,CAACE,QAAQ,CAACC,UAAU,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACxD,MAAMC,SAAS,GAAI,sBAAqBJ,QAAS,WAAU;AAE3D,MAAMK,GAAG,GAAGX,MAAM,CAAC,CAAC;AACpBW,GAAG,CAACC,MAAM,CAAC,UAAU,CAAC;AAEtBD,GAAG,CAACE,KAAK,CAAC;EACRC,MAAM,EAAE,KAAK;EACbC,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMd,cAAc,CAACa,GAAG,EAAEC,IAAI,CAAC;EACzDZ,IAAI,EAAE,GAAG;EACTa,OAAO,EAAEhB,OAAO,CAACiB;AACnB,CAAC,CAAC;AAEFR,GAAG,CAACE,KAAK,CAAC;EACRC,MAAM,EAAE,MAAM;EACdC,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMd,cAAc,CAACa,GAAG,EAAEC,IAAI,CAAC;EACzDZ,IAAI,EAAE,GAAG;EACTe,QAAQ,EAAGhB,cAAc,CAACM,SAAS,GAAC,aAAa,CAAC;EAClDQ,OAAO,EAAEhB,OAAO,CAACmB;AACnB,CAAC,CAAC;AAEFV,GAAG,CAACE,KAAK,CAAC;EACRC,MAAM,EAAE,KAAK;EACbC,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMd,cAAc,CAACa,GAAG,EAAEC,IAAI,CAAC;EACzDZ,IAAI,EAAE,GAAG;EACTe,QAAQ,EAAGhB,cAAc,CAACM,SAAS,GAAC,aAAa,CAAC;EAClDQ,OAAO,EAAEhB,OAAO,CAACoB;AACnB,CAAC,CAAC;AAEFX,GAAG,CAACE,KAAK,CAAC;EACRE,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMd,cAAc,CAACa,GAAG,EAAEC,IAAI,CAAC;EACzDH,MAAM,EAAE,KAAK;EACbT,IAAI,EAAE,cAAc;EACpBa,OAAO,EAAEhB,OAAO,CAACqB;AACnB,CAAC,CAAC;AAEFZ,GAAG,CAACE,KAAK,CAAC;EACRE,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMd,cAAc,CAACa,GAAG,EAAEC,IAAI,CAAC;EACzDH,MAAM,EAAE,QAAQ;EAChBT,IAAI,EAAE,cAAc;EACpBa,OAAO,EAAEhB,OAAO,CAACsB;AACnB,CAAC,CAAC;AAEFC,MAAM,CAACC,OAAO,GAAGf,GAAG"}},"mtime":1692894644985},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/index.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const fs = require('fs');\nconst camelCase = require('camelcase');\nconst path = require('path');\nconst fileName = path.basename(__filename);\nconst controllers = {};\nfs.readdirSync(__dirname).filter(file => {\n  return file.indexOf('.') !== 0 && file !== fileName && file.slice(-3) === '.js';\n}).forEach(file => {\n  const controllerName = file.split('.');\n  const converterCamelCase = camelCase(controllerName[0]);\n  controllers[converterCamelCase] = require(path.join(__dirname, file));\n});\nmodule.exports = controllers;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmcyIsInJlcXVpcmUiLCJjYW1lbENhc2UiLCJwYXRoIiwiZmlsZU5hbWUiLCJiYXNlbmFtZSIsIl9fZmlsZW5hbWUiLCJjb250cm9sbGVycyIsInJlYWRkaXJTeW5jIiwiX19kaXJuYW1lIiwiZmlsdGVyIiwiZmlsZSIsImluZGV4T2YiLCJzbGljZSIsImZvckVhY2giLCJjb250cm9sbGVyTmFtZSIsInNwbGl0IiwiY29udmVydGVyQ2FtZWxDYXNlIiwiam9pbiIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6Ii9Vc2Vycy9tYWNwcm8vRGVza3RvcC9JbmZvbWF0aW9uL1Rlc3Qvbm9kZS1iYWNrLWVuZC9zcmMvY29udHJvbGxlcnMvIiwic291cmNlcyI6WyJpbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJylcbmNvbnN0IGNhbWVsQ2FzZSA9IHJlcXVpcmUoJ2NhbWVsY2FzZScpXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpXG5cbmNvbnN0IGZpbGVOYW1lID0gcGF0aC5iYXNlbmFtZShfX2ZpbGVuYW1lKVxuY29uc3QgY29udHJvbGxlcnMgPSB7fVxuZnMucmVhZGRpclN5bmMoX19kaXJuYW1lKVxuICAuZmlsdGVyKChmaWxlKSA9PiB7XG4gICAgcmV0dXJuIGZpbGUuaW5kZXhPZignLicpICE9PSAwICYmIGZpbGUgIT09IGZpbGVOYW1lICYmIGZpbGUuc2xpY2UoLTMpID09PSAnLmpzJ1xuICB9KVxuICAuZm9yRWFjaCgoZmlsZSkgPT4ge1xuICAgIGNvbnN0IGNvbnRyb2xsZXJOYW1lID0gZmlsZS5zcGxpdCgnLicpXG4gICAgY29uc3QgY29udmVydGVyQ2FtZWxDYXNlID0gY2FtZWxDYXNlKGNvbnRyb2xsZXJOYW1lWzBdKVxuICAgIGNvbnRyb2xsZXJzW2NvbnZlcnRlckNhbWVsQ2FzZV0gPSByZXF1aXJlKHBhdGguam9pbihfX2Rpcm5hbWUsIGZpbGUpKVxuICB9KVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNvbnRyb2xsZXJzXG4iXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLEVBQUUsR0FBR0MsT0FBTyxDQUFDLElBQUksQ0FBQztBQUN4QixNQUFNQyxTQUFTLEdBQUdELE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDdEMsTUFBTUUsSUFBSSxHQUFHRixPQUFPLENBQUMsTUFBTSxDQUFDO0FBRTVCLE1BQU1HLFFBQVEsR0FBR0QsSUFBSSxDQUFDRSxRQUFRLENBQUNDLFVBQVUsQ0FBQztBQUMxQyxNQUFNQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO0FBQ3RCUCxFQUFFLENBQUNRLFdBQVcsQ0FBQ0MsU0FBUyxDQUFDLENBQ3RCQyxNQUFNLENBQUVDLElBQUksSUFBSztFQUNoQixPQUFPQSxJQUFJLENBQUNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUlELElBQUksS0FBS1AsUUFBUSxJQUFJTyxJQUFJLENBQUNFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUs7QUFDakYsQ0FBQyxDQUFDLENBQ0RDLE9BQU8sQ0FBRUgsSUFBSSxJQUFLO0VBQ2pCLE1BQU1JLGNBQWMsR0FBR0osSUFBSSxDQUFDSyxLQUFLLENBQUMsR0FBRyxDQUFDO0VBQ3RDLE1BQU1DLGtCQUFrQixHQUFHZixTQUFTLENBQUNhLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztFQUN2RFIsV0FBVyxDQUFDVSxrQkFBa0IsQ0FBQyxHQUFHaEIsT0FBTyxDQUFDRSxJQUFJLENBQUNlLElBQUksQ0FBQ1QsU0FBUyxFQUFFRSxJQUFJLENBQUMsQ0FBQztBQUN2RSxDQUFDLENBQUM7QUFFSlEsTUFBTSxDQUFDQyxPQUFPLEdBQUdiLFdBQVcifQ==","map":{"version":3,"names":["fs","require","camelCase","path","fileName","basename","__filename","controllers","readdirSync","__dirname","filter","file","indexOf","slice","forEach","controllerName","split","converterCamelCase","join","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/","sources":["index.js"],"sourcesContent":["const fs = require('fs')\nconst camelCase = require('camelcase')\nconst path = require('path')\n\nconst fileName = path.basename(__filename)\nconst controllers = {}\nfs.readdirSync(__dirname)\n  .filter((file) => {\n    return file.indexOf('.') !== 0 && file !== fileName && file.slice(-3) === '.js'\n  })\n  .forEach((file) => {\n    const controllerName = file.split('.')\n    const converterCamelCase = camelCase(controllerName[0])\n    controllers[converterCamelCase] = require(path.join(__dirname, file))\n  })\n\nmodule.exports = controllers\n"],"mappings":"AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAC,IAAI,CAAC;AACxB,MAAMC,SAAS,GAAGD,OAAO,CAAC,WAAW,CAAC;AACtC,MAAME,IAAI,GAAGF,OAAO,CAAC,MAAM,CAAC;AAE5B,MAAMG,QAAQ,GAAGD,IAAI,CAACE,QAAQ,CAACC,UAAU,CAAC;AAC1C,MAAMC,WAAW,GAAG,CAAC,CAAC;AACtBP,EAAE,CAACQ,WAAW,CAACC,SAAS,CAAC,CACtBC,MAAM,CAAEC,IAAI,IAAK;EAChB,OAAOA,IAAI,CAACC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IAAID,IAAI,KAAKP,QAAQ,IAAIO,IAAI,CAACE,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK;AACjF,CAAC,CAAC,CACDC,OAAO,CAAEH,IAAI,IAAK;EACjB,MAAMI,cAAc,GAAGJ,IAAI,CAACK,KAAK,CAAC,GAAG,CAAC;EACtC,MAAMC,kBAAkB,GAAGf,SAAS,CAACa,cAAc,CAAC,CAAC,CAAC,CAAC;EACvDR,WAAW,CAACU,kBAAkB,CAAC,GAAGhB,OAAO,CAACE,IAAI,CAACe,IAAI,CAACT,SAAS,EAAEE,IAAI,CAAC,CAAC;AACvE,CAAC,CAAC;AAEJQ,MAAM,CAACC,OAAO,GAAGb,WAAW"}},"mtime":1689656268981},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/product.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const {\n  secret,\n  firebase\n} = require('../configs');\nconst {\n  query,\n  orderByChild,\n  equalTo,\n  child,\n  get,\n  ref,\n  push,\n  set,\n  remove\n} = require(\"@firebase/database\");\nconst bcrypt = require('bcrypt');\nconst {\n  result,\n  result_error\n} = require(\"../commons/convert\");\nconst {\n  getRunningNoProductKey\n} = require('../commons/calculate');\nconst {\n  getPagination\n} = require('../utils/pagination.util');\nmodule.exports = {\n  async getProducts(ctx, _next) {\n    try {\n      const {\n        page,\n        size\n      } = ctx.request.query;\n      const {\n        limit,\n        offset\n      } = getPagination(page, size);\n      const productsRef = ref(firebase, 'products');\n      const productsSnapshot = await get(productsRef);\n      if (!productsSnapshot.exists()) {\n        ctx.body = result_error(404, \"No products found\");\n        return;\n      }\n      const products = productsSnapshot.val();\n\n      // Convert object of objects to an array of objects\n      // Filter out products with isDelete set to true\n      const productsArray = Object.keys(products).map(key => products[key]).filter(product => !product.isDelete);\n      const paginatedProducts = productsArray.slice(offset, offset + limit);\n      ctx.body = result(200, paginatedProducts);\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async getProductById(ctx, _next) {\n    try {\n      const productId = ctx.request.params.product_id; // Assuming you have set up your route to capture product_id as a URL parameter\n\n      const productRef = ref(firebase, 'products/' + productId);\n      const productSnapshot = await get(productRef);\n      if (!productSnapshot.exists()) {\n        ctx.body = result_error(404, \"Product not found\");\n        return;\n      }\n\n      // Get the product data without the Firebase key\n      const productData = Object.values(productSnapshot.val())[0];\n      ctx.body = result(200, productData);\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async createProduct(ctx, _next) {\n    try {\n      const {\n        product_name,\n        description,\n        quantity,\n        price\n      } = ctx.request.body;\n      let imageBase64 = \"\";\n      const imageFile = ctx.request.files && ctx.request.files.image;\n      if (imageFile) {\n        imageBase64 = fs.readFileSync(imageFile, 'base64');\n      }\n\n      // Create a reference to the products collection\n      const productRef = ref(firebase, 'products');\n      const currentDate = new Date();\n      const currentYear = currentDate.getFullYear();\n      const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');\n      const runningNo = await getRunningNoProductKey(currentYear + currentMonth);\n\n      // Construct the product_id\n      const productId = `P_${currentYear}${currentMonth}_${runningNo}`;\n      const specificProductRef = child(productRef, productId);\n\n      // Create a new product\n      await set(specificProductRef, {\n        product_id: productId,\n        product_name,\n        image: imageBase64,\n        description,\n        quantity,\n        price,\n        isDelete: false\n      });\n      ctx.body = result(200, {\n        message: \"Product creation successful\",\n        productId: productId\n      });\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async updateProduct(ctx, _next) {\n    try {\n      const {\n        product_id,\n        product_name,\n        description,\n        quantity,\n        price\n      } = ctx.request.body;\n      const productRef = ref(firebase, 'products/' + product_id);\n\n      // Check if the product exists\n      const productSnapshot = await get(productRef);\n      if (!productSnapshot.exists()) {\n        ctx.body = result_error(404, \"Data Not Found\");\n        return;\n      }\n\n      // Optionally handle image update if provided\n      let imageBase64 = null;\n      if (ctx.request.files && ctx.request.files.image) {\n        const imageFile = ctx.request.files.image;\n        imageBase64 = fs.readFileSync(imageFile.path, 'base64');\n      }\n      const updates = {\n        product_name,\n        description,\n        quantity,\n        price\n      };\n      if (imageBase64) {\n        updates.image = imageBase64;\n      }\n      await set(productRef, updates, true); // true for merge, so it only updates specified fields\n\n      ctx.body = result(200, {\n        message: \"Product update successful\",\n        productId: product_id\n      });\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async deleteProduct(ctx, _next) {\n    try {\n      const {\n        product_id\n      } = ctx.request.params.product_id;\n      const productRef = ref(firebase, 'products/' + product_id);\n      await set(productRef, {\n        isDelete: true\n      }, true); // mark as deleted\n\n      ctx.body = result(200, {\n        message: \"Product deleted successfully\"\n      });\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJzZWNyZXQiLCJmaXJlYmFzZSIsInJlcXVpcmUiLCJxdWVyeSIsIm9yZGVyQnlDaGlsZCIsImVxdWFsVG8iLCJjaGlsZCIsImdldCIsInJlZiIsInB1c2giLCJzZXQiLCJyZW1vdmUiLCJiY3J5cHQiLCJyZXN1bHQiLCJyZXN1bHRfZXJyb3IiLCJnZXRSdW5uaW5nTm9Qcm9kdWN0S2V5IiwiZ2V0UGFnaW5hdGlvbiIsIm1vZHVsZSIsImV4cG9ydHMiLCJnZXRQcm9kdWN0cyIsImN0eCIsIl9uZXh0IiwicGFnZSIsInNpemUiLCJyZXF1ZXN0IiwibGltaXQiLCJvZmZzZXQiLCJwcm9kdWN0c1JlZiIsInByb2R1Y3RzU25hcHNob3QiLCJleGlzdHMiLCJib2R5IiwicHJvZHVjdHMiLCJ2YWwiLCJwcm9kdWN0c0FycmF5IiwiT2JqZWN0Iiwia2V5cyIsIm1hcCIsImtleSIsImZpbHRlciIsInByb2R1Y3QiLCJpc0RlbGV0ZSIsInBhZ2luYXRlZFByb2R1Y3RzIiwic2xpY2UiLCJlcnIiLCJnZXRQcm9kdWN0QnlJZCIsInByb2R1Y3RJZCIsInBhcmFtcyIsInByb2R1Y3RfaWQiLCJwcm9kdWN0UmVmIiwicHJvZHVjdFNuYXBzaG90IiwicHJvZHVjdERhdGEiLCJ2YWx1ZXMiLCJjcmVhdGVQcm9kdWN0IiwicHJvZHVjdF9uYW1lIiwiZGVzY3JpcHRpb24iLCJxdWFudGl0eSIsInByaWNlIiwiaW1hZ2VCYXNlNjQiLCJpbWFnZUZpbGUiLCJmaWxlcyIsImltYWdlIiwiZnMiLCJyZWFkRmlsZVN5bmMiLCJjdXJyZW50RGF0ZSIsIkRhdGUiLCJjdXJyZW50WWVhciIsImdldEZ1bGxZZWFyIiwiY3VycmVudE1vbnRoIiwiU3RyaW5nIiwiZ2V0TW9udGgiLCJwYWRTdGFydCIsInJ1bm5pbmdObyIsInNwZWNpZmljUHJvZHVjdFJlZiIsIm1lc3NhZ2UiLCJ1cGRhdGVQcm9kdWN0IiwicGF0aCIsInVwZGF0ZXMiLCJkZWxldGVQcm9kdWN0Il0sInNvdXJjZVJvb3QiOiIvVXNlcnMvbWFjcHJvL0Rlc2t0b3AvSW5mb21hdGlvbi9UZXN0L25vZGUtYmFjay1lbmQvc3JjL2NvbnRyb2xsZXJzLyIsInNvdXJjZXMiOlsicHJvZHVjdC5jb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgc2VjcmV0LCBmaXJlYmFzZSB9ID0gcmVxdWlyZSgnLi4vY29uZmlncycpO1xuY29uc3QgeyBxdWVyeSwgb3JkZXJCeUNoaWxkLCBlcXVhbFRvLCBjaGlsZCwgZ2V0LCByZWYsIHB1c2gsIHNldCwgcmVtb3ZlIH0gPSByZXF1aXJlKFwiQGZpcmViYXNlL2RhdGFiYXNlXCIpO1xuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0Jyk7IFxuY29uc3QgeyByZXN1bHQsIHJlc3VsdF9lcnJvcn0gPSByZXF1aXJlKFwiLi4vY29tbW9ucy9jb252ZXJ0XCIpOyBcbmNvbnN0IHsgZ2V0UnVubmluZ05vUHJvZHVjdEtleSB9ID0gcmVxdWlyZSgnLi4vY29tbW9ucy9jYWxjdWxhdGUnKTtcbmNvbnN0IHsgZ2V0UGFnaW5hdGlvbiB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvcGFnaW5hdGlvbi51dGlsJylcblxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBhc3luYyBnZXRQcm9kdWN0cyhjdHgsIF9uZXh0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IHBhZ2UsIHNpemUgfSA9IGN0eC5yZXF1ZXN0LnF1ZXJ5O1xuICAgICAgICAgICAgY29uc3QgeyBsaW1pdCwgb2Zmc2V0IH0gPSBnZXRQYWdpbmF0aW9uKHBhZ2UsIHNpemUpO1xuICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHByb2R1Y3RzUmVmID0gcmVmKGZpcmViYXNlLCAncHJvZHVjdHMnKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2R1Y3RzU25hcHNob3QgPSBhd2FpdCBnZXQocHJvZHVjdHNSZWYpO1xuICAgICAgICBcbiAgICAgICAgICAgIGlmICghcHJvZHVjdHNTbmFwc2hvdC5leGlzdHMoKSkge1xuICAgICAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDQwNCwgXCJObyBwcm9kdWN0cyBmb3VuZFwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICBjb25zdCBwcm9kdWN0cyA9IHByb2R1Y3RzU25hcHNob3QudmFsKCk7XG4gICAgXG4gICAgICAgICAgICAvLyBDb252ZXJ0IG9iamVjdCBvZiBvYmplY3RzIHRvIGFuIGFycmF5IG9mIG9iamVjdHNcbiAgICAgICAgICAgIC8vIEZpbHRlciBvdXQgcHJvZHVjdHMgd2l0aCBpc0RlbGV0ZSBzZXQgdG8gdHJ1ZVxuICAgICAgICAgICAgY29uc3QgcHJvZHVjdHNBcnJheSA9IE9iamVjdC5rZXlzKHByb2R1Y3RzKVxuICAgICAgICAgICAgICAgIC5tYXAoa2V5ID0+IHByb2R1Y3RzW2tleV0pXG4gICAgICAgICAgICAgICAgLmZpbHRlcihwcm9kdWN0ID0+ICFwcm9kdWN0LmlzRGVsZXRlKTsgXG4gICAgXG4gICAgICAgICAgICBjb25zdCBwYWdpbmF0ZWRQcm9kdWN0cyA9IHByb2R1Y3RzQXJyYXkuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBsaW1pdCk7XG4gICAgXG4gICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdCgyMDAsIHBhZ2luYXRlZFByb2R1Y3RzKTtcbiAgICAgICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNTAwLCBlcnIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhc3luYyBnZXRQcm9kdWN0QnlJZChjdHgsIF9uZXh0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwcm9kdWN0SWQgPSBjdHgucmVxdWVzdC5wYXJhbXMucHJvZHVjdF9pZDsgIC8vIEFzc3VtaW5nIHlvdSBoYXZlIHNldCB1cCB5b3VyIHJvdXRlIHRvIGNhcHR1cmUgcHJvZHVjdF9pZCBhcyBhIFVSTCBwYXJhbWV0ZXJcbiAgICBcbiAgICAgICAgICAgIGNvbnN0IHByb2R1Y3RSZWYgPSByZWYoZmlyZWJhc2UsICdwcm9kdWN0cy8nICsgcHJvZHVjdElkKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2R1Y3RTbmFwc2hvdCA9IGF3YWl0IGdldChwcm9kdWN0UmVmKTtcbiAgICBcbiAgICAgICAgICAgIGlmICghcHJvZHVjdFNuYXBzaG90LmV4aXN0cygpKSB7XG4gICAgICAgICAgICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNDA0LCBcIlByb2R1Y3Qgbm90IGZvdW5kXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIC8vIEdldCB0aGUgcHJvZHVjdCBkYXRhIHdpdGhvdXQgdGhlIEZpcmViYXNlIGtleVxuICAgICAgICAgICAgY29uc3QgcHJvZHVjdERhdGEgPSBPYmplY3QudmFsdWVzKHByb2R1Y3RTbmFwc2hvdC52YWwoKSlbMF07XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0KDIwMCwgcHJvZHVjdERhdGEpO1xuICAgIFxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDUwMCwgZXJyKTtcbiAgICAgICAgfVxuICAgIH0sIFxuICAgIGFzeW5jIGNyZWF0ZVByb2R1Y3QoY3R4LCBfbmV4dCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyBwcm9kdWN0X25hbWUsIGRlc2NyaXB0aW9uLCBxdWFudGl0eSwgcHJpY2UgfSA9IGN0eC5yZXF1ZXN0LmJvZHk7XG4gICAgICAgICAgICBsZXQgaW1hZ2VCYXNlNjQgPSBcIlwiO1xuICAgICAgICAgICAgY29uc3QgaW1hZ2VGaWxlID0gY3R4LnJlcXVlc3QuZmlsZXMgJiYgY3R4LnJlcXVlc3QuZmlsZXMuaW1hZ2U7IFxuICAgICAgICAgICAgaWYgKGltYWdlRmlsZSkge1xuICAgICAgICAgICAgICAgIGltYWdlQmFzZTY0ID0gZnMucmVhZEZpbGVTeW5jKGltYWdlRmlsZSwgJ2Jhc2U2NCcpO1xuICAgICAgICAgICAgfSBcblxuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgcmVmZXJlbmNlIHRvIHRoZSBwcm9kdWN0cyBjb2xsZWN0aW9uXG4gICAgICAgICAgICBjb25zdCBwcm9kdWN0UmVmID0gcmVmKGZpcmViYXNlLCAncHJvZHVjdHMnKTtcbiAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50WWVhciA9IGN1cnJlbnREYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50TW9udGggPSBTdHJpbmcoY3VycmVudERhdGUuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgICAgICAgICBjb25zdCBydW5uaW5nTm8gPSBhd2FpdCBnZXRSdW5uaW5nTm9Qcm9kdWN0S2V5KGN1cnJlbnRZZWFyICsgY3VycmVudE1vbnRoKTsgIFxuXG4gICAgICAgICAgICAvLyBDb25zdHJ1Y3QgdGhlIHByb2R1Y3RfaWRcbiAgICAgICAgICAgIGNvbnN0IHByb2R1Y3RJZCA9IGBQXyR7Y3VycmVudFllYXJ9JHtjdXJyZW50TW9udGh9XyR7cnVubmluZ05vfWA7IFxuICAgICAgICAgICAgY29uc3Qgc3BlY2lmaWNQcm9kdWN0UmVmID0gY2hpbGQocHJvZHVjdFJlZiwgcHJvZHVjdElkKTtcblxuICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IHByb2R1Y3RcbiAgICAgICAgICAgIGF3YWl0IHNldChzcGVjaWZpY1Byb2R1Y3RSZWYsIHtcbiAgICAgICAgICAgICAgICBwcm9kdWN0X2lkOiBwcm9kdWN0SWQsXG4gICAgICAgICAgICAgICAgcHJvZHVjdF9uYW1lLFxuICAgICAgICAgICAgICAgIGltYWdlOiBpbWFnZUJhc2U2NCxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgICBxdWFudGl0eSxcbiAgICAgICAgICAgICAgICBwcmljZSxcbiAgICAgICAgICAgICAgICBpc0RlbGV0ZTogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdCgyMDAsIHsgbWVzc2FnZTogXCJQcm9kdWN0IGNyZWF0aW9uIHN1Y2Nlc3NmdWxcIiwgcHJvZHVjdElkOiBwcm9kdWN0SWQgfSk7XG5cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig1MDAsIGVycik7XG4gICAgICAgIH1cbiAgICB9LCBcbiAgICBhc3luYyB1cGRhdGVQcm9kdWN0KGN0eCwgX25leHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHsgcHJvZHVjdF9pZCwgcHJvZHVjdF9uYW1lLCBkZXNjcmlwdGlvbiwgcXVhbnRpdHksIHByaWNlIH0gPSBjdHgucmVxdWVzdC5ib2R5O1xuICAgIFxuICAgICAgICAgICAgY29uc3QgcHJvZHVjdFJlZiA9IHJlZihmaXJlYmFzZSwgJ3Byb2R1Y3RzLycgKyBwcm9kdWN0X2lkKTtcbiAgICBcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBwcm9kdWN0IGV4aXN0c1xuICAgICAgICAgICAgY29uc3QgcHJvZHVjdFNuYXBzaG90ID0gYXdhaXQgZ2V0KHByb2R1Y3RSZWYpO1xuICAgICAgICAgICAgaWYgKCFwcm9kdWN0U25hcHNob3QuZXhpc3RzKCkpIHtcbiAgICAgICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig0MDQsIFwiRGF0YSBOb3QgRm91bmRcIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgLy8gT3B0aW9uYWxseSBoYW5kbGUgaW1hZ2UgdXBkYXRlIGlmIHByb3ZpZGVkXG4gICAgICAgICAgICBsZXQgaW1hZ2VCYXNlNjQgPSBudWxsO1xuICAgICAgICAgICAgaWYgKGN0eC5yZXF1ZXN0LmZpbGVzICYmIGN0eC5yZXF1ZXN0LmZpbGVzLmltYWdlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VGaWxlID0gY3R4LnJlcXVlc3QuZmlsZXMuaW1hZ2U7XG4gICAgICAgICAgICAgICAgaW1hZ2VCYXNlNjQgPSBmcy5yZWFkRmlsZVN5bmMoaW1hZ2VGaWxlLnBhdGgsICdiYXNlNjQnKTtcbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZXMgPSB7XG4gICAgICAgICAgICAgICAgcHJvZHVjdF9uYW1lLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIHF1YW50aXR5LFxuICAgICAgICAgICAgICAgIHByaWNlLFxuICAgICAgICAgICAgfTtcbiAgICBcbiAgICAgICAgICAgIGlmIChpbWFnZUJhc2U2NCkge1xuICAgICAgICAgICAgICAgIHVwZGF0ZXMuaW1hZ2UgPSBpbWFnZUJhc2U2NDtcbiAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgIGF3YWl0IHNldChwcm9kdWN0UmVmLCB1cGRhdGVzLCB0cnVlKTsgIC8vIHRydWUgZm9yIG1lcmdlLCBzbyBpdCBvbmx5IHVwZGF0ZXMgc3BlY2lmaWVkIGZpZWxkc1xuICAgIFxuICAgICAgICAgICAgY3R4LmJvZHkgPSByZXN1bHQoMjAwLCB7IG1lc3NhZ2U6IFwiUHJvZHVjdCB1cGRhdGUgc3VjY2Vzc2Z1bFwiLCBwcm9kdWN0SWQ6IHByb2R1Y3RfaWQgfSk7XG4gICAgXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNTAwLCBlcnIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhc3luYyBkZWxldGVQcm9kdWN0KGN0eCwgX25leHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHsgcHJvZHVjdF9pZCB9ID0gY3R4LnJlcXVlc3QucGFyYW1zLnByb2R1Y3RfaWQ7XG4gICAgXG4gICAgICAgICAgICBjb25zdCBwcm9kdWN0UmVmID0gcmVmKGZpcmViYXNlLCAncHJvZHVjdHMvJyArIHByb2R1Y3RfaWQpO1xuICAgIFxuICAgICAgICAgICAgYXdhaXQgc2V0KHByb2R1Y3RSZWYsIHsgaXNEZWxldGU6IHRydWUgfSwgdHJ1ZSk7ICAvLyBtYXJrIGFzIGRlbGV0ZWRcbiAgICBcbiAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0KDIwMCwgeyBtZXNzYWdlOiBcIlByb2R1Y3QgZGVsZXRlZCBzdWNjZXNzZnVsbHlcIiB9KTtcbiAgICBcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig1MDAsIGVycik7XG4gICAgICAgIH1cbiAgICB9XG59OyJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTTtFQUFFQSxNQUFNO0VBQUVDO0FBQVMsQ0FBQyxHQUFHQyxPQUFPLENBQUMsWUFBWSxDQUFDO0FBQ2xELE1BQU07RUFBRUMsS0FBSztFQUFFQyxZQUFZO0VBQUVDLE9BQU87RUFBRUMsS0FBSztFQUFFQyxHQUFHO0VBQUVDLEdBQUc7RUFBRUMsSUFBSTtFQUFFQyxHQUFHO0VBQUVDO0FBQU8sQ0FBQyxHQUFHVCxPQUFPLENBQUMsb0JBQW9CLENBQUM7QUFDMUcsTUFBTVUsTUFBTSxHQUFHVixPQUFPLENBQUMsUUFBUSxDQUFDO0FBQ2hDLE1BQU07RUFBRVcsTUFBTTtFQUFFQztBQUFZLENBQUMsR0FBR1osT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQzdELE1BQU07RUFBRWE7QUFBdUIsQ0FBQyxHQUFHYixPQUFPLENBQUMsc0JBQXNCLENBQUM7QUFDbEUsTUFBTTtFQUFFYztBQUFjLENBQUMsR0FBR2QsT0FBTyxDQUFDLDBCQUEwQixDQUFDO0FBRzdEZSxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNiLE1BQU1DLFdBQVdBLENBQUNDLEdBQUcsRUFB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","map":{"version":3,"names":["secret","firebase","require","query","orderByChild","equalTo","child","get","ref","push","set","remove","bcrypt","result","result_error","getRunningNoProductKey","getPagination","module","exports","getProducts","ctx","_next","page","size","request","limit","offset","productsRef","productsSnapshot","exists","body","products","val","productsArray","Object","keys","map","key","filter","product","isDelete","paginatedProducts","slice","err","getProductById","productId","params","product_id","productRef","productSnapshot","productData","values","createProduct","product_name","description","quantity","price","imageBase64","imageFile","files","image","fs","readFileSync","currentDate","Date","currentYear","getFullYear","currentMonth","String","getMonth","padStart","runningNo","specificProductRef","message","updateProduct","path","updates","deleteProduct"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/","sources":["product.controller.js"],"sourcesContent":["const { secret, firebase } = require('../configs');\nconst { query, orderByChild, equalTo, child, get, ref, push, set, remove } = require(\"@firebase/database\");\nconst bcrypt = require('bcrypt'); \nconst { result, result_error} = require(\"../commons/convert\"); \nconst { getRunningNoProductKey } = require('../commons/calculate');\nconst { getPagination } = require('../utils/pagination.util')\n\n\nmodule.exports = {\n    async getProducts(ctx, _next) {\n        try {\n            const { page, size } = ctx.request.query;\n            const { limit, offset } = getPagination(page, size);\n        \n            const productsRef = ref(firebase, 'products');\n            const productsSnapshot = await get(productsRef);\n        \n            if (!productsSnapshot.exists()) {\n                ctx.body = result_error(404, \"No products found\");\n                return;\n            }\n    \n            const products = productsSnapshot.val();\n    \n            // Convert object of objects to an array of objects\n            // Filter out products with isDelete set to true\n            const productsArray = Object.keys(products)\n                .map(key => products[key])\n                .filter(product => !product.isDelete); \n    \n            const paginatedProducts = productsArray.slice(offset, offset + limit);\n    \n            ctx.body = result(200, paginatedProducts);\n        \n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    },\n    async getProductById(ctx, _next) {\n        try {\n            const productId = ctx.request.params.product_id;  // Assuming you have set up your route to capture product_id as a URL parameter\n    \n            const productRef = ref(firebase, 'products/' + productId);\n            const productSnapshot = await get(productRef);\n    \n            if (!productSnapshot.exists()) {\n                ctx.body = result_error(404, \"Product not found\");\n                return;\n            }\n    \n            // Get the product data without the Firebase key\n            const productData = Object.values(productSnapshot.val())[0];\n            \n            ctx.body = result(200, productData);\n    \n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    }, \n    async createProduct(ctx, _next) {\n        try {\n            const { product_name, description, quantity, price } = ctx.request.body;\n            let imageBase64 = \"\";\n            const imageFile = ctx.request.files && ctx.request.files.image; \n            if (imageFile) {\n                imageBase64 = fs.readFileSync(imageFile, 'base64');\n            } \n\n            // Create a reference to the products collection\n            const productRef = ref(firebase, 'products');\n        \n            const currentDate = new Date();\n            const currentYear = currentDate.getFullYear();\n            const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');\n            const runningNo = await getRunningNoProductKey(currentYear + currentMonth);  \n\n            // Construct the product_id\n            const productId = `P_${currentYear}${currentMonth}_${runningNo}`; \n            const specificProductRef = child(productRef, productId);\n\n            // Create a new product\n            await set(specificProductRef, {\n                product_id: productId,\n                product_name,\n                image: imageBase64,\n                description,\n                quantity,\n                price,\n                isDelete: false\n            });\n\n            ctx.body = result(200, { message: \"Product creation successful\", productId: productId });\n\n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    }, \n    async updateProduct(ctx, _next) {\n        try {\n            const { product_id, product_name, description, quantity, price } = ctx.request.body;\n    \n            const productRef = ref(firebase, 'products/' + product_id);\n    \n            // Check if the product exists\n            const productSnapshot = await get(productRef);\n            if (!productSnapshot.exists()) {\n                ctx.body = result_error(404, \"Data Not Found\");\n                return;\n            }\n    \n            // Optionally handle image update if provided\n            let imageBase64 = null;\n            if (ctx.request.files && ctx.request.files.image) {\n                const imageFile = ctx.request.files.image;\n                imageBase64 = fs.readFileSync(imageFile.path, 'base64');\n            }\n    \n            const updates = {\n                product_name,\n                description,\n                quantity,\n                price,\n            };\n    \n            if (imageBase64) {\n                updates.image = imageBase64;\n            }\n    \n            await set(productRef, updates, true);  // true for merge, so it only updates specified fields\n    \n            ctx.body = result(200, { message: \"Product update successful\", productId: product_id });\n    \n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    },\n    async deleteProduct(ctx, _next) {\n        try {\n            const { product_id } = ctx.request.params.product_id;\n    \n            const productRef = ref(firebase, 'products/' + product_id);\n    \n            await set(productRef, { isDelete: true }, true);  // mark as deleted\n    \n            ctx.body = result(200, { message: \"Product deleted successfully\" });\n    \n        } catch (err) {\n            ctx.body = result_error(500, err);\n        }\n    }\n};"],"mappings":"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"}},"mtime":1692891575651},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/user.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const jwt = require(\"jsonwebtoken\");\nconst {\n  secret,\n  firebase\n} = require('../configs');\nconst {\n  query,\n  orderByChild,\n  equalTo,\n  child,\n  get,\n  ref,\n  push,\n  set,\n  remove\n} = require(\"@firebase/database\");\nconst bcrypt = require('bcrypt');\nconst {\n  result,\n  result_error\n} = require(\"../commons/convert\");\nconst {\n  getRunningNoUserKey\n} = require('../commons/calculate');\nconst saltRounds = 10;\nmodule.exports = {\n  async logIn(ctx, _next) {\n    try {\n      const {\n        user,\n        password\n      } = ctx.request.body;\n\n      // Determine if 'user' is an email or mobile\n      const userRef = ref(firebase, 'users');\n      let userQuery;\n      if (user.includes('@')) {\n        userQuery = query(userRef, orderByChild('email'), equalTo(user));\n      } else {\n        userQuery = query(userRef, orderByChild('mobile'), equalTo(user));\n      }\n      const snapshot = await get(userQuery);\n      if (snapshot.exists()) {\n        const userData = Object.values(snapshot.val())[0]; // Extract the first matched user data\n\n        const passwordMatch = await bcrypt.compare(password, userData.password);\n        if (!passwordMatch) {\n          ctx.body = result_error(403, \"Incorrect password\");\n          return;\n        }\n        const token = jwt.sign(JSON.stringify(userData), secret);\n        ctx.body = result(200, {\n          token\n        });\n      } else {\n        ctx.body = result_error(404, \"User not found\");\n      }\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async register(ctx, _next) {\n    try {\n      const {\n        email,\n        mobile,\n        firstName,\n        lastName,\n        img,\n        password\n      } = ctx.request.body;\n      const hashedPassword = await bcrypt.hash(password, saltRounds);\n      const userRef = ref(firebase, 'users');\n      const emailQuery = query(userRef, orderByChild('email'), equalTo(email));\n      const snapshot = await get(emailQuery);\n      if (snapshot.exists()) {\n        ctx.body = result(202, {\n          message: 'This email is already in use. Please use a different one.'\n        });\n        return;\n      }\n\n      // Create a new user \n      const currentDate = new Date();\n      const currentYear = currentDate.getFullYear();\n      const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');\n      const runningNo = await getRunningNoUserKey(currentYear + currentMonth);\n\n      // Construct the userId\n      const newUserId = `${currentYear}${currentMonth}_${runningNo}`;\n      const specificUserRef = child(userRef, newUserId);\n\n      // Create a new user  \n      await set(specificUserRef, {\n        userId: newUserId,\n        firstName,\n        lastName,\n        email,\n        mobile,\n        img,\n        password: hashedPassword\n      });\n      ctx.body = result(200, {\n        message: \"Registration successful\",\n        userId: newUserId\n      });\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async getProfile(ctx, _next) {\n    try {\n      const userId = ctx.request.params.userId;\n      const usersRef = ref(firebase, 'users');\n      const userQuery = query(usersRef, orderByChild('userId'), equalTo(userId));\n      const snapshot = await get(userQuery);\n      console.log(snapshot.val());\n      if (!snapshot.exists()) {\n        ctx.body = result_error(404, \"User not found\");\n        return;\n      }\n      const userData = Object.values(snapshot.val())[0];\n      ctx.body = result(200, userData);\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n  async deleteUser(ctx, _next) {\n    try {\n      const userId = ctx.request.params.userId;\n      const usersRef = ref(firebase, 'users');\n      const userQuery = query(usersRef, orderByChild('userId'), equalTo(userId));\n      const snapshot = await get(userQuery);\n      if (!snapshot.exists()) {\n        ctx.body = result_error(404, \"User not found\");\n        return;\n      }\n\n      // Extract the key of the user data from the snapshot\n      const userKey = Object.keys(snapshot.val())[0];\n      const userToDeleteRef = ref(firebase, 'users/' + userKey);\n\n      // Delete user\n      await remove(userToDeleteRef);\n      ctx.body = result(200, {\n        message: \"User deleted successfully\"\n      });\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwic2VjcmV0IiwiZmlyZWJhc2UiLCJxdWVyeSIsIm9yZGVyQnlDaGlsZCIsImVxdWFsVG8iLCJjaGlsZCIsImdldCIsInJlZiIsInB1c2giLCJzZXQiLCJyZW1vdmUiLCJiY3J5cHQiLCJyZXN1bHQiLCJyZXN1bHRfZXJyb3IiLCJnZXRSdW5uaW5nTm9Vc2VyS2V5Iiwic2FsdFJvdW5kcyIsIm1vZHVsZSIsImV4cG9ydHMiLCJsb2dJbiIsImN0eCIsIl9uZXh0IiwidXNlciIsInBhc3N3b3JkIiwicmVxdWVzdCIsImJvZHkiLCJ1c2VyUmVmIiwidXNlclF1ZXJ5IiwiaW5jbHVkZXMiLCJzbmFwc2hvdCIsImV4aXN0cyIsInVzZXJEYXRhIiwiT2JqZWN0IiwidmFsdWVzIiwidmFsIiwicGFzc3dvcmRNYXRjaCIsImNvbXBhcmUiLCJ0b2tlbiIsInNpZ24iLCJKU09OIiwic3RyaW5naWZ5IiwiZXJyIiwicmVnaXN0ZXIiLCJlbWFpbCIsIm1vYmlsZSIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwiaW1nIiwiaGFzaGVkUGFzc3dvcmQiLCJoYXNoIiwiZW1haWxRdWVyeSIsIm1lc3NhZ2UiLCJjdXJyZW50RGF0ZSIsIkRhdGUiLCJjdXJyZW50WWVhciIsImdldEZ1bGxZZWFyIiwiY3VycmVudE1vbnRoIiwiU3RyaW5nIiwiZ2V0TW9udGgiLCJwYWRTdGFydCIsInJ1bm5pbmdObyIsIm5ld1VzZXJJZCIsInNwZWNpZmljVXNlclJlZiIsInVzZXJJZCIsImdldFByb2ZpbGUiLCJwYXJhbXMiLCJ1c2Vyc1JlZiIsImNvbnNvbGUiLCJsb2ciLCJkZWxldGVVc2VyIiwidXNlcktleSIsImtleXMiLCJ1c2VyVG9EZWxldGVSZWYiXSwic291cmNlUm9vdCI6Ii9Vc2Vycy9tYWNwcm8vRGVza3RvcC9JbmZvbWF0aW9uL1Rlc3Qvbm9kZS1iYWNrLWVuZC9zcmMvY29udHJvbGxlcnMvIiwic291cmNlcyI6WyJ1c2VyLmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiIFxuY29uc3Qgand0ID0gcmVxdWlyZShcImpzb253ZWJ0b2tlblwiKTsgIFxuY29uc3QgeyBzZWNyZXQsIGZpcmViYXNlIH0gPSByZXF1aXJlKCcuLi9jb25maWdzJyk7XG5jb25zdCB7IHF1ZXJ5LCBvcmRlckJ5Q2hpbGQsIGVxdWFsVG8sIGNoaWxkLCBnZXQsIHJlZiwgcHVzaCwgc2V0LCByZW1vdmUgfSA9IHJlcXVpcmUoXCJAZmlyZWJhc2UvZGF0YWJhc2VcIik7XG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHQnKTsgXG5jb25zdCB7IHJlc3VsdCwgcmVzdWx0X2Vycm9yfSA9IHJlcXVpcmUoXCIuLi9jb21tb25zL2NvbnZlcnRcIik7IFxuY29uc3QgeyBnZXRSdW5uaW5nTm9Vc2VyS2V5IH0gPSByZXF1aXJlKCcuLi9jb21tb25zL2NhbGN1bGF0ZScpO1xuXG5jb25zdCBzYWx0Um91bmRzID0gMTA7ICBcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGFzeW5jIGxvZ0luKGN0eCwgX25leHQpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IHVzZXIsIHBhc3N3b3JkIH0gPSBjdHgucmVxdWVzdC5ib2R5O1xuXG4gICAgICAgIC8vIERldGVybWluZSBpZiAndXNlcicgaXMgYW4gZW1haWwgb3IgbW9iaWxlXG4gICAgICAgIGNvbnN0IHVzZXJSZWYgPSByZWYoZmlyZWJhc2UsICd1c2VycycpOyAgXG4gICAgICAgIGxldCB1c2VyUXVlcnk7XG4gICAgICAgIFxuICAgICAgICBpZiAodXNlci5pbmNsdWRlcygnQCcpKSB7XG4gICAgICAgICAgdXNlclF1ZXJ5ID0gcXVlcnkodXNlclJlZiwgb3JkZXJCeUNoaWxkKCdlbWFpbCcpLCBlcXVhbFRvKHVzZXIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB1c2VyUXVlcnkgPSBxdWVyeSh1c2VyUmVmLCBvcmRlckJ5Q2hpbGQoJ21vYmlsZScpLCBlcXVhbFRvKHVzZXIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHNuYXBzaG90ID0gYXdhaXQgZ2V0KHVzZXJRdWVyeSk7XG4gICAgICAgIGlmIChzbmFwc2hvdC5leGlzdHMoKSkge1xuICAgICAgICAgIGNvbnN0IHVzZXJEYXRhID0gT2JqZWN0LnZhbHVlcyhzbmFwc2hvdC52YWwoKSlbMF07ICAvLyBFeHRyYWN0IHRoZSBmaXJzdCBtYXRjaGVkIHVzZXIgZGF0YVxuXG4gICAgICAgICAgY29uc3QgcGFzc3dvcmRNYXRjaCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKHBhc3N3b3JkLCB1c2VyRGF0YS5wYXNzd29yZCk7XG4gICAgICAgICAgaWYgKCFwYXNzd29yZE1hdGNoKSB7XG4gICAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig0MDMsIFwiSW5jb3JyZWN0IHBhc3N3b3JkXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHRva2VuID0gand0LnNpZ24oSlNPTi5zdHJpbmdpZnkodXNlckRhdGEpLCBzZWNyZXQpO1xuICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0KDIwMCwgeyB0b2tlbiB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig0MDQsIFwiVXNlciBub3QgZm91bmRcIik7XG4gICAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjdHguYm9keSA9IHJlc3VsdF9lcnJvcig1MDAsIGVycik7XG4gICAgfVxuICB9LFxuXG4gIGFzeW5jIHJlZ2lzdGVyKGN0eCwgX25leHQpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGVtYWlsLCBtb2JpbGUsIGZpcnN0TmFtZSwgbGFzdE5hbWUsIGltZywgcGFzc3dvcmQgfSA9IGN0eC5yZXF1ZXN0LmJvZHk7XG4gICAgICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2gocGFzc3dvcmQsIHNhbHRSb3VuZHMpO1xuXG4gICAgICAgIGNvbnN0IHVzZXJSZWYgPSByZWYoZmlyZWJhc2UsICd1c2VycycpOyAgXG4gICAgICAgIGNvbnN0IGVtYWlsUXVlcnkgPSBxdWVyeSh1c2VyUmVmLCBvcmRlckJ5Q2hpbGQoJ2VtYWlsJyksIGVxdWFsVG8oZW1haWwpKTtcblxuICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldChlbWFpbFF1ZXJ5KTtcblxuICAgICAgICBpZiAoc25hcHNob3QuZXhpc3RzKCkpIHtcbiAgICAgICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0KDIwMiwgeyBtZXNzYWdlOiAnVGhpcyBlbWFpbCBpcyBhbHJlYWR5IGluIHVzZS4gUGxlYXNlIHVzZSBhIGRpZmZlcmVudCBvbmUuJyB9KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyB1c2VyIFxuICAgICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRZZWFyID0gY3VycmVudERhdGUuZ2V0RnVsbFllYXIoKTtcbiAgICAgICAgY29uc3QgY3VycmVudE1vbnRoID0gU3RyaW5nKGN1cnJlbnREYXRlLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgICAgICBjb25zdCBydW5uaW5nTm8gPSBhd2FpdCBnZXRSdW5uaW5nTm9Vc2VyS2V5KGN1cnJlbnRZZWFyICsgY3VycmVudE1vbnRoKTtcbiBcbiAgICAgICAgLy8gQ29uc3RydWN0IHRoZSB1c2VySWRcbiAgICAgICAgY29uc3QgbmV3VXNlcklkID0gYCR7Y3VycmVudFllYXJ9JHtjdXJyZW50TW9udGh9XyR7cnVubmluZ05vfWA7XG4gICAgICAgIGNvbnN0IHNwZWNpZmljVXNlclJlZiA9IGNoaWxkKHVzZXJSZWYsIG5ld1VzZXJJZCk7XG5cbiAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IHVzZXIgIFxuICAgICAgICBhd2FpdCBzZXQoc3BlY2lmaWNVc2VyUmVmLCB7XG4gICAgICAgICAgICB1c2VySWQ6IG5ld1VzZXJJZCwgIFxuICAgICAgICAgICAgZmlyc3ROYW1lLFxuICAgICAgICAgICAgbGFzdE5hbWUsXG4gICAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICAgIG1vYmlsZSxcbiAgICAgICAgICAgIGltZyxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZFxuICAgICAgICB9KTtcblxuICAgICAgICBjdHguYm9keSA9IHJlc3VsdCgyMDAsIHsgbWVzc2FnZTogXCJSZWdpc3RyYXRpb24gc3VjY2Vzc2Z1bFwiLCB1c2VySWQ6IG5ld1VzZXJJZCB9KTsgIFxuXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDUwMCwgZXJyKTtcbiAgICB9XG4gIH0sXG5cbiAgYXN5bmMgZ2V0UHJvZmlsZShjdHgsIF9uZXh0KSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGN0eC5yZXF1ZXN0LnBhcmFtcy51c2VySWQ7IFxuICAgICAgY29uc3QgdXNlcnNSZWYgPSByZWYoZmlyZWJhc2UsICd1c2VycycpO1xuICAgICAgY29uc3QgdXNlclF1ZXJ5ID0gcXVlcnkodXNlcnNSZWYsIG9yZGVyQnlDaGlsZCgndXNlcklkJyksIGVxdWFsVG8odXNlcklkKSk7XG4gICAgICBjb25zdCBzbmFwc2hvdCA9IGF3YWl0IGdldCh1c2VyUXVlcnkpO1xuICAgICAgY29uc29sZS5sb2coc25hcHNob3QudmFsKCkpO1xuXG4gICAgICBpZiAoIXNuYXBzaG90LmV4aXN0cygpKSB7XG4gICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDQwNCwgXCJVc2VyIG5vdCBmb3VuZFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCB1c2VyRGF0YSA9IE9iamVjdC52YWx1ZXMoc25hcHNob3QudmFsKCkpWzBdO1xuXG4gICAgICBjdHguYm9keSA9IHJlc3VsdCgyMDAsIHVzZXJEYXRhKTtcblxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNTAwLCBlcnIpO1xuICAgIH1cbiAgfSxcblxuICBhc3luYyBkZWxldGVVc2VyKGN0eCwgX25leHQpIHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VySWQgPSBjdHgucmVxdWVzdC5wYXJhbXMudXNlcklkO1xuXG4gICAgICAgIGNvbnN0IHVzZXJzUmVmID0gcmVmKGZpcmViYXNlLCAndXNlcnMnKTtcbiAgICAgICAgY29uc3QgdXNlclF1ZXJ5ID0gcXVlcnkodXNlcnNSZWYsIG9yZGVyQnlDaGlsZCgndXNlcklkJyksIGVxdWFsVG8odXNlcklkKSk7XG5cbiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCBnZXQodXNlclF1ZXJ5KTtcblxuICAgICAgICBpZiAoIXNuYXBzaG90LmV4aXN0cygpKSB7XG4gICAgICAgICAgY3R4LmJvZHkgPSByZXN1bHRfZXJyb3IoNDA0LCBcIlVzZXIgbm90IGZvdW5kXCIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEV4dHJhY3QgdGhlIGtleSBvZiB0aGUgdXNlciBkYXRhIGZyb20gdGhlIHNuYXBzaG90XG4gICAgICAgIGNvbnN0IHVzZXJLZXkgPSBPYmplY3Qua2V5cyhzbmFwc2hvdC52YWwoKSlbMF07XG4gICAgICAgIGNvbnN0IHVzZXJUb0RlbGV0ZVJlZiA9IHJlZihmaXJlYmFzZSwgJ3VzZXJzLycgKyB1c2VyS2V5KTtcblxuICAgICAgICAvLyBEZWxldGUgdXNlclxuICAgICAgICBhd2FpdCByZW1vdmUodXNlclRvRGVsZXRlUmVmKTtcbiAgICAgICAgY3R4LmJvZHkgPSByZXN1bHQoMjAwLCB7IG1lc3NhZ2U6IFwiVXNlciBkZWxldGVkIHN1Y2Nlc3NmdWxseVwiIH0pO1xuXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGN0eC5ib2R5ID0gcmVzdWx0X2Vycm9yKDUwMCwgZXJyKTtcbiAgICB9XG4gIH1cblxufTsiXSwibWFwcGluZ3MiOiJBQUNBLE1BQU1BLEdBQUcsR0FBR0MsT0FBTyxDQUFDLGNBQWMsQ0FBQztBQUNuQyxNQUFNO0VBQUVDLE1BQU07RUFBRUM7QUFBUyxDQUFDLEdBQUdGLE9BQU8sQ0FBQyxZQUFZLENBQUM7QUFDbEQsTUFBTTtFQUFFRyxLQUFLO0VBQUVDLFlBQVk7RUFBRUMsT0FBTztFQUFFQyxLQUFLO0VBQUVDLEdBQUc7RUFBRUMsR0FBRztFQUFFQyxJQUFJO0VBQUVDLEdBQUc7RUFBRUM7QUFBTyxDQUFDLEdBQUdYLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQztBQUMxRyxNQUFNWSxNQUFNLEdBQUdaLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsTUFBTTtFQUFFYSxNQUFNO0VBQUVDO0FBQVksQ0FBQyxHQUFHZCxPQUFPLENBQUMsb0JBQW9CLENBQUM7QUFDN0QsTUFBTTtFQUFFZTtBQUFvQixDQUFDLEdBQUdmLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQztBQUUvRCxNQUFNZ0IsVUFBVSxHQUFHLEVBQUU7QUFFckJDLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHO0VBQ2YsTUFBTUMsS0FBS0EsQ0FBQ0MsR0FBRyxFQUFFQyxLQUFLLEVBQUU7SUFDdEIsSUFBSTtNQUNBLE1BQU07UUFBRUMsSUFBSTtRQUFFQztNQUFTLENBQUMsR0FBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUNDLElBQUk7O01BRTNDO01BQ0EsTUFBTUMsT0FBTyxHQUFHbEIsR0FBRyxDQUFDTixRQUFRLEVBQUUsT0FBTyxDQUFDO01BQ3RDLElBQUl5QixTQUFTO01BRWIsSUFBSUwsSUFBSSxDQUFDTSxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDdEJELFNBQVMsR0FBR3hCLEtBQUssQ0FBQ3VCLE9BQU8sRUFBRXRCLFlBQVksQ0FBQyxPQUFPLENBQUMsRUFBRUMsT0FBTyxDQUFDaUIsSUFBSSxDQUFDLENBQUM7TUFDbEUsQ0FBQyxNQUFNO1FBQ0xLLFNBQVMsR0FBR3hCLEtBQUssQ0FBQ3VCLE9BQU8sRUFBRXRCLFlBQVksQ0FBQyxRQUFRLENBQUMsRUFBRUMsT0FBTyxDQUFDaUIsSUFBSSxDQUFDLENBQUM7TUFDbkU7TUFFQSxNQUFNTyxRQUFRLEdBQUcsTUFBTXRCLEdBQUcsQ0FBQ29CLFNBQVMsQ0FBQztNQUNyQyxJQUFJRSxRQUFRLENBQUNDLE1BQU0sQ0FBQyxDQUFDLEVBQUU7UUFDckIsTUFBTUMsUUFBUSxHQUFHQyxNQUFNLENBQUNDLE1BQU0sQ0FBQ0osUUFBUSxDQUFDSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBRTs7UUFFcEQsTUFBTUMsYUFBYSxHQUFHLE1BQU12QixNQUFNLENBQUN3QixPQUFPLENBQUNiLFFBQVEsRUFBRVEsUUFBUSxDQUFDUixRQUFRLENBQUM7UUFDdkUsSUFBSSxDQUFDWSxhQUFhLEVBQUU7VUFDbEJmLEdBQUcsQ0FBQ0ssSUFBSSxHQUFHWCxZQUFZLENBQUMsR0FBRyxFQUFFLG9CQUFvQixDQUFDO1VBQ2xEO1FBQ0Y7UUFFQSxNQUFNdUIsS0FBSyxHQUFHdEMsR0FBRyxDQUFDdUMsSUFBSSxDQUFDQyxJQUFJLENBQUNDLFNBQVMsQ0FBQ1QsUUFBUSxDQUFDLEVBQUU5QixNQUFNLENBQUM7UUFDeERtQixHQUFHLENBQUNLLElBQUksR0FBR1osTUFBTSxDQUFDLEdBQUcsRUFBRTtVQUFFd0I7UUFBTSxDQUFDLENBQUM7TUFDbkMsQ0FBQyxNQUFNO1FBQ0xqQixHQUFHLENBQUNLLElBQUksR0FBR1gsWUFBWSxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQztNQUNoRDtJQUVKLENBQUMsQ0FBQyxPQUFPMkIsR0FBRyxFQUFFO01BQ1ZyQixHQUFHLENBQUNLLElBQUksR0FBR1gsWUFBWSxDQUFDLEdBQUcsRUFBRTJCLEdBQUcsQ0FBQztJQUNyQztFQUNGLENBQUM7RUFFRCxNQUFNQyxRQUFRQSxDQUFDdEIsR0FBRyxFQUFFQyxLQUFLLEVBQUU7SUFDekIsSUFBSTtNQUNBLE1BQU07UUFBRXNCLEtBQUs7UUFBRUMsTUFBTTtRQUFFQyxTQUFTO1FBQUVDLFFBQVE7UUFBRUMsR0FBRztRQUFFeEI7TUFBUyxDQUFDLEdBQUdILEdBQUcsQ0FBQ0ksT0FBTyxDQUFDQyxJQUFJO01BQzlFLE1BQU11QixjQUFjLEdBQUcsTUFBTXBDLE1BQU0sQ0FBQ3FDLElBQUksQ0FBQzFCLFFBQVEsRUFBRVAsVUFBVSxDQUFDO01BRTlELE1BQU1VLE9BQU8sR0FBR2xCLEdBQUcsQ0FBQ04sUUFBUSxFQUFFLE9BQU8sQ0FBQztNQUN0QyxNQUFNZ0QsVUFBVSxHQUFHL0MsS0FBSyxDQUFDdUIsT0FBTyxFQUFFdEIsWUFBWSxDQUFDLE9BQU8sQ0FBQyxFQUFFQyxPQUFPLENBQUNzQyxLQUFLLENBQUMsQ0FBQztNQUV4RSxNQUFNZCxRQUFRLEdBQUcsTUFBTXRCLEdBQUcsQ0FBQzJDLFVBQVUsQ0FBQztNQUV0QyxJQUFJckIsUUFBUSxDQUFDQyxNQUFNLENBQUMsQ0FBQyxFQUFFO1FBQ25CVixHQUFHLENBQUNLLElBQUksR0FBR1osTUFBTSxDQUFDLEdBQUcsRUFBRTtVQUFFc0MsT0FBTyxFQUFFO1FBQTRELENBQUMsQ0FBQztRQUNoRztNQUNKOztNQUVBO01BQ0EsTUFBTUMsV0FBVyxHQUFHLElBQUlDLElBQUksQ0FBQyxDQUFDO01BQzlCLE1BQU1DLFdBQVcsR0FBR0YsV0FBVyxDQUFDRyxXQUFXLENBQUMsQ0FBQztNQUM3QyxNQUFNQyxZQUFZLEdBQUdDLE1BQU0sQ0FBQ0wsV0FBVyxDQUFDTSxRQUFRLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQztNQUN4RSxNQUFNQyxTQUFTLEdBQUcsTUFBTTdDLG1CQUFtQixDQUFDdUMsV0FBVyxHQUFHRSxZQUFZLENBQUM7O01BRXZFO01BQ0EsTUFBTUssU0FBUyxHQUFJLEdBQUVQLFdBQVksR0FBRUUsWUFBYSxJQUFHSSxTQUFVLEVBQUM7TUFDOUQsTUFBTUUsZUFBZSxHQUFHeEQsS0FBSyxDQUFDb0IsT0FBTyxFQUFFbUMsU0FBUyxDQUFDOztNQUVqRDtNQUNBLE1BQU1uRCxHQUFHLENBQUNvRCxlQUFlLEVBQUU7UUFDdkJDLE1BQU0sRUFBRUYsU0FBUztRQUNqQmhCLFNBQVM7UUFDVEMsUUFBUTtRQUNSSCxLQUFLO1FBQ0xDLE1BQU07UUFDTkcsR0FBRztRQUNIeEIsUUFBUSxFQUFFeUI7TUFDZCxDQUFDLENBQUM7TUFFRjVCLEdBQUcsQ0FBQ0ssSUFBSSxHQUFHWixNQUFNLENBQUMsR0FBRyxFQUFFO1FBQUVzQyxPQUFPLEVBQUUseUJBQXlCO1FBQUVZLE1BQU0sRUFBRUY7TUFBVSxDQUFDLENBQUM7SUFFckYsQ0FBQyxDQUFDLE9BQU9wQixHQUFHLEVBQUU7TUFDVnJCLEdBQUcsQ0FBQ0ssSUFBSSxHQUFHWCxZQUFZLENBQUMsR0FBRyxFQUFFMkIsR0FBRyxDQUFDO0lBQ3JDO0VBQ0YsQ0FBQztFQUVELE1BQU11QixVQUFVQSxDQUFDNUMsR0FBRyxFQUFFQyxLQUFLLEVBQUU7SUFDM0IsSUFBSTtNQUNGLE1BQU0wQyxNQUFNLEdBQUczQyxHQUFHLENBQUNJLE9BQU8sQ0FBQ3lDLE1BQU0sQ0FBQ0YsTUFBTTtNQUN4QyxNQUFNRyxRQUFRLEdBQUcxRCxHQUFHLENBQUNOLFFBQVEsRUFBRSxPQUFPLENBQUM7TUFDdkMsTUFBTXlCLFNBQVMsR0FBR3hCLEtBQUssQ0FBQytELFFBQVEsRUFBRTlELFlBQVksQ0FBQyxRQUFRLENBQUMsRUFBRUMsT0FBTyxDQUFDMEQsTUFBTSxDQUFDLENBQUM7TUFDMUUsTUFBTWxDLFFBQVEsR0FBRyxNQUFNdEIsR0FBRyxDQUFDb0IsU0FBUyxDQUFDO01BQ3JDd0MsT0FBTyxDQUFDQyxHQUFHLENBQUN2QyxRQUFRLENBQUNLLEdBQUcsQ0FBQyxDQUFDLENBQUM7TUFFM0IsSUFBSSxDQUFDTCxRQUFRLENBQUNDLE1BQU0sQ0FBQyxDQUFDLEVBQUU7UUFDdEJWLEdBQUcsQ0FBQ0ssSUFBSSxHQUFHWCxZQUFZLENBQUMsR0FBRyxFQUFFLGdCQUFnQixDQUFDO1FBQzlDO01BQ0Y7TUFFQSxNQUFNaUIsUUFBUSxHQUFHQyxNQUFNLENBQUNDLE1BQU0sQ0FBQ0osUUFBUSxDQUFDSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO01BRWpEZCxHQUFHLENBQUNLLElBQUksR0FBR1osTUFBTSxDQUFDLEdBQUcsRUFBRWtCLFFBQVEsQ0FBQztJQUVsQyxDQUFDLENBQUMsT0FBT1UsR0FBRyxFQUFFO01BQ1pyQixHQUFHLENBQUNLLElBQUksR0FBR1gsWUFBWSxDQUFDLEdBQUcsRUFBRTJCLEdBQUcsQ0FBQztJQUNuQztFQUNGLENBQUM7RUFFRCxNQUFNNEIsVUFBVUEsQ0FBQ2pELEdBQUcsRUFBRUMsS0FBSyxFQUFFO0lBQzNCLElBQUk7TUFDQSxNQUFNMEMsTUFBTSxHQUFHM0MsR0FBRyxDQUFDSSxPQUFPLENBQUN5QyxNQUFNLENBQUNGLE1BQU07TUFFeEMsTUFBTUcsUUFBUSxHQUFHMUQsR0FBRyxDQUFDTixRQUFRLEVBQUUsT0FBTyxDQUFDO01BQ3ZDLE1BQU15QixTQUFTLEdBQUd4QixLQUFLLENBQUMrRCxRQUFRLEVBQUU5RCxZQUFZLENBQUMsUUFBUSxDQUFDLEVBQUVDLE9BQU8sQ0FBQzBELE1BQU0sQ0FBQyxDQUFDO01BRTFFLE1BQU1sQyxRQUFRLEdBQUcsTUFBTXRCLEdBQUcsQ0FBQ29CLFNBQVMsQ0FBQztNQUVyQyxJQUFJLENBQUNFLFFBQVEsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsRUFBRTtRQUN0QlYsR0FBRyxDQUFDSyxJQUFJLEdBQUdYLFlBQVksQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUM7UUFDOUM7TUFDRjs7TUFFQTtNQUNBLE1BQU13RCxPQUFPLEdBQUd0QyxNQUFNLENBQUN1QyxJQUFJLENBQUMxQyxRQUFRLENBQUNLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFDOUMsTUFBTXNDLGVBQWUsR0FBR2hFLEdBQUcsQ0FBQ04sUUFBUSxFQUFFLFFBQVEsR0FBR29FLE9BQU8sQ0FBQzs7TUFFekQ7TUFDQSxNQUFNM0QsTUFBTSxDQUFDNkQsZUFBZSxDQUFDO01BQzdCcEQsR0FBRyxDQUFDSyxJQUFJLEdBQUdaLE1BQU0sQ0FBQyxHQUFHLEVBQUU7UUFBRXNDLE9BQU8sRUFBRTtNQUE0QixDQUFDLENBQUM7SUFFcEUsQ0FBQyxDQUFDLE9BQU9WLEdBQUcsRUFBRTtNQUNWckIsR0FBRyxDQUFDSyxJQUFJLEdBQUdYLFlBQVksQ0FBQyxHQUFHLEVBQUUyQixHQUFHLENBQUM7SUFDckM7RUFDRjtBQUVGLENBQUMifQ==","map":{"version":3,"names":["jwt","require","secret","firebase","query","orderByChild","equalTo","child","get","ref","push","set","remove","bcrypt","result","result_error","getRunningNoUserKey","saltRounds","module","exports","logIn","ctx","_next","user","password","request","body","userRef","userQuery","includes","snapshot","exists","userData","Object","values","val","passwordMatch","compare","token","sign","JSON","stringify","err","register","email","mobile","firstName","lastName","img","hashedPassword","hash","emailQuery","message","currentDate","Date","currentYear","getFullYear","currentMonth","String","getMonth","padStart","runningNo","newUserId","specificUserRef","userId","getProfile","params","usersRef","console","log","deleteUser","userKey","keys","userToDeleteRef"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/controllers/","sources":["user.controller.js"],"sourcesContent":[" \nconst jwt = require(\"jsonwebtoken\");  \nconst { secret, firebase } = require('../configs');\nconst { query, orderByChild, equalTo, child, get, ref, push, set, remove } = require(\"@firebase/database\");\nconst bcrypt = require('bcrypt'); \nconst { result, result_error} = require(\"../commons/convert\"); \nconst { getRunningNoUserKey } = require('../commons/calculate');\n\nconst saltRounds = 10;  \n\nmodule.exports = {\n  async logIn(ctx, _next) {\n    try {\n        const { user, password } = ctx.request.body;\n\n        // Determine if 'user' is an email or mobile\n        const userRef = ref(firebase, 'users');  \n        let userQuery;\n        \n        if (user.includes('@')) {\n          userQuery = query(userRef, orderByChild('email'), equalTo(user));\n        } else {\n          userQuery = query(userRef, orderByChild('mobile'), equalTo(user));\n        }\n\n        const snapshot = await get(userQuery);\n        if (snapshot.exists()) {\n          const userData = Object.values(snapshot.val())[0];  // Extract the first matched user data\n\n          const passwordMatch = await bcrypt.compare(password, userData.password);\n          if (!passwordMatch) {\n            ctx.body = result_error(403, \"Incorrect password\");\n            return;\n          }\n\n          const token = jwt.sign(JSON.stringify(userData), secret);\n          ctx.body = result(200, { token });\n        } else {\n          ctx.body = result_error(404, \"User not found\");\n        }\n\n    } catch (err) {\n        ctx.body = result_error(500, err);\n    }\n  },\n\n  async register(ctx, _next) {\n    try {\n        const { email, mobile, firstName, lastName, img, password } = ctx.request.body;\n        const hashedPassword = await bcrypt.hash(password, saltRounds);\n\n        const userRef = ref(firebase, 'users');  \n        const emailQuery = query(userRef, orderByChild('email'), equalTo(email));\n\n        const snapshot = await get(emailQuery);\n\n        if (snapshot.exists()) {\n            ctx.body = result(202, { message: 'This email is already in use. Please use a different one.' });\n            return;\n        }\n\n        // Create a new user \n        const currentDate = new Date();\n        const currentYear = currentDate.getFullYear();\n        const currentMonth = String(currentDate.getMonth() + 1).padStart(2, '0');\n        const runningNo = await getRunningNoUserKey(currentYear + currentMonth);\n \n        // Construct the userId\n        const newUserId = `${currentYear}${currentMonth}_${runningNo}`;\n        const specificUserRef = child(userRef, newUserId);\n\n        // Create a new user  \n        await set(specificUserRef, {\n            userId: newUserId,  \n            firstName,\n            lastName,\n            email,\n            mobile,\n            img,\n            password: hashedPassword\n        });\n\n        ctx.body = result(200, { message: \"Registration successful\", userId: newUserId });  \n\n    } catch (err) {\n        ctx.body = result_error(500, err);\n    }\n  },\n\n  async getProfile(ctx, _next) {\n    try {\n      const userId = ctx.request.params.userId; \n      const usersRef = ref(firebase, 'users');\n      const userQuery = query(usersRef, orderByChild('userId'), equalTo(userId));\n      const snapshot = await get(userQuery);\n      console.log(snapshot.val());\n\n      if (!snapshot.exists()) {\n        ctx.body = result_error(404, \"User not found\");\n        return;\n      }\n      \n      const userData = Object.values(snapshot.val())[0];\n\n      ctx.body = result(200, userData);\n\n    } catch (err) {\n      ctx.body = result_error(500, err);\n    }\n  },\n\n  async deleteUser(ctx, _next) {\n    try {\n        const userId = ctx.request.params.userId;\n\n        const usersRef = ref(firebase, 'users');\n        const userQuery = query(usersRef, orderByChild('userId'), equalTo(userId));\n\n        const snapshot = await get(userQuery);\n\n        if (!snapshot.exists()) {\n          ctx.body = result_error(404, \"User not found\");\n          return;\n        }\n\n        // Extract the key of the user data from the snapshot\n        const userKey = Object.keys(snapshot.val())[0];\n        const userToDeleteRef = ref(firebase, 'users/' + userKey);\n\n        // Delete user\n        await remove(userToDeleteRef);\n        ctx.body = result(200, { message: \"User deleted successfully\" });\n\n    } catch (err) {\n        ctx.body = result_error(500, err);\n    }\n  }\n\n};"],"mappings":"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"}},"mtime":1692891976198},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/user.router.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"const Router = require(\"koa-joi-router\");\nconst {\n  user\n} = require(\"./../controllers\");\nconst authMiddleware = require(\"../middleware/auth.middleware\");\nconst {\n  validateSchema\n} = require('../commons/validate');\nconst path = require('path');\nconst filename = path.basename(__filename).split('.')[0];\nconst directory = `../../docs/schemas/${filename}/Request/`;\nconst api = Router();\napi.prefix(\"/user\");\napi.route({\n  method: \"POST\",\n  path: \"/login\",\n  validate: validateSchema(directory + 'login.json'),\n  handler: user.logIn\n});\napi.route({\n  method: \"POST\",\n  path: \"/register\",\n  validate: validateSchema(directory + 'register.json'),\n  handler: user.register\n});\napi.route({\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: \"GET\",\n  path: \"/profile/:userId\",\n  handler: user.getProfile\n});\napi.route({\n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: \"DELETE\",\n  path: \"/profile/:userId\",\n  handler: user.deleteUser\n});\nmodule.exports = api;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSb3V0ZXIiLCJyZXF1aXJlIiwidXNlciIsImF1dGhNaWRkbGV3YXJlIiwidmFsaWRhdGVTY2hlbWEiLCJwYXRoIiwiZmlsZW5hbWUiLCJiYXNlbmFtZSIsIl9fZmlsZW5hbWUiLCJzcGxpdCIsImRpcmVjdG9yeSIsImFwaSIsInByZWZpeCIsInJvdXRlIiwibWV0aG9kIiwidmFsaWRhdGUiLCJoYW5kbGVyIiwibG9nSW4iLCJyZWdpc3RlciIsInByZSIsImN0eCIsIm5leHQiLCJnZXRQcm9maWxlIiwiZGVsZXRlVXNlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6Ii9Vc2Vycy9tYWNwcm8vRGVza3RvcC9JbmZvbWF0aW9uL1Rlc3Qvbm9kZS1iYWNrLWVuZC9zcmMvcm91dGVycy8iLCJzb3VyY2VzIjpbInVzZXIucm91dGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFJvdXRlciA9IHJlcXVpcmUoXCJrb2Etam9pLXJvdXRlclwiKTsgXG5jb25zdCB7IHVzZXIgfSA9IHJlcXVpcmUoXCIuLy4uL2NvbnRyb2xsZXJzXCIpO1xuY29uc3QgYXV0aE1pZGRsZXdhcmUgPSByZXF1aXJlKFwiLi4vbWlkZGxld2FyZS9hdXRoLm1pZGRsZXdhcmVcIik7XG4gXG5jb25zdCB7IHZhbGlkYXRlU2NoZW1hIH0gPSByZXF1aXJlKCcuLi9jb21tb25zL3ZhbGlkYXRlJykgIFxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTsgXG5jb25zdCBmaWxlbmFtZSA9IHBhdGguYmFzZW5hbWUoX19maWxlbmFtZSkuc3BsaXQoJy4nKVswXTsgXG5jb25zdCBkaXJlY3RvcnkgPSBgLi4vLi4vZG9jcy9zY2hlbWFzLyR7ZmlsZW5hbWV9L1JlcXVlc3QvYCBcbiBcbmNvbnN0IGFwaSA9IFJvdXRlcigpO1xuYXBpLnByZWZpeChcIi91c2VyXCIpOyBcbiBcbmFwaS5yb3V0ZSh7IFxuICBtZXRob2Q6IFwiUE9TVFwiLFxuICBwYXRoOiBcIi9sb2dpblwiLFxuICB2YWxpZGF0ZTogdmFsaWRhdGVTY2hlbWEoZGlyZWN0b3J5Kydsb2dpbi5qc29uJyksXG4gIGhhbmRsZXI6IHVzZXIubG9nSW4sXG59KTtcblxuYXBpLnJvdXRlKHsgXG4gIG1ldGhvZDogXCJQT1NUXCIsXG4gIHBhdGg6IFwiL3JlZ2lzdGVyXCIsXG4gIHZhbGlkYXRlOiAgdmFsaWRhdGVTY2hlbWEoZGlyZWN0b3J5KydyZWdpc3Rlci5qc29uJyksXG4gIGhhbmRsZXI6IHVzZXIucmVnaXN0ZXIsXG59KTtcbiBcbmFwaS5yb3V0ZSh7IFxuICBwcmU6IGFzeW5jIChjdHgsIG5leHQpID0+IGF3YWl0IGF1dGhNaWRkbGV3YXJlKGN0eCwgbmV4dCksXG4gIG1ldGhvZDogXCJHRVRcIiwgXG4gIHBhdGg6IFwiL3Byb2ZpbGUvOnVzZXJJZFwiLFxuICBoYW5kbGVyOiB1c2VyLmdldFByb2ZpbGUsXG59KTtcbiBcbmFwaS5yb3V0ZSh7IFxuICBwcmU6IGFzeW5jIChjdHgsIG5leHQpID0+IGF3YWl0IGF1dGhNaWRkbGV3YXJlKGN0eCwgbmV4dCksXG4gIG1ldGhvZDogXCJERUxFVEVcIiwgXG4gIHBhdGg6IFwiL3Byb2ZpbGUvOnVzZXJJZFwiLFxuICBoYW5kbGVyOiB1c2VyLmRlbGV0ZVVzZXIsXG59KTtcbiBcbm1vZHVsZS5leHBvcnRzID0gYXBpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUN4QyxNQUFNO0VBQUVDO0FBQUssQ0FBQyxHQUFHRCxPQUFPLENBQUMsa0JBQWtCLENBQUM7QUFDNUMsTUFBTUUsY0FBYyxHQUFHRixPQUFPLENBQUMsK0JBQStCLENBQUM7QUFFL0QsTUFBTTtFQUFFRztBQUFlLENBQUMsR0FBR0gsT0FBTyxDQUFDLHFCQUFxQixDQUFDO0FBQ3pELE1BQU1JLElBQUksR0FBR0osT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUM1QixNQUFNSyxRQUFRLEdBQUdELElBQUksQ0FBQ0UsUUFBUSxDQUFDQyxVQUFVLENBQUMsQ0FBQ0MsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4RCxNQUFNQyxTQUFTLEdBQUksc0JBQXFCSixRQUFTLFdBQVU7QUFFM0QsTUFBTUssR0FBRyxHQUFHWCxNQUFNLENBQUMsQ0FBQztBQUNwQlcsR0FBRyxDQUFDQyxNQUFNLENBQUMsT0FBTyxDQUFDO0FBRW5CRCxHQUFHLENBQUNFLEtBQUssQ0FBQztFQUNSQyxNQUFNLEVBQUUsTUFBTTtFQUNkVCxJQUFJLEVBQUUsUUFBUTtFQUNkVSxRQUFRLEVBQUVYLGNBQWMsQ0FBQ00sU0FBUyxHQUFDLFlBQVksQ0FBQztFQUNoRE0sT0FBTyxFQUFFZCxJQUFJLENBQUNlO0FBQ2hCLENBQUMsQ0FBQztBQUVGTixHQUFHLENBQUNFLEtBQUssQ0FBQztFQUNSQyxNQUFNLEVBQUUsTUFBTTtFQUNkVCxJQUFJLEVBQUUsV0FBVztFQUNqQlUsUUFBUSxFQUFHWCxjQUFjLENBQUNNLFNBQVMsR0FBQyxlQUFlLENBQUM7RUFDcERNLE9BQU8sRUFBRWQsSUFBSSxDQUFDZ0I7QUFDaEIsQ0FBQyxDQUFDO0FBRUZQLEdBQUcsQ0FBQ0UsS0FBSyxDQUFDO0VBQ1JNLEdBQUcsRUFBRSxNQUFBQSxDQUFPQyxHQUFHLEVBQUVDLElBQUksS0FBSyxNQUFNbEIsY0FBYyxDQUFDaUIsR0FBRyxFQUFFQyxJQUFJLENBQUM7RUFDekRQLE1BQU0sRUFBRSxLQUFLO0VBQ2JULElBQUksRUFBRSxrQkFBa0I7RUFDeEJXLE9BQU8sRUFBRWQsSUFBSSxDQUFDb0I7QUFDaEIsQ0FBQyxDQUFDO0FBRUZYLEdBQUcsQ0FBQ0UsS0FBSyxDQUFDO0VBQ1JNLEdBQUcsRUFBRSxNQUFBQSxDQUFPQyxHQUFHLEVBQUVDLElBQUksS0FBSyxNQUFNbEIsY0FBYyxDQUFDaUIsR0FBRyxFQUFFQyxJQUFJLENBQUM7RUFDekRQLE1BQU0sRUFBRSxRQUFRO0VBQ2hCVCxJQUFJLEVBQUUsa0JBQWtCO0VBQ3hCVyxPQUFPLEVBQUVkLElBQUksQ0FBQ3FCO0FBQ2hCLENBQUMsQ0FBQztBQUVGQyxNQUFNLENBQUNDLE9BQU8sR0FBR2QsR0FBRyJ9","map":{"version":3,"names":["Router","require","user","authMiddleware","validateSchema","path","filename","basename","__filename","split","directory","api","prefix","route","method","validate","handler","logIn","register","pre","ctx","next","getProfile","deleteUser","module","exports"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/routers/","sources":["user.router.js"],"sourcesContent":["const Router = require(\"koa-joi-router\"); \nconst { user } = require(\"./../controllers\");\nconst authMiddleware = require(\"../middleware/auth.middleware\");\n \nconst { validateSchema } = require('../commons/validate')  \nconst path = require('path'); \nconst filename = path.basename(__filename).split('.')[0]; \nconst directory = `../../docs/schemas/${filename}/Request/` \n \nconst api = Router();\napi.prefix(\"/user\"); \n \napi.route({ \n  method: \"POST\",\n  path: \"/login\",\n  validate: validateSchema(directory+'login.json'),\n  handler: user.logIn,\n});\n\napi.route({ \n  method: \"POST\",\n  path: \"/register\",\n  validate:  validateSchema(directory+'register.json'),\n  handler: user.register,\n});\n \napi.route({ \n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: \"GET\", \n  path: \"/profile/:userId\",\n  handler: user.getProfile,\n});\n \napi.route({ \n  pre: async (ctx, next) => await authMiddleware(ctx, next),\n  method: \"DELETE\", \n  path: \"/profile/:userId\",\n  handler: user.deleteUser,\n});\n \nmodule.exports = api;\n"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,gBAAgB,CAAC;AACxC,MAAM;EAAEC;AAAK,CAAC,GAAGD,OAAO,CAAC,kBAAkB,CAAC;AAC5C,MAAME,cAAc,GAAGF,OAAO,CAAC,+BAA+B,CAAC;AAE/D,MAAM;EAAEG;AAAe,CAAC,GAAGH,OAAO,CAAC,qBAAqB,CAAC;AACzD,MAAMI,IAAI,GAAGJ,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMK,QAAQ,GAAGD,IAAI,CAACE,QAAQ,CAACC,UAAU,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACxD,MAAMC,SAAS,GAAI,sBAAqBJ,QAAS,WAAU;AAE3D,MAAMK,GAAG,GAAGX,MAAM,CAAC,CAAC;AACpBW,GAAG,CAACC,MAAM,CAAC,OAAO,CAAC;AAEnBD,GAAG,CAACE,KAAK,CAAC;EACRC,MAAM,EAAE,MAAM;EACdT,IAAI,EAAE,QAAQ;EACdU,QAAQ,EAAEX,cAAc,CAACM,SAAS,GAAC,YAAY,CAAC;EAChDM,OAAO,EAAEd,IAAI,CAACe;AAChB,CAAC,CAAC;AAEFN,GAAG,CAACE,KAAK,CAAC;EACRC,MAAM,EAAE,MAAM;EACdT,IAAI,EAAE,WAAW;EACjBU,QAAQ,EAAGX,cAAc,CAACM,SAAS,GAAC,eAAe,CAAC;EACpDM,OAAO,EAAEd,IAAI,CAACgB;AAChB,CAAC,CAAC;AAEFP,GAAG,CAACE,KAAK,CAAC;EACRM,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMlB,cAAc,CAACiB,GAAG,EAAEC,IAAI,CAAC;EACzDP,MAAM,EAAE,KAAK;EACbT,IAAI,EAAE,kBAAkB;EACxBW,OAAO,EAAEd,IAAI,CAACoB;AAChB,CAAC,CAAC;AAEFX,GAAG,CAACE,KAAK,CAAC;EACRM,GAAG,EAAE,MAAAA,CAAOC,GAAG,EAAEC,IAAI,KAAK,MAAMlB,cAAc,CAACiB,GAAG,EAAEC,IAAI,CAAC;EACzDP,MAAM,EAAE,QAAQ;EAChBT,IAAI,EAAE,kBAAkB;EACxBW,OAAO,EAAEd,IAAI,CAACqB;AAChB,CAAC,CAAC;AAEFC,MAAM,CAACC,OAAO,GAAGd,GAAG"}},"mtime":1692894668747},"{\"assumptions\":{},\"sourceRoot\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/middleware/\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"filename\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/middleware/error.middleware.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"uat\",\"root\":\"/Users/macpro/Desktop/Infomation/Test/node-back-end\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.22.9:uat":{"value":{"code":"module.exports = async (ctx, next) => {\n  try {\n    await next();\n  } catch (err) {\n    if (err.status >= 500) console.log('Error handler:', err);\n    ctx.status = err.status || 500;\n    ctx.body = {\n      status: 'failed',\n      message: err.message || 'Internal server error'\n    };\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb2R1bGUiLCJleHBvcnRzIiwiY3R4IiwibmV4dCIsImVyciIsInN0YXR1cyIsImNvbnNvbGUiLCJsb2ciLCJib2R5IiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiL1VzZXJzL21hY3Byby9EZXNrdG9wL0luZm9tYXRpb24vVGVzdC9ub2RlLWJhY2stZW5kL3NyYy9taWRkbGV3YXJlLyIsInNvdXJjZXMiOlsiZXJyb3IubWlkZGxld2FyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChjdHgsIG5leHQpID0+IHtcbiAgIHRyeSB7XG4gICAgICBhd2FpdCBuZXh0KClcbiAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgaWYgKGVyci5zdGF0dXMgPj0gNTAwKSBjb25zb2xlLmxvZygnRXJyb3IgaGFuZGxlcjonLCBlcnIpXG4gICAgICBjdHguc3RhdHVzID0gZXJyLnN0YXR1cyB8fCA1MDBcbiAgICAgIGN0eC5ib2R5ID0ge1xuICAgICAgICAgc3RhdHVzOiAnZmFpbGVkJyxcbiAgICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlIHx8ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgfVxuICAgfVxufVxuIl0sIm1hcHBpbmdzIjoiQUFBQUEsTUFBTSxDQUFDQyxPQUFPLEdBQUcsT0FBT0MsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDbkMsSUFBSTtJQUNELE1BQU1BLElBQUksQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDLE9BQU9DLEdBQUcsRUFBRTtJQUNYLElBQUlBLEdBQUcsQ0FBQ0MsTUFBTSxJQUFJLEdBQUcsRUFBRUMsT0FBTyxDQUFDQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUVILEdBQUcsQ0FBQztJQUN6REYsR0FBRyxDQUFDRyxNQUFNLEdBQUdELEdBQUcsQ0FBQ0MsTUFBTSxJQUFJLEdBQUc7SUFDOUJILEdBQUcsQ0FBQ00sSUFBSSxHQUFHO01BQ1JILE1BQU0sRUFBRSxRQUFRO01BQ2hCSSxPQUFPLEVBQUVMLEdBQUcsQ0FBQ0ssT0FBTyxJQUFJO0lBQzNCLENBQUM7RUFDSjtBQUNILENBQUMifQ==","map":{"version":3,"names":["module","exports","ctx","next","err","status","console","log","body","message"],"sourceRoot":"/Users/macpro/Desktop/Infomation/Test/node-back-end/src/middleware/","sources":["error.middleware.js"],"sourcesContent":["module.exports = async (ctx, next) => {\n   try {\n      await next()\n   } catch (err) {\n      if (err.status >= 500) console.log('Error handler:', err)\n      ctx.status = err.status || 500\n      ctx.body = {\n         status: 'failed',\n         message: err.message || 'Internal server error',\n      }\n   }\n}\n"],"mappings":"AAAAA,MAAM,CAACC,OAAO,GAAG,OAAOC,GAAG,EAAEC,IAAI,KAAK;EACnC,IAAI;IACD,MAAMA,IAAI,CAAC,CAAC;EACf,CAAC,CAAC,OAAOC,GAAG,EAAE;IACX,IAAIA,GAAG,CAACC,MAAM,IAAI,GAAG,EAAEC,OAAO,CAACC,GAAG,CAAC,gBAAgB,EAAEH,GAAG,CAAC;IACzDF,GAAG,CAACG,MAAM,GAAGD,GAAG,CAACC,MAAM,IAAI,GAAG;IAC9BH,GAAG,CAACM,IAAI,GAAG;MACRH,MAAM,EAAE,QAAQ;MAChBI,OAAO,EAAEL,GAAG,CAACK,OAAO,IAAI;IAC3B,CAAC;EACJ;AACH,CAAC"}},"mtime":1689654029957}}